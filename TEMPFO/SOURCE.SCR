                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : 'C CREATE , IMMEDIATE DOES>  ?C @ ,  C" " WORD ", ;                                                                           ' (". 'C ."                                                     ' (" 'C "                                                       ' ABORT 2+ 'C  A"                                               : (( HEADER COMPILE [ ' DO: @ , ] , , IMMEDIATE ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( NOP DUP DROP   + AND XOR  U2/C @+ !+   PUSH POP XCHG  IF CALL   JUMP  ;     )     : LIT! POP !+ PUSH ; : EXECUTE PUSH ;       : LIT POP @+ PUSH ;    : DO_VAR POP ;       : 2* DUP + ;        : SWAP PUSH XCHG POP ; : ;: POP XCHG PUSH ; : DO_CONST POP @ ;  : NIP PUSH DROP POP ;  : @  @+ DROP ; : 2/ DUP 2* DROP U2/C ;   : OVER PUSH DUP XCHG POP ; : WCOUNT @+ SWAP ;  : !  !+ DROP ;   : >BYTE 255 AND ;   : C@ @ >BYTE ;   : +! DUP PUSH @ + POP ! ;  : C! SWAP >BYTE OVER @ DUP >BYTE XOR XOR SWAP! ;  : ODD 1 AND ; : INV -1 XOR ; : 1+ 1 + ;  : 1- -1 + ; : OR OVER INV AND XOR ;  : NEGATE INV 1+ ;   : - NEGATE + ;                                                                  : U<                           VARIABLE AR      $8000 CONSTANT SIGN_BIT   VARIABLE H        : A! AR ! ;  : A  AR @ ;  : @A A @ ;  : !A A ! ;                : @A+ A @+ A! ;   : !A+  A !+ A! ;  : MSWAP PUSH A! @A POP !A ; : 0< SIGN_BIT AND ;  : HERE H @ ;  : ALLOT H +! ;  : H! H ! ;   : , HERE !+ H! ;     : C, HERE ! 1 ALLOT ;                       6  NOP  ; ;: 0; UNEXT  P+                                       9  CALL   JUMP  IF -IF IFC IF#  NEXT ?FOR  NATIVE               8  PUSH POP XCHG OVER DUP DROP SWAP NIP                         9  ( 32 )  + +C NEGATE AND XOR OR NOT +* -/                     3  !P+  @P+  @P#                                               16  A! A @A !A @A+ !A+ @!A  -@A  B! B @B+ !B @B -!B @+ !+        3  U2/C   2*  2/                                               10  ( 32 ) FP! FP FP+ OP! OP OP+ TP! TP TP+ A+                  : DOVAL P+ @P+ ;    : DOVAL! !P+ ;                              : DOVAR ;:       : DOCON @P+ ;     : DOVECT @P+ 0; PUSH ;       : DOQ P+ P+ @P+ ;   : DOQ! P+ !P+ ;   : DOQ@ POP 2 + ;          : DOVQ P+ P+ @P+ 0; PUSH ;   : , =TP+ 5 @A !+ !A ;              : MOVEB B PUSH PUSH A! B! BEGIN @B+ !A+ UNEXT POP B! ;          : MOVE  PUSH SWAP A! BEGIN @+ SWAP !A+ UNEXT DROP ;             : CODE! PUSH A! BEGIN @A+ !P+ UNEXT ;                           : FCODE PUSH A! BEGIN A !P+ UNEXT ;                             ( NOP + AND XOR @+ !+ JUMP ; U2/C LIT DUP DROP PUSH POP IF XCHG)( IF MSB OF WORD <>0 THEN EXECUTE CALL TO ADDRESS )             MACRO : 2* DUP + ; : 1- -1 + ; : ZERO 0 AND ;                   : @ @+ DROP ; : ! @+ DROP ;  : INV -1 XOR ;  : 1+ 1 + ;         : &SIGN $8000 AND ;  : &ODD 1 AND ;    : &NONEG $7FFF AND ;     : &BYTE $FF AND ;  : &BSIGN $80 AND ;  : &BNONEG $7F AND ;      FORTH                                                                                                                           : DOCON LIT ;  : ;: POP XCHG PUSH ; : 2/ DUP 2* DROP U2/C ;     : - INV 1+ + ;  : NEGATE INV 1+ ;   : OVER PUSH DUP XCHG POP ;  : SWAP PUSH XCHG POP ;      : OR PUSH DUP INV AND POP XOR ;     : 0= IF ZERO ;THEN INV ;  : 0<> 0= INV ;  : 0< &SIGN 0<> ;      : NIP PUSH DROP POP ;  : U< - U2/C INV 0< ;  : = XOR 0= ;       : NEXT POP @+ POP IF 1- PUSH + PUSH ;THEN PUSH DROP ;                                                                                                                                              lit dd offset adup  mk dd 0, 0, 0                                 H dd 40000h*4     last dd 0                                 class dd 0            list dd 0, 0                             macros dd 0            forths dd 0                                                                                               spaces dd offset qIGNORE, offset execute                               dd offset NUM                                           aDEFINE dd 5+offset MACRO_ ; offset macrod ?                            dd offset qCOMPILE, offset cNUM, offset cSHORT                  dd offset COMPILE                                               dd offset SHORT_, offset nul, offset nul                        dd offset nul                                                   dd offset variable, offset nul, offset nul                      dd offset nul                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            : TRACE ' TR EXEC TO TR ; IMMEDIATE                             ' EXIT 4 + ALIAS BYE                                            : C" TO WORD 1+ C@ [',] LITERAL ; IMMEDIATE                     : ['] ' ?C TO , AT , , ; IMMEDIATE                              : 1Z, 0 C, ;                                                    : ( C" ) WORD DROP ; IMMEDIATE                                  : LIKE @ HEADER , ;    ' bl LIKE 1K  1024 ,                     : -HEAD AT HERE SPTR 1K AT 2* - AT VSWAP TO ! 0 TO HEADER ;     -HEAD                                                           : NM: NEGATE HERE SWAP [TO] DOES> HERE 2- AT + ] ;                                                                                                                                              : M: HERE AT , [ ' WORD @ 1+ DUP @ + 2+ , ] [AT] DOES> ] ;      : JM: M: 5 HERE 2- AT + ;                                       : LBL: HEADER TO , [ ' INTERPRET 2+ @ , ]  ] ;                                                                                                                                                                                                                  ' (" 4 + ALIAS ".  ' (" 2+ ALIAS (".                            : LINK+ HERE TO >< , ;                                          : W, TO COUNT , ;    ' >MARK 4 + ALIAS 2Z,                      : N,   (FOR [ >MARK ]  ,       TO (FOR [ TO >MARK ]  ;          : NW,  (FOR [ >MARK ]  W,      TO (FOR [ TO >MARK ]  ;          : STR, (FOR [ >MARK ] COUNT C, TO (FOR [ TO >MARK ] DROP ;      : MAKER CREATE DUP C,  N, ' , DOES> COUNT HEADER NW, AT EXEC ;                                                                                                                                   AT FORTH  2- DUP @ SWAP  2- DUP @ SWAP 2- @                   3 MAKER MAKEVOC 2Z,                                                                                                              : WORDLIST VOCLINK LINK+ ;                                      : VOCABULARY TO FORTH MAKEVOC WORDLIST ;                                                                                        MAKEVOC MACROS     2Z,                                          VOCABULARY HIDDEN                                               VOCABULARY ASSEMBLER                                                                                                            ' bl       @  1 MAKER CONSTANT ,                                ' SCRH  TO @  2 MAKER VALUE ,                                   ' INITW TO @  2 MAKER VECTOR ,                                                                                                                                                                                                                                                                                                  : PREVIOUS  AT ORDER# TO CONTEXT ;                              : ALSO CONTEXT TO ORDER# ;                                      : DEFINITIONS CONTEXT TO CURRENT ;                              : ONLY ORDER# TO 0 FORTH ALSO MACROS ALSO HIDDEN ALSO ;         ONLY                                                                                                                            (       FLOAD CONSTANT.TX )                                                                                                      1028 CONSTANT B/BUF                                               16 CONSTANT 1H                                                  31 CONSTANT #LEN                                                64 CONSTANT 1L                                                                                                                                                                                                                                               1 TO HEADER                                                     : 'C CREATE , IMMEDIATE DOES>  ?C @ ,  C" " WORD ", ;                                                                            ' IOV @  ' SCRH  TO @ 1- SWAP 1- SWAP 3 MAKER QUAN  ,           ' IOV @  1 NM: AT 2+ ! ;M 2 NM: AT 2- @ ;M 3 MAKER STACK> ,     ' IOV @  1 NM: AT 2- ! ;M 2 NM: AT 2+ @ ;M 3 MAKER <STACK ,                                                                     ' IOV @  1 MAKER VARIABLE 2Z,                                                                                                    256 DUP <STACK ON; ,   ( "," FOR FAST COMPARING BELOW)                                                                                                                                                                                                                                                                                                                                                                                                        (        FLOAD ENGINEM.TX       )                                 0 VALUE MH                                                      HERE C" ; STACK> MAC: ,                                         : EXECUTE >R ;                                                4 TO HEADER                                                       TIB DUP <STACK MS ,                                              : SWAPH    HERE MH TO HERE TO MH ;                           LBL: >IO_POS  TO >IN TO BLK TO INTERPRET [                      LBL: _TEVAL   0 SWAP TIB - >IO_POS [                                                                                              0 NM: BLK >R >IN >R EXECUTE R> TO >IN R> TO BLK ;M                                                                              HEADER         LOAD , ] 0 >IO_POS [                             ' LOAD LIKE    EVAL   ] _TEVAL [                                                                                                                                                             0  ( SAVE PLACE FOR "C"-STYLE STRING "LENGTH" PROCEDURE )       M: TO MH AT MACROS ! ;M                                         M: AT MACROS @ MH ;M         HEADER MAC , , ,                    1 TO HEADER  : MAC> CREATE AT MAC: @  WORD COUNT STR, 1Z,              IMMEDIATE DOES>                                                 AT DROP BLK >IN TO MS TO MS _TEVAL ; AT ALLOT            : >MAC SWAPH CURRENT >R TO MACROS EXEC R> TO CURRENT SWAPH ;       M: ['] MAC> >MAC ;M                                             ' MAC: !             : ?MAC ' 2+ AT MAC TYPE ;                  M: AT MAC: @ [',] C" AT MAC: ! MAC: AT MAC: ! ;M                ' MAC: 2+ !                                                     : -MAC TIB DUP AT MS TO ! 0 MPTR TO MAC ;                    LBL: _EOL AT MS TO @ - 0; MS MS >IO_POS [                            -MAC ' _EOL TO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (        FLOAD MACRO.TX)                                        -MAC F83                                                        MAC: RECOVER AT ALLOT;                                          MAC: >RESOLVE TO >MARK;                                         MAC: WCOUNT TO COUNT;                                           MAC: DABS TO ABS;                                               MAC: SCIND TO SCLST;                                            MAC: SCANW TO SCANB;                                            MAC: WBLK TO NBLK;                                              MAC: VBLK AT NBLK;                                              MAC: OPEN TO FOPEN;                                             MAC: ?EXEC TO EXEC;                                             MAC: PERFORM AT EXEC;                                           MAC: vUSER AT U0;                                               MAC: BLWORD TO WORD;                                            MAC: C@W TO C@;                                                 MAC: FCLOSE TO CLOSE;                                           MAC: ?BRANCH TO (BR;                                            MAC: DCOMPILE TO D,;                                            MAC: DLIT AT D,;                                                MAC: COMPILE TO ,;                                              MAC: LIT AT ,;                                                  MAC: BCOMPILE TO C,;                                            MAC: BLIT AT C,;                                                MAC: RP! TO RP;                                                 MAC: CNTDO AT (DO;                                              MAC: 4TH> TO LEAVE;                                             MAC: BREAK. AT LEAVE;                                           MAC: HOLD TO HLD;                                               MAC: BRANCH (BR;                                                MAC: CMOVE> TO CMOVE;                                           MAC: MOVE AT CMOVE;                                             MAC: DNEGATE TO NEGATE;                                         MAC: TUCK AT DUP;                                               MAC: ?KEY TO EMIT;                                              MAC: J TO I;                                                    MAC: K AT I;                                                    MAC: HI TO B>W;                                                 MAC: 2OVER TO OVER;                                             MAC: PICK AT OVER;                                              MAC: D+ TO +;                                                   MAC: +! AT +;                                                   MAC: -ROT TO ROT;                                               MAC: ROLL AT ROT;                                               MAC: 2DROP TO DROP;                                             MAC: RDROP AT DROP;                                             MAC: 2DUP TO DUP;                                                                                                               MAC: A@ AT @;                                                   MAC: 2SWAP TO SWAP;                                             MAC: FLIP ><;                                                   MAC: 1-! TO 1-;                                                 MAC: 1-!@ AT 1-;                                                MAC: 2-! TO 2-;                                                 MAC: 2-!@ AT 2-;                                                MAC: 1+! TO 1+;                                                 MAC: @1+! AT 1+;                                                MAC: 2+! TO 2+;                                                 MAC: @2+! AT 2+;                                                MAC: 2! TO !;                                                   MAC: 2@ TO @;                                                   MAC: A! AT !;                                                   MAC: 0MIN TO MIN;                                               MAC: PACK TO UNPACK;                                            MAC: @UNPACK AT UNPACK;                                         MAC: UF2 TO U-FUNC;                                             MAC: UF4 AT U-FUNC;                                             MAC: D- TO -;                                                   MAC: CBAX TUCK * ROT + * +;                                     MAC: ROL4 4 ROLL;                                               MAC: ABCX ROL4 OVER * ROL4 + * +;                               MAC: HEAD HEADER;                                               MAC: 2^ TO SHIFT;                                               MAC: 0. 0 0;                                                    MAC: -1. -1 -1;                                                 MAC: PC2+ TO PC1+;                                              MAC: XOR! TO XOR;                                               MAC: | 1 TO HEADER;                                             MAC: HEADERS 0 TO HEADER;                                       MAC: -HEADERS -1 TO HEADER;                                     MAC: ON TO -1;                                                  MAC: OFF TO 0;                                                  MAC: AT-XY GOTOXY;                                              MAC: R>M AT 2/;                                                 MAC: NOT -1 XOR;                                                MAC: FLD! TO C!;                                                MAC: RUN LATEST EXEC;                                           MAC: SMUDGE AT IMMEDIATE;                                       ( MAC: | NOOP;                ( DONGLE)                         ( MAC: -HEADERS NOOP;         ( DONGLE)                         MAC: N>LINK N>C 2-;                                             MAC: V>LINK   2-;                                               TO MAC: ! ;THEN EXIT THEN !                                     MAC: PUSH >R ;                                                  MAC: POP R> ;                                                   MAC: U/ U/MOD NIP ;                                             MAC: FLD@ AT C!;                                                MAC: LATEST AT CURRENT N>C;                                     MAC: UMOD U/MOD DROP ;                                          MAC: REVERCE AT ><;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( COMPILE.TX)                                                   : WITHIN OVER - >R - R> U< ;  : ?BLK 1 -1 WITHIN ;              : CLARY HERE OVER ERASE ALLOT ;                                 : BARY HEADER TO , [ ' ORIGIN+ 2+ @ 2+ 2+ , ] CLARY ;           | : ARRAY CREATE , DOES> HEADER  @ ,                                  HERE DUP PUSH 2- EXEC POP - CLARY ;                       ' ORIGIN+ 2+ @ 2+    ARRAY WARY                                 ' ORIGIN+ 2+ @       ARRAY QARY                                 ' ORIGIN+ 2+ @ 2-    ARRAY 5ARY                                 ' ORIGIN+ 2+ @ 2- 2- ARRAY TARY                                                                                                                                                                                                                                                                                                 ' (". 'C ."         ' (" 'C "          ' ABORT 2+ 'C  A"        : 'STR, DUP C, STR, ;                                           : ," TO WORD ", ;                                               : .( C" ) WORD ". ; IMMEDIATE                                   : 0" HERE 2+ [',] " 1Z, TO 1+ ; IMMEDIATE                                                                                       (        FLOAD CONTROL.TX)                                                                                                      : BLKNL 1L 1- OR 1+ ;                                           : SKIPL -1 WORD DROP ;                                          : >HERE >MARK HERE ;                                            : ,>MARK  , TO >MARK ;                                          : <MARK HERE TO ON; ;                                           : ,<MARK ON; , ;                                                                                                                                                                                                                                                : (( HEADER COMPILE [ ' DO: @ , ] , , IMMEDIATE ;                                                                               ' >MARK ' (BR       (( SKIP                                     ' >MARK    ' (BR 2+ ((   IF                                     ' >MARK ' (BR 2+ 2+ ((  -IF                                     ' >MARK 2+ ALIAS THEN  IMMEDIATE                                                                                                : ELSE [',] SKIP  SWAP [',] THEN ; IMMEDIATE                    : \ BLK ?BLK IF >IN BLKNL TO >IN ELSE SKIPL THEN ;  IMMEDIATE                                                                   ' ,<MARK ' (BR     ((  AGAIN                                    ' ,<MARK ' (BR 2+  ((   UNTIL                                   ' ,<MARK ' (BR 2+ 2+ (( -UNTIL                                                                                                                                                                  ' -IF  ALIAS -WHILE IMMEDIATE                                   ' <MARK ALIAS  BEGIN IMMEDIATE                                  ' IF ALIAS   WHILE  IMMEDIATE                                                                                                   : REPEAT  [',] AGAIN [',] THEN ; IMMEDIATE                                                                                      ' >HERE  ' (DO         ((    DO                                 ' >HERE  ' (DO 2+      ((   ?DO                                 ' ,>MARK ' (LP         ((  LOOP                                 ' ,>MARK ' (LP 2+      (( +LOOP                                 ' >MARK  ' (FOR        ((   FOR                                 ' >MARK 2+  ' (FOR 2+  ((  NEXT                                 ' >MARK   ' (OF        ((    OF                                                                                                                                                                                                                                 : CSP! CSP SP TO CSP ;                                          : ?CSP SP CSP - A" SP CHG!" TO  CSP ;                           ' CSP! ALIAS CASE  IMMEDIATE                                    ' ELSE   ALIAS  ENDOF   IMMEDIATE                               : ENDCASE COMPILE DROP  BEGIN SP CSP -                            WHILE [',] THEN  REPEAT TO CSP ; IMMEDIATE                                                                                      \        FLOAD MAKERS.TX                                                                                                      TO HIDDEN                                                                                                                       ( WITH-ADDR  ROOTLINK_ADR WITH-ADDR  - )                        M: ( FIXLINX) BEGIN OVER TO >< ?DUP -UNTIL DROP ;M  TO ON;        0 NM: AT CURRENT N>C OVER ( FIXLINX) [ >MARK TO ON; ] TO 0 ;M                                                                                                                                                                                                   1 NM: LINK+ ;M                                                2 MAKER RECUR ,                                                                                                                 TO FORTH                ( AT RECURCE - FIXLINX)                   0 RECUR RECURCE  HERE ON; !  ON; ,  IMMEDIATE                                                                                     M: ON; >R ;M       ( THIS IS "AT CO")                           M: R> TO ON; AT ,  [ >MARK TO ON;   ] TO ON; ;M                 ' RP 4 + @ (  v--       --v  "DO" ">RELEASE" TRICKY WAY)    TO HIDDEN                                                       HEADER CO  3 N,  HERE 2- ON; !                                                                                                  TO FORTH                                                                                                                                                                                        : ; [',] ; [TO] RECURCE                                              BEGIN AT ON; TO @ - WHILE ON; EXEC REPEAT ; IMMEDIATE                                                                      \  (CELL SIZE LEN STRING  WORDS) STRINGS.TX  STR  TO STR=S!     \ STR (A - A' N)=WCOUNT  TO STR ( A1 N A2 - )  = S!             TO HIDDEN                                                                                                                       : S+C! ( C A - ) SWAP PUSH RP 1 ROT  AT STR RDROP ;             : "T SPTR STR ; ( -- A N )   : "N SPTR STR + STR ;              : "DROP "T + TO SPTR ;                                          : "POP ( A --) "T ROT SWAP CMOVE "DROP  ;                       : "ALLOT ( N -- N A )  DUP 2+ AT SPTR TO @+! ;                  : "BUFF  ( C N -- ) "ALLOT ! "T ROT FILL ;                      : "PUSH  ( A N -- ) "ALLOT OVER PUSH 2+ SWAP MOVE POP SPTR ! ;                                                                                                                                  : "INS   ( A N -- ) "T PUSH TO SPTR "PUSH POP SPTR +! ;         | : ?INS" ( C -) CREATE C, DOES> PUSH SP POP C@ "INS DROP ;     1 ?INS" C"INS       2 ?INS" W"INS                                                                                                                                                               \ AT STR ( A1 N A2 - )  = S+!                                   : ">' SPTR "DROP COUNT OVER C! ;    : NUP PUSH DUP POP ;        : 2REV DUP PUSH NUP REVERCE NUP REVERCE POP REVERCE ;           : "SWAP SPTR 2 FOR DUP STR + NEXT 2REV ;                        : "CUT ( N --) "T ROT 2DUP 0 WITHIN -IF DROP DUP THEN ( A N N)    -ROT PUSH 2DUP + 2- TO SPTR SWAP "PUSH POP SPTR @ - "T + ! ;  : "+ "SWAP "T "DROP "INS ;   : '>" COUNT "PUSH ;                : =' C" " WORD '>" ">' ;     : =" =' COUNT ;                    : "EVAL "PUSH 0 1 "BUFF "+ "T DROP EVAL "DROP ;                                                                                                                                                 : "OVER "N "PUSH ;  : "NIP "SWAP "DROP ;                        : "DEL SWAP "CUT "SWAP "CUT "DROP "+ ;                          : "INSERT "CUT "SWAP "INS "+ ;                                                                                                   0. "PUSH  0.  "PUSH    ( EMPTY STACK ELEMENT )     TO FORTH                                                                                                                                    \   PAD SPACES <# #> # #S SIGN D# D.R D. .R . U.                : DIG. ALPHA EMIT ;                                             : PAD HERE 320 + ;                                              : 1H. 1H 1- AND DIG. ;                                          : SPACES TO MAX FOR SPACE NEXT ;                                : 1B. 1H /MOD 1H. 1H. ;                                         : 1W. UNPACK 1B. 1B. ;                                                                                                                                                                          : 1D. 1W. 1W. ;                                                 : .H 1W. SPACE ;                                                : UM/MOD TUCK U/MOD PUSH  SWAP TO U/MOD POP ;                   : 1# BASE UM/MOD  AT HLD 1+! ;                                  : S# AT HLD  OFF BEGIN 1# 2DUP OR -UNTIL 2DROP ;                : D# IF DABS S# -10 AT HLD 1+! EXIT THEN S# ;                   : D.R PUSH D# POP HLD - SPACES HLD FOR DIG. NEXT ;              : D. S>D 0 D.R SPACE ;                                          : . S>D D. ;                                                    : U. 0 D. ;                                                     : .R PUSH S>D S>D POP D.R ;                                     : U.R  0 0 ROT D.R ;                                            : UD. 0 0 D.R SPACE ;                                           : UD.R 0 SWAP D.R ;                                                                                                                                                                             : #>" S# HLD "ALLOT ! "T CNTDO DO ALPHA I C! LOOP ;             : N>" 0 #>" ;                                                   : A>" BASE PUSH HEX N>" N>"  C" : C"INS  "+  POP TO BASE ;                                                                                                                                      \        FLOAD CMD.TX                                           : "P>OS "PUSH bl C"INS "+ ">' SHELL ;                           : FED " EDT" '>" "P>OS ;                                        : REMOVE " DEL" '>" "P>OS ;                                     | : CMD0  CREATE =" 'STR, ;                                     | : CMD1N CMD0 DOES> '>" ?CS: A>" "T "DROP "P>OS ;              | : CMD2" CMD0 DOES> '>" =" "P>OS ;                             CMD2" DOS COMMAND /C"                                           CMD2" ED EDT"                                                                                                                                                                                   CMD2" DIR DIR /O"                                               CMD2" DEL DEL"                                                  CMD2" CD CD"                                                    CMD2" RD RD"                                                    CMD2" REN REN" ( CMD1" CLS CLS")                                CMD2" ATEST ..\AFD.COM"                                         CMD1N $TEST ..\AFD.COM"                                                                                                                                                                                                                                         \        FLOAD LOCALS.TX                                        ( ARGS /ARGS  ?END)                                                                                                                                                                                                                                                                                                             ONLY HIDDEN ALSO FORTH DEFINITIONS                              : /LOCALS COMPILE [ 1 FRM , ] ; IMMEDIATE                                                                                       TO HIDDEN                                                       : ?END >IN  >R BLWORD COUNT 1-     IF DROP -1 ELSE C@ THEN         SWAP COUNT  ROT SCAN 1+ DUP   IF RDROP ELSE R> TO >IN THEN   ;                                                               | : 1VAR DUP 1 9 WITHIN                                                                                                                                                                             IF LIT [ 7 FRM @ , ] SWAP AT 2* NEGATE + ALIAS                  ELSE HEADER 2 FRM W, W, W, 2* NEGATE , IMMEDIATE THEN       ;                                                               MAC  CSP!                                                                                                                                                                                                                                                       MAC: LVAR  ['] 1VAR >MAC ;                                                                                                                                                                                                                                       \ FLOAD  LOCALMAC.TXT                                                                                                                                                                          ( USE MACRO LOCALS)                                                                                                                                                                             MAC: CADR 7 FRM @ SWAP 8 * -; MAC: SADR CADR 2+ , ];            MAC: LOC/ [ 6 FRM , ];        MAC: /LOC [ 1 FRM , ];            MAC: LADR CADR , ];           MAC: ^ADR CADR 4 + , ];                                                                                                                                           MAC: L1@ [ 1 LADR;   MAC: L1! [ 1 SADR;   MAC: L1 [ 1 ^ADR;     MAC: L2@ [ 2 LADR;   MAC: L2! [ 2 SADR;   MAC: L2 [ 2 ^ADR;     MAC: L3@ [ 3 LADR;   MAC: L3! [ 3 SADR;   MAC: L3 [ 3 ^ADR;     MAC: L4@ [ 4 LADR;   MAC: L4! [ 4 SADR;   MAC: L4 [ 4 ^ADR;     MAC: L5@ [ 5 LADR;   MAC: L5! [ 5 SADR;   MAC: L5 [ 5 ^ADR;     MAC: L6@ [ 6 LADR;   MAC: L6! [ 6 SADR;   MAC: L6 [ 6 ^ADR;     MAC: L7@ [ 7 LADR;   MAC: L7! [ 7 SADR;   MAC: L7 [ 7 ^ADR;     MAC: L8@ [ 8 LADR;   MAC: L8! [ 8 SADR;   MAC: L8 [ 8 ^ADR;                                                                     ( (ARGS LOCALS( PROC)                                           | : (ARGS  1 769 LOC/                                             BEGIN 0" /)" ?END DUP 2 < ( 0 WRD 1 /)                          WHILE IF L1@ IF 0 L1! ELSE 1 A" / >1 ?" THEN                          ELSE  L2@ 1+ DUP L2!  LVAR  L1@                                                                                                                                                                    IF L3 ELSE L4 THEN    1+!                                    THEN                                                      REPEAT DROP  L3@ L4@ PACK /LOC                                ;                                                               ?CSP TO MAC      TO FORTH                                                                                                       : LOCALS( (ARGS COMPILE [ 0 FRM , ] ,                           ; IMMEDIATE                                                                TO FORTH                                             : ':  HEADER DO: ;                                              : : MAC CSP! : TO CO ?CSP TO MAC ;                              : :: :  RECOVER  ['] INTERPRET STR , @ , ;                                                                                        8 FRM ALIAS RETURN  ( DEFINE RETURN PROCEDURE )                                                                                                                                               : FUNC: : RECOVER  ( MOVE H BACK 1 CELL TO CLEAR XNEST)           C" ( BLWORD 1+ C@ =? (ARGS                                          COMPILE [ 5 FRM @ , ] ,    TO CO                                RECOVER ( EXIT TOKEN )   COMPILE RETURN  ;                 F83                                                                                                                            \        FLOAD MISC.TX                                                                                                          ( FIXES ON WORDS)                                               : ALIGN 1- SWAP 1- OR 1+ ;                                      : RESCAN >IN -FIND ROT TO >IN ;                                                                                                   M: RESCAN NIP 0; CR   HERE ". ."  EXIST ! "                       BLK 1- 0>= 0; ." IN BLK " BLK .  ;M                                                                                                                                                                                                                           260 !   ( 104 IN HEX)                                                                                                         M: DUP BEGIN COUNT -UNTIL 1- OVER - ;M      ' MAC 4 + !                                                                         : .. BASE PUSH DECIMAL .R POP TO BASE ;                         : HOME 0 0 GOTOXY ;                                             : PAGE (CLSC HOME ;                                             : ?EMIT DUP bl < IF DROP C" . THEN EMIT ;                       : ?TYPE FOR COUNT ?EMIT NEXT DROP ;                             : .LINE 3 .. SPACE 1L ?TYPE ;                                   : .BLOCK CR ." Scr# " SCR 6 .. 1H 0                                   DO CR DUP I .LINE 1L + LOOP DROP ;                        : CTRL TO WORD 1+ C@ #LEN AND [',] LITERAL ; IMMEDIATE                                                                                                                                                                                                          \        FLOAD DEBUG.TX                                                                                                         : TRACE ' TR EXEC TO TR ; IMMEDIATE                             : WW DUP H. DUP @ DUP H. ?ID. 2+ ;  ( DEBUG ONE ADDRESS)        | : DUMPLINE  CR DUP 1W. 1H 2DUP FOR COUNT SPACE 1B.            NEXT DROP SPACE C" [  EMIT ?TYPE C" ] EMIT ;                    : DUMP 1H ALIGN 1H / FOR DUP DUMPLINE 1H + NEXT DROP ;          \ : 'W DUP H. TO COUNT DUP H. ;                                 \ : 'B DUP H. COUNT DUP H. ;                                    \ : 'S DUP H. DUP ". COUNT + ;                                  : WDS FOR CR WW NEXT ;  : SEE ' 2+  1H WDS ;                    : ? @ . ;                                                       ( : #S. 2- OVER MAX ?DO I @ . -2 +LOOP ;)                                                                                                                                                       | : #S. CR ".                                                                                                                   [     MAC: -WCOUNT 2- DUP @ ;                                         MAC: ?ITEMS TO DUP - NIP 2 / 1- ;                               MAC: ?STACK DUP 0< A" STACK UNDERFLOW" ;                  ]   ?ITEMS ?STACK FOR -WCOUNT . NEXT DROP C" ] EMIT ;           : S. S0 SP " S[ " #S. ;  : R. R0 RP " R[ " #S. ;                                                                                 \        FLOAD BLOCKS.TX                                                                                                        0 NM: C@ PREV C! ;M  DUP     TO HIDDEN                           HEADER DISCARD ,   0 C,     TO FORTH                            HEADER UPDATE  ,  -1 C,                                                                                                                                                                                                                                       TO HIDDEN                                                       : EMPTY-BUFFERS FIRST LIMIT OVER - ERASE                            LIMIT FIRST DO  -1 I 1+ ! B/BUF +LOOP ;                                                                                     EMPTY-BUFFERS                                                   | : +BUF B/BUF + DUP LIMIT = IF DROP FIRST THEN DUP PREV - ;    | : BUFFER USE DUP >R  BEGIN +BUF UNTIL TO USE R@ COUNT            IF DUP TO COUNT TO NBLK 0 R@ C! THEN  R@ TO PREV ! R> 3+ ;   : SAVE-BUFFERS LIMIT FIRST ?DO I C@ IF I COUNT I TO XOR             TO COUNT TO NBLK THEN B/BUF +LOOP ;                         : -USE SCRH 1+ IF SCRH CLOSE DROP -1 TO SCRH THEN ;             TO FORTH                                                        : FLUSH SAVE-BUFFERS EMPTY-BUFFERS ;                            : USING FLUSH -USE FOPEN TO SCRH ;                                                                                                                                                                                                                                                                                              : BLOCK >R PREV DUP 1+ @ R@ - IF                                   BEGIN +BUF 0=  IF DROP R@ BUFFER DUP R@ NBLK 2- 1- THEN           DUP 1+ @ R@ =                                                 UNTIL   DUP TO PREV  THEN                                         AT DROP 3+ DERR ?DUP                                            IF CR DISCARD ." I/O ERROR " . 0 TO DERR ABORT THEN ;          ' BLOCK  ' NBLK 10 + !                                                                                                      : LIST DUP TO SCR  BLOCK .BLOCK ;                               | : ?LD BLK 0= A" LOADING?" ;                                   : --> ?LD 0 TO >IN BLK 1+ TO BLK ; IMMEDIATE                    : COPY  SWAP BLOCK SWAP BLOCK 1K CMOVE UPDATE FLUSH ;                                                                                                                                           : THRU  1+ SWAP  DO I LOAD LOOP ;                               : +THRU BLK DUP D+ THRU ;                                                                                                       \        FLOAD FORGET.TX                                                                                                        0  VALUE FENCE                                                  : forget   DUP FENCE                                               U< A" fence !" >R  (  - R@ )                         BEGIN  VOCLINK                                               (      - )                  @ ?DUP R@ U<                                               (  -     ?)                                -WHILE @ VOCLINK !                                           (    -      )                                                                                                                                                                                                                                                                                REPEAT                                                          VOCLINK                                                      (      - )                 BEGIN DUP 2-                                                 (         )                     BEGIN @ DUP                                                ( -     -   )                 R@ U<                                                    ( -  -     ?)                                -WHILE N>C 2-                                              ( -    -   )                              REPEAT                                                                                                                                                                                     ( -    -v  )                                        OVER 2- !                                                                                                                                                                                  (    )                                           @ ?DUP                                                     (      ?)                                   -UNTIL  FORTH                                                 ( FORTH -> CONTEXT)                                                TO FORTH  R>                                                 ( FORTH -> CURRENT)                                                TO HERE                                                      ( R>    -> HERE   )                                                DROP ;                                                                                                                                                                                       ( VOCLINK @ )                                                   : FORGET ' C>N DROP forget ;                                    HERE TO FENCE                                                                                                                                                                                   \        FLOAD WORDS.TX                                         : WORDS  CR 10 TO CSP CONTEXT  -1 0 DO @ ?DUP                      IF DUP                                                             C@ 31 AND 6 + OUTC + 80 <                                       -IF CR CSP ?DUP                                                    IF 1- TO CSP                                                    ELSE  10 TO CSP KEY B>W 27 =                                       IF DROP I " LISTED"  LEAVE THEN                              THEN                                                                                                                                                                                         THEN         DUP .H DUP ID.                                     1H OUTC OVER MOD ?DUP                                           -IF DUP THEN -     DUP 13 < -IF DROP 1 THEN                         OUTC 64 < -IF 1- THEN SPACES                                N>C 2-                                                       ELSE CR I " TOTAL" LEAVE THEN                                 LOOP ". ."  WORDS = " . ;                                                                                                                                                                      \      FLOAD CLASS.TX                                           \        FLOAD PRUNE.TX                                         F83                                                                                                                                                                                                                                                                                                                             \ : WORD. DUP H. ID. ;                                          \ : VOC. 2- C>N DROP CR ." VOCABULARY : " WORD. ;               \ : VOCS. VOCLINK BEGIN ?DUP                                    \      WHILE DUP 2-  VOC. @ REPEAT ;                            \ : WORDS.  DUP VOC. BEGIN @ ?DUP                               \      WHILE DUP WORD. N>LINK REPEAT ;                          \ : HERE<.  DUP VOC. BEGIN @ ?DUP WHILE DUP                     \      HERE U<  IF DUP WORD. THEN N>LINK REPEAT ;               \ : HERE>.  DUP VOC. BEGIN @ ?DUP WHILE DUP                     \      HERE U< -IF DUP WORD. THEN N>LINK REPEAT ;               \ : ALL-W. VOCLINK BEGIN ?DUP                                   \      WHILE DUP V>LINK WORDS. @ REPEAT ;                                                                                       : PRUNE VOCLINK                                                                                                                                                                                  BEGIN    DUP  >R                                                                                                               \                                                   V>LINK                                                   \                                          BEGIN @ DUP                                                  \                                           HERE U<                                                     \      >= HERE                                          -WHILE N>LINK REPEAT                                          \                                               DUP R@ V>LINK !                                              \          < HERE                                                                                                                                                                                                             \                                      ?DUP IF DUP >R                                                                                                            \      -                                     BEGIN N>LINK                                               \                                                         @ ?DUP                                                    \                                                               WHILE DUP HERE U<                                          \         < HERE                                   IF DUP R>                                                \                                                        N>LINK                                               \                                                                                                                                                                                   ! DUP >R                                               \                                                                      THEN                                                     \                                                                    REPEAT                                                     \                                                                    0 R> N>LINK !                                              \                                         THEN                                                         \                                                                R> @ ?DUP -UNTIL                                               \                                                   -HEAD                                                          ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              