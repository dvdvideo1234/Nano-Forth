 0 NM: C@ PREV C! ;M DUP
 HEADER DISCARD , 0 C,     HEADER UPDATE , -1 C,
: EMPTY-BUFS  FIRST LIMIT OVER - ERASE  FIRST DUP TO PREV
 TO USE
      LIMIT FIRST DO -1 I 1+ ! B/BUF +LOOP ;
  : ;ABLK EX PREV 2+ 1+ DERR A" IO-BLK ?" ;
  : +BUF B/BUF + DUP LIMIT = IF DROP FIRST THEN DUP PREV - ;
  : ?SAVE BSTR  IF DUP STR WBLK 0 OVER 1- C! THEN ;
: BUFFER USE DUP  BEGIN +BUF UNTIL TO USE DUP TO PREV ?SAVE !+
    DUP 1K ERASE ;
: SAVE-BUFS  LIMIT FIRST ?DO I ?SAVE DROP B/BUF +LOOP ;
: BLOCK ;ABLK PUSH PREV 1+ @ R@ - IF PREV
 BEGIN +BUF 0= IF DROP POP BUFFER 2- STR RBLK ;THEN
   DUP 1+ @ R@ = UNTIL TO PREV THEN RDROP ;
