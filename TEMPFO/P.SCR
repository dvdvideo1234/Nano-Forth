111                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             FUNC: FAC ( N )                                                         N 2 < IF 1 RETURN THEN                                          N N 1- RECURCE * ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      : INDEX 1+ SWAP DO I BLOCK I CR .LINE LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : B>W COMPILE LO ; IMMEDIATE                                    : PACK LO   FLIP PUSH LO POP XOR ;                              : UNPACK DUP HI  PUSH LO POP ;                                  : THRU 1+ SWAP DO I LOAD LOOP ;                                                                                                 \ 9 15 THRU                                                                                                                     CR  BLK .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       CR  BLK .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (  EDITOR POSXY WIPE RELOAD SAVEBLK LB N B ARROW)               F83  TO FORTH \ VOCABULARY EDITOR                               ( ONLY FORTH ALSO  EDITOR  ALSO DEFINITIONS)   0 VALUE XY        -HEADERS   0 VALUE CHG     0 VALUE INS   0 VALUE OLD_RP        : ~CHANGE 0 TO CHG ;     :  CHANGE 1 TO CHG ;                   : ?XY 1L U/MOD  8 2 TO + ; : POSXY XY ?XY GOTOXY ;              : /L 1L 1- OR ; ( LINE END) : L/ 1L NEGATE AND ;  ( LBEGIN)     : RDR HOME PAD .BLOCK ;   : LINE/ PAD XY L/ + ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 : LB SAVEBLK SCR + TO MAX TO SCR ;                              : L2 1K  XY - 1L - TO MAX ;      : POS^ PAD XY + ;              : /LINE PAD XY /L + ;         : LL /LINE POS^ - ;               : P2 POS^ DUP DUP 1L + ;                                        ( COPY POS^ LINE/ /LINE LDRAW EL INSC DELC OVTC INSL DELL LL  ) : ;LRUD  XY EX 1K 1- AND TO XY ;                                : L_UP  ;LRUD  1L - ;     ( LINE UP)                            : L_DN  ;LRUD  1L + ;     ( LINE DOWN)                          : L_END ;LRUD  /L ;       ( LINE END)                           : L_BEG ;LRUD  L/ ;       ( LINE BEGIN)                         : ->    ;LRUD  1+ ;       ( MOVE 1 CHAR RIGHT)                  : <-    ;LRUD  1- ;       ( MOVE 1 CHAR LEFT)                   : TAB>  ;LRUD  7 OR 1+ ;  ( NEXT TABULATION )                   : <TAB  ;LRUD  1- -8 AND ;  ( PREVIOUS TABULATION)              : <_|   L_DN L_BEG    ;   ( CARRIGE RETURN L_DN L_BEG )         : APOS  ;LRUD  0 AND ;    ( HOME POSITION OF CURSOR)            : LDRAW POSXY LINE/ cr EMIT XY 1L / .LINE ;                     : WIPE ; \ : WIPE PAD 1K BLANK CHANGE RDR ;                     : RLD SCR BLOCK PAD 1K CMOVE ~CHANGE RDR ;                      : SAVEBLK CHG IF PAD SCR BLOCK 1K CMOVE UPDATE ~CHANGE THEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : P PAD 2- @ 0;                                                               >INSL POS^                                                                 "POP                                                                 RDRC ;                            : C POS^ >EL L_DN                                                                 "PUSH ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (  EDITOR POSXY WIPE RELOAD SAVEBLK LB N B ARROW)               F83  TO FORTH \ VOCABULARY EDITOR                               ( ONLY FORTH ALSO  EDITOR  ALSO DEFINITIONS)   0 VALUE XY        -HEADERS   0 VALUE CHG     0 VALUE INS   0 VALUE OLD_RP        : ~CHANGE 0 TO CHG ;     :  CHANGE 1 TO CHG ;                   : ?XY 1L U/MOD  8 2 TO + ; : POSXY XY ?XY GOTOXY ;              : /L 1L 1- OR ; ( LINE END) : L/ 1L NEGATE AND ;  ( LBEGIN)     : RDR HOME PAD .BLOCK ;   : LINE/ PAD XY L/ + ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 : LDRAW POSXY LINE/ cr EMIT XY 1L / .LINE ;                     : WIPE ; \ : WIPE PAD 1K BLANK CHANGE RDR ;                     : RLD SCR BLOCK PAD 1K CMOVE ~CHANGE RDR ;                      : SAVEBLK CHG IF PAD SCR BLOCK 1K CMOVE UPDATE ~CHANGE THEN ;   : LB SAVEBLK SCR + TO MAX TO SCR ;                              : L2 1K  XY - 1L - TO MAX ;      : POS^ PAD XY + ;              : /LINE PAD XY /L + ;         : LL /LINE POS^ - ;               : P2 POS^ DUP DUP 1L + ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( COPY POS^ LINE/ /LINE LDRAW EL INSC DELC OVTC INSL DELL LL  ) : ;LRUD  XY EX 1K 1- AND TO XY ;                                : L_UP  ;LRUD  1L - ;     ( LINE UP)                            : L_DN  ;LRUD  1L + ;     ( LINE DOWN)                          : L_END ;LRUD  /L ;       ( LINE END)                           : L_BEG ;LRUD  L/ ;       ( LINE BEGIN)                         : ->    ;LRUD  1+ ;       ( MOVE 1 CHAR RIGHT)                  : <-    ;LRUD  1- ;       ( MOVE 1 CHAR LEFT)                   : TAB>  ;LRUD  7 OR 1+ ;  ( NEXT TABULATION )                   : <TAB  ;LRUD  1- -8 AND ;  ( PREVIOUS TABULATION)              : <_|   L_DN L_BEG    ;   ( CARRIGE RETURN L_DN L_BEG )         : APOS  ;LRUD  0 AND ;    ( HOME POSITION OF CURSOR)                                                                                                                                                                                                                                                                                                                                            : >EL 1K L2 - 1L MIN ; : EL >EL BLANK ; : RDRC RDR CHANGE ;     : DELL P2 SWAP L2 CMOVE L2 +  EL RDRC ; : OVTC POS^ C! CHANGE ; : >INSL P2 L2 TO CMOVE EL ; : INSL >INSL RDRC ;                 : POSC POS^ DUP 1+ ; : INSC INS IF POSC LL TO CMOVE THEN OVTC ; : DELC POSC SWAP LL CMOVE bl /LINE C! LDRAW CHANGE ;            : _INS [ 75 2 PACK ]  LITERAL UNPACK GOTOXY                        INS 0= DUP TO INS IF ." INS" ELSE ." OVT" THEN  ;              : BS <- DELC ;   : /EDIT SAVEBLK FLUSH ;                        : X-POS 0 18 GOTOXY OLD_RP RP! ;                                : Q/ED  /EDIT  X-POS ;                                        : L 959 XY U< IF 1 LB 0 TO XY THEN                                  XY 1L < IF WIPE THEN <_|                                        0 WORD COUNT 1L MIN LINE/   SWAP CMOVE ;                      CREATE CTRLS 30 C,                                                                                                            ( ESC  ^S ^E ^H ^D ^N ^B ^L ^I ^M ^J ^K ^W ^X ^Y ^C ^V ^Q )     CTRL [ C,  CTRL S C,  CTRL E C,  bs C,      CTRL D C,           CTRL N C,  CTRL B C,  CTRL L C,  CTRL I C,  CTRL M C,           CTRL J C,  CTRL K C,  CTRL W C,  CTRL X C,  CTRL Y C,           CTRL C C,  CTRL V C,  CTRL Q C,  CTRL Z C,                          80 C,      77 C,      75 C,      72 C,      83 C,               79 C,      71 C,      73 C,      81 C,      82 C,               15 C,                                                       \  G  -  ˆ‡’ˆ‚€ …„  ˆ ƒŽ €™€ ‚ ‘’ˆƒŽ‚ˆŸ ‘’…Š              \  P  -  PASTE ‚ŒšŠ‚€ …„ € ŒŸ‘’Ž’Ž € Š“‘Ž€                 \  C  -  ŠŽˆ€… € …„ Œ…‘’ˆ Š“‘Ž€ ??  ’…Š‘’š’ … ‚ ‘’ ‘’Š   : P ( "T NIP 0; >INSL POS^ "POP RDRC) ;                         : C ( POS^ >EL L_DN "PUSH) ;                                    : G C L_UP DELL ;                                               : N 1 LB RLD ;  : B -1 LB RLD ;                                                                                                ( ESC  ^S ^E ^H ^D ^N ^B ^L ^I ^M ^J ^K ^W ^X ^Y ^C ^V ^Q )                                                                       : ESQ/E EMPTY-BUFS X-POS ;                                                                                                      CREATE OPER1 ]                                                Q/ED    INSL    DELL    BS      DELC  ( CONTROLS)               N       B       RLD     TAB>    <_|                             <-      ->      WIPE    G       _INS  ( G-NOP )                 C       P       ESQ/E   APOS  ( C=NOP1 P=NOP2 )                                                                                 L_DN    ->      <-      L_UP    DELC  ( FUNCTION KEYS)          L_END   L_BEG   B       N       _INS                            <TAB    [                                                                                                                                                                                                                                                       | : XKBD PUSH  CTRLS COUNT POP SCAN 1+ ?DUP                           IF 1- 2* OPER1 + AT EXEC THEN  ;                          TO FORTH                                                        : E  SCR RLD _INS _INS  RP@ TO OLD_RP                               BEGIN POSXY KEY DUP B>W                                            IF B>W DUP 32 U<                                                    0= IF  INSC  LDRAW ->  ELSE  XKBD THEN                      ELSE TO B>W XKBD THEN                                        AGAIN   ;                                                   : EDIT PAGE TO SCR  E ;                                         : HELP SCR PUSH TO SCR E  POP  TO SCR  E ;                      : ERR CSP TO XY SCR EDIT ;                                      F83 ONLY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         \ PROC: TEST                                                                                                                   : TEST ;                                                                                                                        FUNC: FAC ( N )                                                   N  2 < IF 1 RETURN THEN                                         N N 1- FAC * ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : LAST. AT CURRENT CR DUP H. ID. ;                                                                                                55 LOAD \ ALIASES                                               62 LOAD \ CONTROL                                               67 LOAD \ FORGET                                                70 LOAD \ PRUNE                                                 69 LOAD \ WORDS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (  EDITOR POSXY WIPE RELOAD SAVEBLK LB N B ARROW)               F83  TO FORTH \ VOCABULARY EDITOR                               ( ONLY FORTH ALSO  EDITOR  ALSO DEFINITIONS)   0 VALUE XY        -HEADERS   0 VALUE CHG     0 VALUE INS   0 VALUE OLD_RP        : ~CHANGE 0 TO CHG ;     :  CHANGE 1 TO CHG ;                   : ?XY 1L U/MOD  8 2 TO + ; : POSXY XY ?XY GOTOXY ;              : /L 1L 1- OR ; ( LINE END) : L/ 1L NEGATE AND ;  ( LBEGIN)     : RDR HOME PAD .BLOCK ;   : LINE/ PAD XY L/ + ;                 : LDRAW POSXY LINE/ cr EMIT XY 1L / .LINE ;                     : WIPE ; \ : WIPE PAD 1K BLANK CHANGE RDR ;                     : RLD SCR BLOCK PAD 1K CMOVE ~CHANGE RDR ;                      : SAVEBLK CHG IF PAD SCR BLOCK 1K CMOVE UPDATE ~CHANGE THEN ;   : LB SAVEBLK SCR + TO MAX TO SCR ;                              : L2 1K  XY - 1L - TO MAX ;      : POS^ PAD XY + ;              : /LINE PAD XY /L + ;         : LL /LINE POS^ - ;               : P2 POS^ DUP DUP 1L + ;                                        ( COPY POS^ LINE/ /LINE LDRAW EL INSC DELC OVTC INSL DELL LL  ) : ;LRUD  XY EX 1K 1- AND TO XY ;                                : L_UP  ;LRUD  1L - ;     ( LINE UP)                            : L_DN  ;LRUD  1L + ;     ( LINE DOWN)                          : L_END ;LRUD  /L ;       ( LINE END)                           : L_BEG ;LRUD  L/ ;       ( LINE BEGIN)                         : ->    ;LRUD  1+ ;       ( MOVE 1 CHAR RIGHT)                  : <-    ;LRUD  1- ;       ( MOVE 1 CHAR LEFT)                   : TAB>  ;LRUD  7 OR 1+ ;  ( NEXT TABULATION )                   : <TAB  ;LRUD  1- -8 AND ;  ( PREVIOUS TABULATION)              : <_|   L_DN L_BEG    ;   ( CARRIGE RETURN L_DN L_BEG )         : APOS  ;LRUD  0 AND ;    ( HOME POSITION OF CURSOR)                                                                                                                                                                                                                                                                                                                                            : >EL 1K L2 - 1L MIN ; : EL >EL BLANK ; : RDRC RDR CHANGE ;     : DELL P2 SWAP L2 CMOVE L2 +  EL RDRC ; : OVTC POS^ C! CHANGE ; : >INSL P2 L2 TO CMOVE EL ; : INSL >INSL RDRC ;                 : POSC POS^ DUP 1+ ; : INSC INS IF POSC LL TO CMOVE THEN OVTC ; : DELC POSC SWAP LL CMOVE bl /LINE C! LDRAW CHANGE ;            : _INS [ 75 2 PACK ]  LITERAL UNPACK GOTOXY                        INS 0= DUP TO INS IF ." INS" ELSE ." OVT" THEN  ;              : BS <- DELC ;   : /EDIT SAVEBLK FLUSH ;                        : X-POS 0 18 GOTOXY OLD_RP RP! ;                                : Q/ED  /EDIT  X-POS ;                                        : L 959 XY U< IF 1 LB 0 TO XY THEN                                  XY 1L < IF WIPE THEN <_|                                        0 WORD COUNT 1L MIN LINE/   SWAP CMOVE ;                      CREATE CTRLS 30 C,                                                                                                            ( ESC  ^S ^E ^H ^D ^N ^B ^L ^I ^M ^J ^K ^W ^X ^Y ^C ^V ^Q )     CTRL [ C,  CTRL S C,  CTRL E C,  bs C,      CTRL D C,           CTRL N C,  CTRL B C,  CTRL L C,  CTRL I C,  CTRL M C,           CTRL J C,  CTRL K C,  CTRL W C,  CTRL X C,  CTRL Y C,           CTRL C C,  CTRL V C,  CTRL Q C,  CTRL Z C,                          80 C,      77 C,      75 C,      72 C,      83 C,               79 C,      71 C,      73 C,      81 C,      82 C,               15 C,                                                       \  G  -  ˆ‡’ˆ‚€ …„  ˆ ƒŽ €™€ ‚ ‘’ˆƒŽ‚ˆŸ ‘’…Š              \  P  -  PASTE ‚ŒšŠ‚€ …„ € ŒŸ‘’Ž’Ž € Š“‘Ž€                 \  C  -  ŠŽˆ€… € …„ Œ…‘’ˆ Š“‘Ž€ ??  ’…Š‘’š’ … ‚ ‘’ ‘’Š   : P "T NIP 0; >INSL POS^ "POP RDRC ;                            : C POS^ >EL L_DN "PUSH ;                                       : G C L_UP DELL ;                                               : N 1 LB RLD ;  : B -1 LB RLD ;                                                                                                ( ESC  ^S ^E ^H ^D ^N ^B ^L ^I ^M ^J ^K ^W ^X ^Y ^C ^V ^Q )                                                                       : ESQ/E EMPTY-BUFS X-POS ;                                                                                                      CREATE OPER1 ]                                                Q/ED    INSL    DELL    BS      DELC  ( CONTROLS)               N       B       RLD     TAB>    <_|                             <-      ->      WIPE    G       _INS  ( G-NOP )                 C       P       ESQ/E   APOS  ( C=NOP1 P=NOP2 )                                                                                 L_DN    ->      <-      L_UP    DELC  ( FUNCTION KEYS)          L_END   L_BEG   B       N       _INS                            <TAB    [                                                                                                                                                                                                                                                                                                                                                                                       | : XKBD PUSH  CTRLS COUNT POP SCAN 1+ ?DUP                           IF 1- 2* OPER1 + AT EXEC THEN  ;                          TO FORTH                                                        : E  SCR RLD _INS _INS  RP@ TO OLD_RP                               BEGIN POSXY KEY DUP B>W                                            IF B>W DUP 32 U<                                                    0= IF  INSC  LDRAW ->  ELSE  XKBD THEN                      ELSE TO B>W XKBD THEN                                        AGAIN   ;                                                   : EDIT PAGE TO SCR  E ;                                         : HELP SCR PUSH TO SCR E  POP  TO SCR  E ;                      : ERR CSP TO XY SCR EDIT ;                                      F83 ONLY                                                                                                                                                                                        \    -HEADERS                                                   \             VARIABLE %!%                                      \ ' HEADER 6 + CONSTANT %?%                                     \ :  #% @ IF %!% %?% VSWAP THEN TO VSWAP ;                      \      HEADERS                                                  \ : <%  0 %!% ! %?% #% ;    ( START HI - CODE WITH NAMES)       \ : %>  %!% #% ;            ( END HI - CODE)                    | : >BASE CREATE C, IMMEDIATE DOES> BASE PUSH C@ TO BASE                  BLWORD  NUM ?? ?LITERAL POP TO BASE ; IMMEDIATE         16  >BASE $    10  >BASE #   2 >BASE %                           PRUNE           EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         33 LOAD                                                         35 LOAD ( MACRO)                                                                                                                -HEAD  2 ATTR C!                                                                                                                  34 LOAD    \ NUMBURS.  STRINGS                                  44 LOAD \ STRINGS                                               25 30 THRU \ EDITOR                                                                                                                                                                                                                                                                                                                                                                           ( PAD WITHIN ?BLK >ROW \ )                                      : PAD HERE 320 + ;                                              : WITHIN OVER - PUSH - POP U< ;                                 : ?BLK 1 32768 WITHIN ;                                         : >ROW 1L 1- OR 1+ ;                                            : \ ?BLK  IF >IN >ROW TO >IN                                           ELSE -1 WORD DROP THEN ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   PAD SPACES #S SIGN D# D.R D. .R . U.                        : UM/MOD TUCK U/MOD PUSH  SWAP TO U/MOD POP ;                   : S# 0 BEGIN 1+ PUSH BASE UM/MOD 2DUP OR POP SWAP                               ~UNTIL -ROT 2DROP ;                             : D# IF DABS S# 1+ PUSH -10 POP EXIT THEN S# ;                  : D.R PUSH D# POP OVER - SPACES  FOR ALPHA EMIT NEXT ;          : D. S>D 0 D.R SPACE ;                                          : . S>D D. ;                                                    : U. 0 D. ;                                                     : .R PUSH S>D S>D POP D.R ;                                     : U.R  0 0 ROT D.R ;                                            : UD. 0 0 D.R SPACE ;                                           : UD.R 0 SWAP D.R ;                                            : .. BASE PUSH 6 .R SPACE POP TO BASE ;                                                                                                                                                         -MAC                                                             MAC: >R PUSH ;                                                  MAC: R> POP ;                                                   MAC: R>M AT 2/ ;         \  MAC: NOT -1 XOR ;                   MAC: 2^ TO SHIFT ;                                              MAC: U/ U/MOD NIP ;         MAC: UMOD U/MOD DROP ;              TO MAC: ! ;THEN EXIT THEN!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \   EXPECT3                                                     TO HIDDEN  FORTH  ALSO                                                                                                          FUNC: EXPECT3 ( _ADR _CNT / _IND _K )                             BEGIN  KEY B>W DUP TO _K                                         CASE                                                              cr OF  _IND  TO _CNT ENDOF                                      bs OF _IND                                                        IF AT _IND 1-! bs EMIT SPACE bs EMIT THEN ENDOF               #LEN _K U< IF _K  _ADR  AT _IND @1+! + C! _K EMIT THEN        ENDCASE     _IND _CNT =                                        UNTIL _IND TO SPAN ;                                          \ : TIB? BLK 0= ;                                                 1 2 +THRU     ;METHOD                                                                                                                                                                         \ FREAD  - READ FILE OF TEXT  TO BLOCKS                         \ 210 LOAD  \ EXPECT3                                           FUNC: FREAD ( _NBLK / _ADR _LIN _BLK _HND )                       HANDLES TO _HND  BLK TO _BLK   FOPEN TO HANDLES FIO -1 TO BLK   BEGIN  _LIN  1H 1- =                                              IF AT _NBLK 1+!  0 TO _LIN  0 TO _ADR THEN                           _ADR 0=                                                    IF _NBLK BLOCK DUP 1K BLANK  UPDATE TO _ADR  THEN _LIN          IF _ADR 1L   EXPECT3 CR  THEN                                   1L AT _ADR +!  AT _LIN 1+!                                      _HND  HANDLES =                                               UNTIL   FLUSH  _BLK TO BLK  _NBLK 1+ TO SCR  ;                                                                                                                                                                                                                                                                                \ STREEM EVALUATION  - SEVAL   USING EXPECT3                  \\VARIABLE LINES  |                                               : OK? BLK IF CO CR ;THEN CR ." ><o " CO SPACE ;                 | : 1LINE OK?  0 TO >IN  TIB 80 EXPECT3 CO                              TIB SPAN + TO 0 TO INTERPRET ;                          | : ?IO DUP NOT IF SIO ;THEN FIO ;                              | : FOPEN HANDLES bs - 0= ?? FOPEN DUP 0< A" OPEN ERR" ;        FUNC: SEVAL ( _HANDLE _NBLK / _IN _BLK _TIB _HND _LINE )           >IN TO _IN   BLK TO _BLK  TIB TO _TIB                           RP 84 - DUP  TO RP  TO TIB    HANDLES TO _HND                   _HANDLE TO HANDLES   _NBLK TO BLK                              BEGIN   AT _LINE 1+!  1LINE  _HND  HANDLES =  UNTIL             _BLK ?IO TO BLK  _TIB TO TIB _IN TO >IN  _LINE LINES +! ;     : ;S HANDLES 0; AT HANDLES BLK 1+ 0= IF CLOSE THEN DROP ;       : FLOAD FOPEN  -1 ?IO SEVAL ;  : KBD  0 0 ?IO SEVAL ;           PRUNE                                                           \ LOCAL VARS - MACROSES                                                                                                           MAC: CADR 7 FRM @ SWAP 8 * -; MAC: SADR CADR 2+ , ];            MAC: LOC/ [ 6 FRM , ];        MAC: /LOC [ 1 FRM , ];            MAC: LADR CADR , ];           MAC: ^ADR CADR 4 + , ];           MAC: L1@ [ 1 LADR;   MAC: L1! [ 1 SADR;   MAC: L1 [ 1 ^ADR;     MAC: L2@ [ 2 LADR;   MAC: L2! [ 2 SADR;   MAC: L2 [ 2 ^ADR;     MAC: L3@ [ 3 LADR;   MAC: L3! [ 3 SADR;   MAC: L3 [ 3 ^ADR;     MAC: L4@ [ 4 LADR;   MAC: L4! [ 4 SADR;   MAC: L4 [ 4 ^ADR;     MAC: L5@ [ 5 LADR;   MAC: L5! [ 5 SADR;   MAC: L5 [ 5 ^ADR;     MAC: L6@ [ 6 LADR;   MAC: L6! [ 6 SADR;   MAC: L6 [ 6 ^ADR;     MAC: L7@ [ 7 LADR;   MAC: L7! [ 7 SADR;   MAC: L7 [ 7 ^ADR;     MAC: L8@ [ 8 LADR;   MAC: L8! [ 8 SADR;   MAC: L8 [ 8 ^ADR;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \  (CELL SIZE LEN STRING  WORDS) STRINGS.TX  STR  TO STR=S!     \ STR (A - A' N)=WCOUNT  TO STR ( A1 N A2 - )  = S!             \ TO HIDDEN                                                                                                                       : S+C! ( C A - ) SWAP PUSH RP 1 ROT  AT STR RDROP ;             : "T SPTR STR ; ( -- A N )   : "N SPTR STR + STR ;              : "DROP "T + TO SPTR ;                                          : "POP ( A --) "T ROT SWAP CMOVE "DROP  ;                       : "ALLOT ( N -- N A )  DUP 2+ AT SPTR TO @+! ;                  : "BUFF  ( C N -- ) "ALLOT ! "T ROT FILL ;                    : "PUSH  ( A N -- ) "ALLOT OVER PUSH 2+ SWAP MOVE POP SPTR ! ;    : "INS   ( A N -- ) "T PUSH TO SPTR "PUSH POP SPTR +! ;       | : ?INS" ( C -) CREATE C, DOES> PUSH SP POP C@ "INS DROP ;       1 ?INS" C"INS       2 ?INS" W"INS                             -->                                                                                                                               \ AT STR ( A1 N A2 - )  = S+!                                 : ">' SPTR "DROP COUNT OVER C! ;    : NUP PUSH DUP POP ;        : 2REV DUP PUSH NUP REVERCE NUP REVERCE POP REVERCE ;           : "SWAP SPTR 2 FOR DUP STR + NEXT 2REV ;                        : "CUT ( N --) "T ROT 2DUP 0 WITHIN 0= IF DROP DUP THEN ( A N N)  -ROT PUSH 2DUP + 2- TO SPTR SWAP "PUSH POP SPTR @ - "T + ! ;  : "+ "SWAP "T "DROP "INS ;   : '>" COUNT "PUSH ;                : =' C" " WORD '>" ">' ;     : =" =' COUNT ;                    : "EVAL "PUSH 0 1 "BUFF "+ "T DROP EVAL "DROP ;                 : "OVER "N "PUSH ;  : "NIP "SWAP "DROP ;                        : "DEL SWAP "CUT "SWAP "CUT "DROP "+ ;                          : "INSERT "CUT "SWAP "INS "+ ;                                                                                                   0. "PUSH  0.  "PUSH    ( EMPTY STACK ELEMENT )  \   TO FORTH                                                                                                                                   \   BARY PAD SPACES <# #> # #S SIGN D# D.R D. .R . U.           : DIG. ALPHA EMIT ;  : PAD HERE 320 + ; : 1H. 1H 1- AND DIG. ;    : SPACES TO MAX FOR SPACE NEXT ;     : 1B. 1H /MOD 1H. 1H. ;  : 1W. UNPACK 1B. 1B. ;  : 1D. 1W. 1W. ;    : .H 1W. SPACE ;       : UM/MOD TUCK U/MOD PUSH  SWAP TO U/MOD POP ;                   : 1# BASE UM/MOD  AT HLD 1+! ;                                  : S# AT HLD  OFF BEGIN 1# 2DUP OR -UNTIL 2DROP ;                : D# IF DABS S# -10 AT HLD 1+! EXIT THEN S# ;                   : D.R PUSH D# POP HLD - SPACES HLD FOR DIG. NEXT ;            : D. S>D 0 D.R SPACE ; : . S>D D. ; : .R PUSH S>D S>D POP D.R ; : U.R  0 0 ROT D.R ; : UD. 0 0 D.R SPACE ; : UD.R 0 SWAP D.R ;  : #>" S# HLD "ALLOT ! "T CNTDO DO ALPHA I C! LOOP ; : U. 0 D. ; : N>" 0 #>" ;                                                   : A>" BASE PUSH HEX N>" N>"  C" : C"INS  "+  POP TO BASE ;                                                                                                                                      : #>" S# "ALLOT ! "T CNTDO DO ALPHA I C! LOOP ;   : N>" 0 #>" ; : A>" BASE PUSH HEX N>" N>"  C" : C"INS  "+  POP TO BASE ;      : "P>OS "PUSH bl C"INS "+ ">' SHELL ;  : FED " EDT" '>" "P>OS ; : REMOVE " DEL" '>" "P>OS ;         | : CMD0  CREATE =" 'STR, ;   | : CMD1N CMD0 DOES> '>" ?CS: A>" "T "DROP "P>OS ;              | : CMD2" CMD0 DOES> '>" =" "P>OS ;                             CMD2" DOS COMMAND /C"   CMD2" ED EDT"                           CMD2" DIR DIR /O"       CMD2" DEL DEL"                          CMD2" CD CD"            CMD2" RD RD"                            CMD2" REN REN" ( CMD1" CLS CLS")                                CMD2" ATEST ..\AFD.COM"                                         CMD1N $TEST ..\AFD.COM"                                       : '$ ' @ $TEST ;                                                \ PRUNE                                                                                                                                                                                         -MAC FORGET REG                                                  0 VALUE REG   MAC: PUSH >R ;   MAC: POP R> ;                   TO MAC: ! ;THEN EXIT THEN !     MAC: RDROP POP DROP ;           MAC: NOT -1 XOR ;      : NEW0; DUP -IF RDROP THEN ;             : IN+ >IN + TO >IN ;   : SOURCE BLK AT NBLK >IN + AT MAC ;      FUNC: ?WS ( A1 L1 ) A1 L1 FOR COUNT 33 U<                             -IF DROP R@ NOT L1 + RETURN THEN NEXT DROP L1 ;           FUNC: ?NWS ( A1 L1 D1 / C1 ) A1 L1 DUP TO C1 FOR COUNT D1 =           IF R@ TO C1 LEAVE THEN NEXT DROP C1 NOT L1 + ;            \ EXIT  !!                                                      : PARSE TO REG SOURCE NEW0; REG 33 U<                                IF ?WS IN+ SOURCE NEW0; THEN  REG ?NWS                          DUP 0< IF DROP SOURCE DUP IN+ ;THEN                          PUSH SOURCE  1+ IN+ POP ;                                                                                                                                                                     F83 ONLY HIDDEN ALSO      ( \   REMARK  - COMMENT)                FORTH DEFINITIONS                                             \ : /LOCALS COMPILE [ 1 FRM , ] ; IMMEDIATE                       TO HIDDEN                                                     |  : ?END >IN PUSH BLWORD COUNT 1-     IF DROP -1 ELSE C@ THEN       SWAP COUNT  ROT SCAN 1+ DUP IF RDROP ELSE POP TO >IN THEN    ;                                                             |  : 1VAR DUP 1 9 WITHIN                                              IF LIT [ 7 FRM @ , ] SWAP AT 2* NEGATE + ALIAS                  ELSE HEADER 2 FRM W, W, W, 2* NEGATE , IMMEDIATE THEN       ;                                                               MAC  CSP!      39 LOAD  \ LOCALS BY MACRO                                                                                       MAC: LVAR  ['] 1VAR >MAC ;                                    -->                                                                                                                                                                                             |  : (ARGS  1 769 LOC/                                              BEGIN 0" /)" ?END DUP 2 < ( 0 WRD 1 /)                          WHILE IF L1@ IF 0 L1! ELSE 1 A" / >1 ?" THEN                          ELSE  L2@ 1+ DUP L2!  LVAR  L1@                                    IF L3 ELSE L4 THEN    1+!                                    THEN                                                      REPEAT DROP  L3@ L4@ PACK /LOC                                ;                                                               ?CSP TO MAC      TO FORTH                                                                                                        -->                                                                                                                                                                                                                                                                                                                                                                                          \  : LOCALS( (ARGS COMPILE [ 0 FRM , ] ,  ; IMMEDIATE                        TO FORTH                                           \  : ':  HEADER DO: ;                                           \  : : MAC CSP! : TO CO ?CSP TO MAC ;                           \  : :: :  RECOVER  ['] INTERPRET STR , @ , ;                                                                                       8 FRM ALIAS RETURN  ( DEFINE RETURN PROCEDURE )               : FUNC: : RECOVER  ( MOVE H BACK 1 CELL TO CLEAR XNEST)           C" ( BLWORD 1+ C@ =? (ARGS                                          COMPILE [ 5 FRM @ , ] ,    TO CO                                RECOVER ( EXIT TOKEN )   COMPILE RETURN  ;                 F83                                                                                                                                                                                                                                                          : EXECUTE PUSH ;                                                 : 1Z, 0 C, ;                                                    : N>LINK N>C 2- ;                                               : OFF 0 SWAP! ;                                                 : ON -1 SWAP! ;                                                 : ALIGN 1- SWAP 1- OR 1+ ;                                                                                                      ' IOV @ ' SCRH TO @ 1- SWAP 1- SWAP 3 MAKER QUAN ,              ' bl @ 1 MAKER CONSTANT ,                                       ' SCRH TO @ 2 MAKER VALUE ,                                     ' INITW TO @ 2 MAKER VECTOR ,                                                                                                    HERE VALUE THERE   ' H.  VECTOR  `.                             : T|H HERE THERE TO HERE TO THERE ;                                                                                                                                                            1024  CONSTANT 1K                                              32768  CONSTANT #SIGN                                            1028  CONSTANT B/BUF                                            16    CONSTANT 1H                                               31    CONSTANT #LEN                                             64    CONSTANT 1L                                                                                                                HERE TO THERE   15000 ALLOT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( FLOAD CONTROL.TX  1                                          : CS! AT ON; @  TO ON; ; : ?CS ON; AT ON; @  - A" CS CHG!"  ;   : CSP! CSP SP TO CSP ; : ?CSP SP CSP - A" SP CHG!" TO CSP ; )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ' 0        2+       ALIAS OFF                                   ' -1       2+       ALIAS ON                                    \ ' ("       4 +      ALIAS ".                                   ' ><               ALIAS FLIP                                   ' ><      2+       ALIAS @XCHG                                  ' ><      4 +      ALIAS REVERCE                                ' MAX     2+       ALIAS 0MAX                                   ' COUNT   2+       ALIAS WCOUNT                                 ' ABS     2+       ALIAS DABS                                   ' SCLST   2+       ALIAS SCIND                                  ' SCAN    2+       ALIAS SCANW                                  ' NBLK    2+       ALIAS WBLK                                   '  NBLK   4 +      ALIAS VBLK                                   ' FOPEN   2+       ALIAS OPEN                                   ' CLOSE   2+       ALIAS FCLOSE                               -->                                                               ' EXEC    2+       ALIAS ?EXEC                                  '  EXEC   4 +      ALIAS PERFORM                                ' WORD    2+       ALIAS BLWORD                                 ' D,      2+       ALIAS DCOMPILE                               '  D,     4 +      ALIAS DLIT                                   ' ,       2+       ALIAS COMPILE                                '  ,      4 +      ALIAS LIT                                    ' C,      2+       ALIAS BCOMPILE                               '  C,     4 +      ALIAS BLIT                                   ' RP      2+       ALIAS RP!                                    '  (DO    4 +      ALIAS CNTDO                                  ' LEAVE   2+       ALIAS 4TH>                                   ' OVER    2+       ALIAS 2OVER                                  ' CMOVE   2+       ALIAS CMOVE>                                                                                                  -->                                                            '  CMOVE  4 +      ALIAS MOVE                                   ' NEGATE  2+       ALIAS DNEGATE                                '  DUP    4 +      ALIAS TUCK                                   ' +       2+       ALIAS D+                                   \  '  +      4 +      ALIAS +!                                    ' ROT     2+       ALIAS -ROT                                   '  ROT    4 +      ALIAS ROLL                                   ' DROP    2+       ALIAS 2DROP                                  '  DROP   4 +      ALIAS RDROP                                  ' DUP     2+       ALIAS 2DUP                                   ' SWAP    2+       ALIAS 2SWAP                                  ' 1-      2+       ALIAS 1-!                                    '  1-     4 +      ALIAS 1-!@                                   ' 2-      2+       ALIAS 2-!                                        -->                                                                                                                       \  '  2-     4 +      ALIAS 2-!@                                  ' 1+      2+       ALIAS 1+!                                    '  1+     4 +      ALIAS @1+!                                   \ ' 2+      2+       ALIAS 2+!                                  \ '  2+     4 +      ALIAS @2+!                                 \ ' !       2+       ALIAS 2!                                   ' @       2+       ALIAS 2@                                     ' ALLOT   4 +      ALIAS RECOVER                                ' >MARK   2+       ALIAS >RESOLVE                               ' MIN     2+       ALIAS 0MIN                                   ' UNPACK  2+       ALIAS PACK                                   ' -       2+       ALIAS D-                                     ' 2-               ALIAS V>LINK                                ' XOR      2+       ALIAS XOR!                                  ' XOR       4 +     ALIAS NOT                                   ' IMMEDIATE 4 +     ALIAS SMUDGE                                                                                                : | 1 TO HEADER ;                                               : HEADERS 0  TO HEADER  ;                                       : -HEADERS -1 TO HEADER ;                                                                                                       : NM: NEGATE HERE SWAP [TO] DOES> HERE 2- +! ] ;               (                                                                : M: HERE AT , [ ' WORD @ 1+ DUP @ + 2+ , ] [AT] DOES> ] ;      : JM: M: 5 HERE 2- +! ;                                         : LBL: HEADER COMPILE [ ' INTERPRET 2+ @ , ] ] ;               )                                                               : ( C" ) WORD DROP ; IMMEDIATE     ( nf '("' ; (" (". ". )                                                                                                                                                                                                                                                                                                                                       : -HEAD AT HERE SPTR 8000 - AT VSWAP 2!  HEADERS ;              ' IOV @ 1 MAKER VARIABLE 2Z,                                    ' IOV @ 1 NM: AT 2+ ! ;M 2 NM: AT 2- @ ;M 3 MAKER STACK> ,      ' IOV @ 1 NM: AT 2- ! ;M 2 NM: AT 2+ @ ;M 3 MAKER <STACK ,      : 'STR, DUP C, STR, ;                                           ' (" 2+ 'C ."    ' (" 'C "   ' ABORT 2+ 'C A"                   : ," TO WORD ", ;                                                                                                               T|H                                                             : .( C" ) WORD ". ; IMMEDIATE                                   T|H                                                                                                                              : RESCAN       >IN -FIND ROT TO >IN  NIP 0;                          CR HERE ". ."   EXIST ! "  BLK 1- 0>= 0;                                                                                                                                                       ." IN BLK " BLK `. ;                                                                                                       ' RESCAN TO ?SAME                                                                                                               256 DUP <STACK ON; , ( "," FOR FAST COMPARING BELOW)                                                                            AT FORTH 2- DUP @ SWAP 2- DUP @ SWAP 2- @ 3 MAKER MAKEVOC 2Z,                                                                                                                                   : VOCABULARY TO FORTH MAKEVOC VOCLINK LINK+  ;                                                                                  MAKEVOC MACROS 2Z,                                              VOCABULARY HIDDEN                                               VOCABULARY ASSEMBLER                                                                                                            : .MARK >MARK   ;     ( FOR IFS , SKIPS, WHILES)                : ,.MARK >RESOLVE ;                                             : >LOOP >MARK HERE ;                                            : ,>LOOP , >RESOLVE ;                                           : ,<MARK  ON; , ;                                              : <MARK HERE TO ON; ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' CSP! ALIAS CASE IMMEDIATE                                     ' .MARK       ' (BR (( SKIP                                     ' .MARK    ' (BR 2+ (( IF                                       ' .MARK       ' (FOR (( FOR      ( IN THIS VERSION!!!)          ' ,.MARK   ' (FOR 2+ (( NEXT     ( IN THIS VERSION!!)           ' ,.MARK  ALIAS THEN IMMEDIATE                                  ' <MARK ALIAS BEGIN IMMEDIATE                                   ' ,<MARK       ' (BR (( AGAIN                                   ' ,<MARK    ' (BR 2+ (( UNTIL                                   ' IF ALIAS WHILE IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ' >LOOP        ' (DO (( DO                                      ' >LOOP     ' (DO 2+ (( ?DO                                     ' ,>LOOP       ' (LP (( LOOP                                    ' ,>LOOP    ' (LP 2+ (( +LOOP                                  : REPEAT  [',] AGAIN [',] THEN ; IMMEDIATE                       : ELSE [',] SKIP SWAP [',] THEN ; IMMEDIATE                     ' ELSE ALIAS ENDOF IMMEDIATE                                    : ENDCASE COMPILE DROP BEGIN SP CSP -                           WHILE [',] THEN REPEAT TO CSP ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                      \ ?EMIT ?TYPE DUMPLINE DUMP                                     : >EMIT? 33 127 WITHIN ;                  -HEADERS              | : 'C CREATE [',] C" C, DOES> C@ EMIT ;                          'C `" "     'C `' '     'C `# #                                 'C `[ [     'C `] ]     'C `. .                               |  : ?EMIT DUP bl < IF DROP `. ;THEN EMIT ;                     |  : ?TYPE FOR COUNT ?EMIT NEXT DROP ;                          | : DUMPLINE CR DUP H. 1H  2DUP 2/ FOR WCOUNT SPACE FLIP H.              NEXT DROP SPACE `[ ?TYPE `] ;                            : DUMP 1H ALIGN 1H / FOR DUP DUMPLINE 1H + NEXT DROP ;         : TRACE CR ' TR EXEC -TR ; IMMEDIATE                           : #NUM `# 0 .R SPACE ;    : 'CHAR' `' EMIT `' SPACE ;           : "STR"  `" COUNT ?TYPE `" SPACE ;                              : ?STACK POP WCOUNT SWAP PUSH SP PUSH ?EXEC  POP SP - #NUM ;    : UNNEST POP RDROP RDROP RDROP PUSH ;                                                                                                                                                                                                                            : PREVIOUS AT ORDER# TO CONTEXT ;                               : ALSO CONTEXT TO ORDER# ;                                      : DEFINITIONS CONTEXT TO CURRENT ;                              : ONLY ORDER# OFF TO FORTH ALSO MACROS ALSO HIDDEN ALSO ;       : SPACES 0MAX FOR SPACE NEXT ;                                   : HOME 0 0 GOTOXY ;                                             : PAGE (CLSC HOME ;                                             : .LINE ( 3 .R) `. SPACE 1L ?TYPE ;                             : .BLOCK CR SCR `. 16 0 DO DUP I CR .LINE 1L + LOOP DROP ;                                                                      ONLY                                                                                                                                                                                                                                                            0 VALUE FENCE                                                   : forget DUP FENCE  U< A" fence !" PUSH ( Žƒ€ˆ—ˆ’…‹ - R@ )  BEGIN VOCLINK                                                       ( ‘š„š†€ €„…‘€ € €„…‘€ € €‰-Ž‘‹…„ˆŸ ‘ˆ‘šŠ)            @ ?DUP R@ U<        ( ’Ž‰ Ž-Œ€‹šŠ ‹ˆ … Ž’ ‡€„€„…ˆŸ ?)        ~WHILE @ VOCLINK !                                              REPEAT   ( „ŽŠ€’Ž … … - …Œ€•ˆ ƒŽ ˆ …Œˆˆ ŠšŒ …„ˆ˜…)    VOCLINK  ( ‘‹…„ Š€’Ž ‘€ …Œ€•€’ˆ ‚‘ˆ—Šˆ Ž-ƒŽˆ ‘ˆ‘š–ˆ)     BEGIN DUP 2- ( „€ ‘… €€‚ˆ ‘š™Ž’Ž ˆ ‘ „“Œˆ’… Ž’ Ž‘’€€‹ˆ’…)     BEGIN @ DUP                                                      ( €Œˆ€ ‘… €„…‘€ € €‰-ƒŽ€’€’€ „“Œ€ Ž’ ‘ˆ‘šŠ€)           -->                                                                                                                                                                                                                                                                                                                                                                                               R@ U<           ( - ’Ž‰ Ž-Œ€‹šŠ ‹ˆ … Ž’ ‡€„€„…ˆŸ ?)         ~WHILE N>C 2-     ( - „ŽŠ€’Ž … … - …Œˆˆ ŠšŒ …„ˆ˜…)       REPEAT            ( - €ŠŽ … €Œ…… -v €„Ž‹“)                  OVER 2- !         ( …ƒˆ‘’ˆ€… € €„…‘€ )                    @ ?DUP            ( ’Ž‚€ Ž‘‹…„ˆŸ ‘ˆ‘šŠ ‹ˆ … ?)             ~UNTIL FORTH        ( FORTH -> CONTEXT)                         TO FORTH POP        ( FORTH -> CURRENT)                         TO HERE             ( R> -> HERE )                              DROP ;              ( VOCLINK @ )                               : FORGET ' C>N DROP forget ;                                                                                                    HERE TO FENCE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  : PRUNE VOCLINK                                                  BEGIN DUP PUSH  ( „ŽŠ€’Ž ˆŒ€ Ž™… ‘ˆ‘š–ˆ               )               V>LINK   ( Ž‡ˆ–ˆŽˆ€… ‚š•“ ‘ˆ‘šŠ           )          BEGIN @ DUP   ( „ŽŠ€’Ž ‚ ‘ˆ‘šŠ€ ˆŒ€ Ž™… „“Œˆ        )            HERE U<     ( €ŠŽ €„…‘€ … >= HERE                 )        ~WHILE N>LINK REPEAT  ( ˆƒŽ’‚ˆ ‡€ ˆ‡’ˆ‚€…          )        DUP R@ V>LINK !                                                       ( ‡€ŽŒˆ ‚š‚ ‚š‡‚€’ˆŸ ‘’…Š ‹ˆŠ € „“Œ€ < HERE)              ( ˆ‡’ˆ‰ Š€’Ž Ž‹‡“‚€˜ ŠŽ…€ € ‘’…Š€           )        ?DUP IF DUP PUSH      ( €ŠŽ ‘ˆ‘šŠ€ … €‡… - ‘‹…„‚€™ )        BEGIN N>LINK          ( ‘‹…„‚€™€ „“Œ€                  )                                                                             -->                                                                                                                                                                                        @ ?DUP                ( ˆŒ€ ‹ˆ                         )        WHILE DUP HERE U<     ( „ŽŠ€’Ž „“Œˆ’… ‘€ ‘ €„…‘ < HERE)        IF DUP POP            ( ‘… €‚š‡‚€’ ‚ ‘ˆ‘šŠ        )          N>LINK                ( Ž‘’€€‹ˆ’… ‘… Ž“‘Š€’     )           ! DUP PUSH            (                              )          THEN                  (                             )           REPEAT                (                              )          0 POP N>LINK !        ( …ƒˆ‘’ˆ€ ‘… Š€Ÿ € ‘ˆ‘šŠ€)          THEN                                                            POP @ ?DUP ~UNTIL     ( ‘‹…„‚€™ ‘ˆ‘šŠ)                         -HEAD                                                           ;                                                                                                                                                                                                                                                             : ;SWAP! SWAP OVER @ CO SWAP! ;                                 : +!       ;SWAP! + ;                                           : XOR!     ;SWAP! XOR ;                                         : OR!      ;SWAP! OR ;                                          : AND!     ;SWAP! AND ;                                         : @!  SWAP ;SWAP! -ROT ;                                        : EXCHANGE ;SWAP! @! ;                                                                                                          \ : EXCHANGE  OVER @ @! @! DROP ;                                                                                                                                                                                                                               -->                                                                                                                                                                                                                                                             -HEADERS       0 VALUE    USE   |  0 VALUE    PREV              32768 CONSTANT #SIGN        32767 CONSTANT #SMASK               : UPDATE #SIGN PREV OR! ;   : DISCARD #SMASK PREV AND! ;        -HEADERS                                                        : ?LAST-BUF B/BUF + DUP LIMIT = ;                               : ;?IOERR CO DERR ?DUP   IF CR DISCARD ." ERR I/O " .                    0 TO DERR ABORT THEN                                      PREV 2+ ;                                                    : 'E FIRST DUP TO PREV DUP TO USE LIMIT OVER - ERASE              FIRST BEGIN #SMASK OVER ! ?LAST-BUF UNTIL DROP ;              : +BUF ?LAST-BUF IF DROP FIRST THEN  DUP PREV XOR ;             : ?NEXT-BUF USE DUP PUSH BEGIN +BUF  UNTIL TO USE POP ;            -->                                                                                                                                                                                                                                                          : ?SAVE-BUF DUP @ 0< IF #SIGN OVER XOR! DUP WCOUNT WBLK THEN ;  : BUFFER ?NEXT-BUF ?SAVE-BUF DUP TO PREV ! PREV 2+ DISCARD ;    : 'S FIRST BEGIN ?SAVE-BUF ?LAST-BUF UNTIL DROP ;               \ : -USE SCRH 1+ IF SCRH CLOSE DROP -1 TO SCRH THEN ;           \ : 'F SAVE-BUFS EMPTY-BUFS ;                                   \ : USING FLUSH -USE FOPEN TO SCRH  ;                           | : 'B  ( N -- A) ;?IOERR PREV @ OVER XOR 2* IF  PREV             BEGIN +BUF   0= IF DROP BUFFER 2- WCOUNT NBLK EXIT                  THEN    OVER OVER   @ XOR 2*                                0= UNTIL TO PREV THEN DROP ;                                   : INIT-BUFS  ['] 'B TO BLOCK  ['] 'E TO EMPTY-BUFS                           ['] 'S TO SAVE-BUFS  'E ;                                                                                                                                                                                                                                                                                         \ MACRO ENGINE                                                                                                                   M: DUP BEGIN COUNT  0= UNTIL 1- OVER - ;M                       ( 4 TO HEADER)                                                  0 VALUE MH   : SWAPH HERE MH TO HERE TO MH ;                    M: TO MH AT MACROS ! ;M                                                                                                         M: AT MACROS @ MH ;M   HEADER MAC , , ,  C" ; STACK> MAC:       : MAC> CREATE AT MAC: @ WORD COUNT STR, 1Z, IMMEDIATE                  DOES>  EVAL ;                                           : >MAC SWAPH CURRENT PUSH TO MACROS EXEC POP TO CURRENT SWAPH ;  M: ['] MAC> >MAC ;M    ' MAC: !    : ?MAC ' 2+ AT MAC TYPE ;   M: AT MAC: @ [',] C" AT MAC: ! MAC: AT MAC: ! ;M   ' MAC: 2+ !   : -MAC  0 MPTR TO MAC ;     -MAC                                : MLOAD ['] LOAD CONTEXT PUSH MACROS >MAC POP TO CONTEXT ;                                                                     -MAC                                                             MAC: >R PUSH ;                                                  MAC: R> POP ;                                                   MAC: R>M AT 2/ ;         \  MAC: NOT -1 XOR ;                   MAC: 2^ TO SHIFT ;                                              MAC: U/ U/MOD NIP ;         MAC: UMOD U/MOD DROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ STREEM EVALUATION  - SEVAL   USING EXPECT3                  \\: ;GETBUF ( N -- A )  POP   RP ROT - RP OVER                       TO RP  PUSH SWAP PUSH   CO POP TO RP ;                       VARIABLE LINES  CREATE OK ," ><o  bl C, 15 ALLOT  1 OK +!        -HEADERS    0 VALUE ?HAND  : ?SEOF ?HAND HANDLES = ;           : HAND! HANDLES TO ?HAND  TO HANDLES  0 LINES !  ;              : OK? CR BLK IF CO EXIT THEN OK ". CO SPACE ;                   : 1LINE 1 LINES +! OK?  0 TO >IN  TIB 80 EXPECT  CO                   0  TIB SPAN + C! TO INTERPRET ;                           : ?IO BLK NOT IF SIO EXIT THEN FIO ;                            : FOPEN HANDLES bs - 0= ?? FOPEN DUP 0< A" OPEN ERR" ;          | : SEVAL ( HANDLE NBLK ) ;TI  TO BLK  ?IO                        90 ;GETBUF TO TIB  HAND!  BEGIN  1LINE  ?SEOF UNTIL  ;        : ;S HANDLES 0; AT HANDLES BLK 1+ 0= IF CLOSE THEN DROP ;       : FLOAD FOPEN  -1 SEVAL ?IO ;  : KBD  0 0 SEVAL ?IO ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ 63 64 THRU  \ CONTROL                                         \ 49 LOAD \ FUNC: RETURN LOCALS                                   77 LOAD \ STREEM EVALUATION                                    104 LOAD \ MARKER                                               103 LOAD \ S. R.                                                 31 LOAD \ $ # % <# #>                                          116 LOAD \ SEE                                                 87 101 THRU \ ASSEMBLER                                         \ FLOAD DEBUG.F  CR BLK . .( BLOCK NUMBER)                      \ VOCABULARY ROOT  VOCABULARY CONTROL MARKER -ROOT              \  PRUNE   F83   35 LOAD 116 LOAD                               \ 111 LOAD  \ TARGET COMPILATION                                                                                                                                                                                                                                                                                                  55    LOAD     \ ALIASES                                                                                                        44    LOAD \ STRINGS                                            47    LOAD \ DOS COMMANDS, SHELL                                75 76 THRU \ MACRO ENGINE  + MACROSES                           25 30 THRU                                                      65 LOAD                                                                                                                       \ 83 84 THRU \ RECURCE CO   \ ; :                                 86    LOAD \ .(                                               \ 79    LOAD                                                      2 ATTR C!                                                      \ 67 LOAD \ FORGET      \ 70 LOAD \ PRUNE                       \ 69 LOAD \ WORDS       \ 81 LOAD \ NUMBERS                                                                                                                                                    (   PAD SPACES <# #> # #S SIGN D# D.R D. .R . U.   )             : UM/MOD TUCK U/MOD PUSH  SWAP TO U/MOD POP ;                   : S# 0 BEGIN 1+ PUSH BASE UM/MOD 2DUP OR POP SWAP                               0= UNTIL -ROT 2DROP ;                           : D# IF DABS S# 1+ PUSH -10 POP EXIT THEN S# ;                  : D.R PUSH D# POP OVER - SPACES  FOR ALPHA EMIT NEXT ;          : D. S>D 0 D.R SPACE ;                                          : . S>D D. ;                                                    : U. 0 D. ;                                                     : .R PUSH S>D S>D POP D.R ;                                     : U.R  0 0 ROT D.R ;                                            : UD. 0 0 D.R SPACE ;                                           : UD.R 0 SWAP D.R ;                                            : .. BASE PUSH 6 .R SPACE POP TO BASE ;                                                                                                                                                         \ LOAD EVAL THRU +THRU LIST ?LD --> COPY                                                                                        \ 0 NM: BLK PUSH >IN PUSH EXECUTE POP TO >IN POP TO BLK ;M      \  DUP                                                          \ HEADER LOAD , ] 0 TO >IN  TO BLK ?LD TO INTERPRET [           \ HEADER EVAL , ] 0 TO BLK TIB - TO >IN  TO INTERPRET [           : THRU 1+ SWAP DO I LOAD LOOP ;                                 : +THRU BLK DUP D+ THRU ;                                       : LIST DUP TO SCR BLOCK .BLOCK ;                                : ?LD BLK 0= A" LOADING?" ;                                     : --> ?LD 0 TO >IN BLK 1+ TO BLK ; IMMEDIATE                  : COPY BLOCK SCR BLOCK 1K CMOVE UPDATE ;                                                                                                                                                                                                                                                                                        \ RECURCE CO                                                     ( WITH-ADDR ROOTLINK_ADR WITH-ADDR - )                          M: ( FIXLINX) BEGIN OVER @XCHG ?DUP 0= UNTIL DROP ;M TO ON;     0 NM: AT CURRENT N>C OVER ( FIXLINX) [ >MARK TO ON; ] OFF ;M    1 NM: LINK+ ;M                                                  2 MAKER RECUR ,                                                 ( TO FORTH ( AT RECURCE - FIXLINX)                              0 RECUR RECURCE HERE ON; ! ON; , IMMEDIATE                      M: ON; PUSH ;M ( THIS IS "AT CO")                               M: POP TO ON; AT , [ >MARK TO ON; ] TO ON; ;M                   ' RP 4 + @ ( v-- --v "DO" ">RELEASE" TRICKY WAY)                ( TO HIDDEN)                                                    HEADER CO , , ,  HERE 2- ON; !                                  ( TO FORTH)                                                                                                                                                                                    \ ;  :                                                           ' :  ( !!! VERY SPECIAL )                                      : : MAC  0 TO ON; CS! CSP! : TO CO                                       ?CS TO MAC [TO] RECURCE ;                                                                                               ( EXEC = LAST : )                                              EXEC ; ?CSP [',] ; BEGIN ON; ?DUP                                           WHILE EXEC REPEAT ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : WORDS CR 10 TO CSP CONTEXT -1 0 DO @ ?DUP                      IF DUP                                                             C@ #LEN AND 6 + OUTC + 80 <                                     ~IF CR CSP ?DUP                                                     IF 1- TO CSP                                                    ELSE 10 TO CSP KEY B>W 27 =                                         IF DROP I " LISTED" LEAVE THEN                              THEN                                                        THEN DUP H. DUP ID.                                             1H OUTC OVER MOD ?DUP                                           ~IF DUP THEN - DUP 13 < ~IF DROP 1 THEN                         OUTC 64 < ~IF 1- THEN SPACES                                    N>C 2-                                                       ELSE CR I " TOTAL" LEAVE THEN                                   LOOP ". ."  WORDS = " `. ;                                      F83                                                           : .( C" ) WORD ". ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( assembler    -16528 = -HEAD    control words   )              F83 ONLY ASSEMBLER  ALSO DEFINITIONS \ VOCABULARY  ASSEMBLER    HEX 0 VALUE DISP 0 QUAN FLAGS   ( xxxxxxccOMIAGSDW )            | : SHORT? ( n - f)  -80 80 WITHIN ; : DB, C, ; : DW, , ;       : BEGIN, ( - a) HERE ; | : ?A DUP SHORT? 0= A" SH-ADR?" ;       : ASM-RESET 2 TO FLAGS  0 TO DISP ;  : IF, , BEGIN, ;           : WHILE, IF, SWAP ; : THEN, BEGIN, OVER - ?A SWAP 1- C!  ;      : UNTIL, ( a opc -) C, BEGIN, 1+ - ?A C, ;  1L | WARY BRANCHES  | : ^BRANCH [',] # DUP 1L U< 0= A"  BR#? "  BRANCHES ;          : FB, ^BRANCH DUP @ A" REDEF! " HERE 2+ SWAP! , ;               | : ^< ^BRANCH 0 TO >< ;  : L,F HERE 2+ FB, ;                   : JMP,F E9 C, L,F ;   : CALL,F E8 C, L,F ;  : FB! ^< THEN, ;    : FL! ^< DUP 2- @ OVER - A" LBL? "  HERE OVER - SWAP 2- ! ;     : FBI 1L 0 DO I BRANCHES 0 TO >< IF I . 7 EMIT THEN LOOP ;      : ELSE, EB WHILE, THEN, ; : END-CODE PREVIOUS FBI ?CSP ;        | : 'ASM ASM-RESET ALSO ASSEMBLER CSP! ;   ' 'ASM TO ASM        HEX  ( relative jumps   )                                       | : opc ( opcode -) ( - opcode) CREATE C, DOES> C@ ;            | : ?OPC ( opcode -) ( - opcode) CREATE C, DOES> C@ UNTIL, ;                                                                    73 opc CS,  75 opc 0=,  79 opc 0<,  73 opc U<,  E3 opc CXNZ,    7D opc <,   7E opc >,   76 opc U>,  71 opc OV, : NOT, 1 XOR ;   EB opc -?,                                                      ( the rest can be made by following above with NOT, )           E2 ?OPC   LOOP,           E1   ?OPC LOOPZ,                      E0 ?OPC   LOOPNZ,         EB   ?OPC SJMP,                       0<, NOT,  ?OPC JM,   U<, NOT,  ?OPC JB,    ' JB, ALIAS JC,      0<,       ?OPC JNM,       U<,  ?OPC JNB,  ' JNB, ALIAS JNC,     0=, NOT,  ?OPC JZ,      CXNZ,  ?OPC JCXZ,  ' JZ, ALIAS JE,         0=,    ?OPC JNZ,                       ' JNZ, ALIAS JNE,     0 VALUE ?NEXT                                                                                                                   HEX  ( bit-flags and reg seg & r/m defining words )             ( VARIABLE DISP   VARIABLE FLAGS  ( xxxxxxccOMIAGSDW )          ( M=r/m; cc=reg count; I=immediate; A=accumulator; G=seg;)      ( S=imm.size; D=direction;  W=word or byte; O=disp only  )      | : F-SET ( mask -) FLAGS OR TO FLAGS ;                         | : F-CLR ( mask -) -1 XOR FLAGS AND TO FLAGS ;                 | : F-GET ( mask -) FLAGS AND ;                                 | : F-FLIP ( mask - ) FLAGS XOR TO FLAGS ;                      | : <reg> ( a -n) DUP 1+ C@ DUP 1 AND 1 XOR 2* 2* OR F-SET C@ ; | : reg ( 000a000w00rrr000 -) ( - 0000000000rrr000)  CREATE ,         DOES> <reg> 100 AT FLAGS +! ( count regs)  2 F-FLIP  ;    | : seg ( n -) ( -n) CREATE ,  DOES> <reg> 2 F-SET ;            | : r/m ( n -) ( disp - n) CREATE ,                                   DOES> <reg>  2 F-CLR ( D) SWAP TO DISP ;                                                                                                                                                  ( default D is on, r/m clears it, reg flips it, seg sets it)    ( D=0 when r/m field is destination )                           HEX ( R/M & REG are 16bit constants, but reg keeps count )      4000 r/m X/S    4001 r/m X/D    4002 r/m P/S                    4003 r/m P/D    4004 r/m /SI    4005 r/m /DI                    4006 r/m /BP    4007 r/m /BX    C006 r/m ///   ( chg this?)     ( bits 3-5=reg, bit 8=W, bit 9=D flg, bit 12=ACC flg )          CREATE 'REGS                                                    1000 reg AL  0008 reg CL  0010 reg DL  0018 reg BL              0020 reg AH  0028 reg CH  0030 reg DH  0038 reg BH              1100 reg AX  0108 reg CX  0110 reg DX  0118 reg BX              0120 reg SP  0128 reg BP  0130 reg SI  0138 reg DI              0900 seg ES  0908 seg CS  0910 seg SS  0918 seg DS              | CREATE F$  4457 , 4753 , 4941 , 4F4D ,                        : .F ( -) FLAGS 8 FOR 20 R@ 2^ F-GET IF DROP F$ R@ + C@ THEN       EMIT NEXT  100 / 3 U.R ."  regs " ;                          HEX ( REG>R/M  #,  orW  11mod  01mod  10mod  ,DISP BYTE )       ( | : R>M ( reg -r/m( 2/ 2/ 2/ ;)   | : 1REG? 100 F-GET ;         : #, ( n1 - n1) 20 OVER SHORT? 04 AND OR F-SET  ;               : B#,  24 F-SET ; : W#, B#, 4 F-CLR ;                         | : orW ( --opc---   -  --opc--w)  1 F-GET  OR ;                | : orDW ( --opc---  -  --opc-dw)  3 F-GET  OR ;                | : modDISP, ( 2nd - ) 40 F-GET ( ie M)                           IF 80 F-GET ( ie Only) IF C, DISP ,                               ELSE 8 F-GET ( ie G) DISP OR  OVER 7 AND 6 = OR ( ie[BP])       IF DISP SWAP OVER SHORT?                                          IF 40 OR C, C, ELSE 80 OR C,  , THEN                          ELSE ( zero & not seg) C, THEN  THEN ELSE C0 OR C,  THEN ;                                                                  \   DECIMAL  84 LOAD                                            | : NAME? ; IMMEDIATE                                                                                                           ( one byte opcodes with no variables )                          HEX                                                             | : IMM? ( -f) 20 F-GET  ;  | : ACC? ( -f) 10 F-GET ;           | : ,IMM  ( n -) 5 F-GET 4 = IF ( S,-W)  C, ELSE  , THEN ;        : W/ ( -)  1 F-SET  ; ( WORD PTR - the default is byte )      | : 2REGS? ( -f) 308 F-GET DUP 200 = SWAP 108 = OR ;                                                                            HEX                                                             | : M1 ( n -) ( -)  CREATE C, DOES> NAME? C@ C, ASM-RESET ;     98 M1 CBW,  F8 M1 CLC,  FC M1 CLD,  FA M1 CLI,  F5 M1 CMC,      99 M1 CWD,  CF M1 IRET, 90 M1 NOP,  C3 M1 RET,  CB M1 RETF,     F9 M1 STC,  FD M1 STD,  FB M1 STI,  D7 M1 XLAT, 9E M1 SAHF,     F3 M1 REP,  F3 M1 REPZ, F2 M1 REPNZ, AF M1 SCASW, 9F M1 LAHF,   B9 M1 SKIP2,   B1 M1 SKIP1,  AB M1 STOSW,  AD M1 LODSW,         9C M1 PUSHF,   9D M1 POPF,                                      26 M1 ES:   2E M1 CS:   36 M1 SS:   3E M1 DS:                   ( 2 operand instructions such as ADD,  )                        HEX                                                             | : M2 ( n -) ( various - ) CREATE ,                              DOES> NAME? @ PUSH  IMM?                                         IF ACC? IF     DROP  POP orW 4 OR C,                                    ELSE   1REG? IF R>M THEN  80 orW C,                                    POP 38 AND OR  modDISP,                                  THEN  ,IMM                                              ELSE  2REGS?  IF SWAP R>M THEN                                        POP orDW C, OR modDISP,                                   THEN  ASM-RESET  ;                                                                                                           HEX  ( use M2 to define ADD, like instructions )                                                                                10 M2 ADC,  00 M2 ADD,  20 M2 AND,  38 M2 CMP,   08 M2 OR,      18 M2 SBB,  28 M2 SUB,  30 M2 XOR,                              HEX ( MOV,) ( one byte instr w/ W  - the string instructions )  : MOV, NAME? IMM?                                                 IF  1REG?  IF   R>M B0 OR 1 F-GET AT 2*  OR C,                             ELSE C6 orW C, modDISP,    THEN  ,IMM                ELSE 90 F-GET 90 =                                              IF   DROP DROP A0 2 F-FLIP orDW C, DISP ,                       ELSE  2REGS? IF   2 F-GET ( ie D) IF SWAP THEN  R>M  THEN        8 F-GET ( ie G) IF 1 F-CLR 8C ELSE 88 THEN  orDW C,             OR  modDISP,                                                   THEN THEN  ASM-RESET ;                                                                                                        HEX  | : M3 ( n -) ( reg -) CREATE C, DOES> NAME? C@                   orW C, DROP ASM-RESET   ;                                                                                                A6 M3 CMPS,  AC M3 LODS,    A4 M3 MOVS,                         AE M3 SCAS,  AA M3 STOS,    6C M3  INS,   6E M3 OUTS,           ( mul, div, xxxxxxxW  mdNNNr/m ) ( M5 for LDS, LEA, & LES, )    HEX  | : M4 ( n -) ( -) CREATE C,                                DOES> NAME? C@ F6 orW C, SWAP 1REG? IF R>M THEN OR  modDISP,         ASM-RESET  ;                                                                                                              30 M4 DIV,  38 M4 IDIV,  28 M4 IMUL,                            20 M4 MUL,  18 M4 NEG,   10 M4 COM,                                                                                              (  NOT,  is the the Intel name for my  COM,  but it     )       (  would conflict w/ my flag inverter which I call  NOT,)       (  ** be careful ** )                                                                                                          | : M5 ( n -) ( -) CREATE C,                                                  DOES> NAME? C@ C, OR modDISP, ASM-RESET  ;                                                                        C5 M5 LDS,  8D M5 LEA,  C4 M5 LES,                              ( M6 for the rotate & shift instructions )                      HEX                                                             | : M6 ( n -) ( n# r/m | r/m    - ) CREATE C,                    DOES> NAME? C@ IMM? 10 U/  2 XOR  1 F-GET ( ie W) OR D0 OR C,      1REG? IF SWAP R>M THEN OR modDISP,  IMM? IF DROP THEN                 ASM-RESET  ;                                                                                                          10 M6 RCL,   0 M6 ROL,   20 M6 SHL,   18 M6 RCR,                08 M6 ROR,  38 M6 SAR,   28 M6 SHR,                                                                                             ( examples to shift right 1 bit )                               ( 1 #, SI SHR,   1 #,  W-PTR  17 [BX] SHR,   1 #, AL SHR,  )                                                                    ( examples to shift right the # of bits in CL )                 ( SI SHR,  AL SHR,  1300 rt-par SHR,  3752 W-PTR rt-par SHR, )                                                                  HEX ( INC, & DEC, instructions )   ( IN, OUT, instr )           | : M7 ( n -) ( r1 | r/m  -) CREATE C,                             DOES> NAME? C@ SWAP  1REG? IF  ( opc r1) R>M THEN                     1REG? 100 =  1 F-GET AND  ( ie it's a 2-byte register)          IF  ( opc rX)  OR 40 OR C,                                      ELSE  ( opc mem | opc rH | opc rL )                                FE orW C,  OR modDISP,                                       THEN  ASM-RESET  ;                                     08 M7 DEC,   00 M7 INC,                                                                                                         | : M9 ( n -) ( n# r1 | r1  -) CREATE C,                          DOES> NAME? C@  orW NIP                                            IMM? IF ( n# opc)  C, ( n#) ELSE ( opc) 8 OR THEN C,            ASM-RESET ;                                                E4 M9 IN,   E6 M9 OUT,                                                                                                          ( PUSH, & POP, instructions )                                                                                                   HEX                                                             | : M8 ( n -) ( reg | seg | r/m  -)  CREATE ,                      DOES> NAME? @  8 F-GET                                            IF  ( seg opc ) 16/ 1 AND 1 XOR 6 OR OR C,                      ELSE 1REG?                                                      IF  ( reg opc ) 2/ 8 AND 8 XOR 50 OR SWAP R>M OR C,             ELSE ( r/m opc) DUP 100 U/ FF AND C,  OR modDISP,               THEN  THEN  ASM-RESET ;                                                                                                    FF30 M8 PUSH,  8F00 M8 POP,                                                                                                     ( use   port #, AL IN,  or  port #, AX IN,  for 8 bit ports )   ( or    AL IN,  or  AX IN,   for port in the DX register  )     ( do not use AL DX IN, - the DX is implied                )     ( XCHG )  ( TEST, instruction  - almost like ADD, etc. )        HEX                                                             : TEST,  ( various - ) NAME?                                       IMM?                                                            IF ACC? IF     DROP  A8 orW ( 4 OR) C,                                  ELSE   1REG? IF R>M THEN  F6 orW C, ( OR)  modDISP,             THEN  ,IMM                                              ELSE  2REGS?  IF SWAP R>M THEN                                        84 orW C, OR modDISP,                                     THEN  ASM-RESET  ;                                                                                                           : XCHG,  ( reg mem | mem reg | reg1 reg2   -)   NAME?             211 F-GET 211 = ( 2 regs & one is AX)                           IF  ?DUP IF NIP THEN ( r1 ) R>M  90 OR C,                       ELSE  2REGS? IF  R>M  THEN  OR  86 orW C, modDISP,              THEN  ASM-RESET ;                                             ( CALL, instr  ) ( INT,  & segment override instructions )      HEX                                                             : CALL, ( various -) NAME?  IMM?   ( intra-seg direct )           IF  ( n#)  HERE 3 + - ( make it relative)                           E8 C, , ( eg 2389 #, CALL, calls addr $2389)                ELSE                                                                ( mem | reg  -)  1REG?  IF R>M  THEN                            FF C,  10 OR modDISP, ( eg 0 [BX] CALL, or DX CALL, )       THEN  ASM-RESET ;         ( this is intra-seg indirect )                                                                      ( I am not implementing the inter-seg direct)                   ( or indirect versions )                                                                                                        : INT, ( #n -) NAME? $ CD C, C, ASM-RESET ; ( eg 21 #, INT, )                                                                                                                                   ( JMP, instr  &  NXT, )    HEX                                  : JMP, NAME?                                                           ( various -) 140 F-GET ( ie R or M  intra-seg indirect )    IF ( mem | reg  -)  1REG?  IF R>M  THEN                            FF C,  20 OR modDISP, ( eg 0 [BX] JMP, DX JMP, )                                      ( or 3759 rt-paren JMP,  )             ELSE  ( a) HERE 3+ -                                             ( relative) DUP SHORT? IF 1+ EB C, C, ELSE  E9 C,  ,  THEN      ( disp is added to IP, so this is a relative jump )          THEN  ASM-RESET ;                                              : LJMP, ( a -)  E9 C,  HERE 2+ - ,  ;  ( lay down 3byte jump)    ' ORIGIN+ 2+ 2+ @   TO ?NEXT                                   ( I am not implementing the inter-seg direct or indir. versions): NEXT, ( -) ?NEXT JMP, ;                                       PREVIOUS                                                        FORTH                     F83 ( 96 LOAD)                        : FIND PUSH -1 ORDER# WCOUNT                                           FOR WCOUNT @ SWAP NEXT DROP CONTEXT @ POP (FIND TO ?, ;                                                                  :: INTERPRET BL WORD FIND ?DUP IF ?, TO INTERPRET THEN               NUM ?? ?LITERAL TO INTERPRET ;                                                                                             : ?LITERAL DBL 1+  IF SWAP ['] LITERAL  DUP THEN                      DROP ['] LITERAL                                          ;                                                               : LITERAL STATE IF ['] [LIT] THEN ;                                                                                             : (( CREATE , , DOES> WCOUNT , PERFORM ;                                                                                        ' ,  ' LIT ((  [LIT]                                                                                                                                                                            | : #S. CR EMIT  `[ SPACE  OVER SWAP  - 2 / 1-                      DUP 0< A" STACK UNDERFLOW"  FOR 2- DUP @ . NEXT DROP `] ;                                                                     : S. S0 SP C" S #S. ;  : R. R0 RP C" R #S. ;                                                                                  : VOX. VOCLINK BEGIN ?DUP WHILE DUP 8 - C>N DROP                    CR DUP H. ID.  @ REPEAT ;                                   : VOC. CR ." CONTEXT = "  CONTEXT 6 - ?ID.                       CR ." CURRENT = "  CURRENT 6 - ?ID.  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CREATE -MARKER                                                  | : ?IN POP WCOUNT SWAP PUSH >IN PUSH ?EXEC POP TO >IN ;        | : ?EXIST ?IN -FIND NIP ;                                      : MARKER ?EXIST IF ?IN FORGET THEN                                      CREATE DOES> 2- C>N DROP forget ;                       : ORDER. ORDER# WCOUNT FOR WCOUNT 6 - ?ID. NEXT DROP ;            : CLARY HERE OVER ERASE ALLOT ;                                 : BARY HEADER TO , [ ' ORIGIN+ 2+ @ 2+ 2+ , ] CLARY ;           | : ARRAY CREATE , DOES> HEADER  @ ,                                  HERE DUP PUSH 2- EXEC POP - CLARY ;                       ' ORIGIN+ 2+ @ 2+    ARRAY WARY                                 ' ORIGIN+ 2+ @       ARRAY QARY                               MARKER -ASM       ' -ASM @ ' -MARKER !                          0 VECTOR ASM                                                    : CODE HEADER HERE 2+ , ASM ;                                   : ;CODE COMPILE ;code ['] [ ASM ; IMMEDIATE                     HERE 256 ALIGN TO HERE     ASM L: >START CLD, 0 #, JMP,            NOP, 0 #, JMP, SCASW, L: >VAR! BX 2 /DI MOV,                 L: >DROP DROP, -?, IF, SCASW, SCASW,  L: >CONST 2 /DI AX MOV,        -?, IF,  SCASW, SCASW, L: >VAR   2 /DI   AX LEA,   THEN,   L: >PUSH  DUP,  L: >SWAP AX BX XCHG, THEN, L: >MAIN LODSW,      L: >EX AX DI XCHG, 0 /DI JMP, 0 #, JMP, SCASW, SCASW, L: >NEST   2 /DI AX LEA, L: >RPUSH -2 /BP BP LEA, AX 0 /BP MOV,           L: >;: SI 0 /BP XCHG, NEXT, SCASW, SCASW, L: >DOES AX POP, DUP,  2 /DI BX LEA,  >RPUSH JMP,                                     L: >#PUSH  AX POP, BX AX XCHG, L: >ARPH SI AX XCHG, >RPUSH JMP, L: >CALL LODSW, >RPUSH JMP,    L: >F: AX POP, >RPUSH JMP,       L: >RP@ BP AX MOV, >PUSH JMP,  L: >RP! BX BP MOV, >DROP JMP,    L: >SP@ DUP, SP BX MOV, NEXT,  L: >SP! BX SP MOV, >DROP JMP,       L: >PERF 0 /BX BX MOV, L: >EXEC   AX POP, AX BX XCHG,           L: >?EX AX CX MOV, >MAIN JCXZ, >EX JMP,              -->                                                                         1 #, BX SHL,  BX DI ADD,  1 #, BX SHL,                      L: >ARY  1 #, BX SHL,  2 X/D BX LEA, NEXT, L: >F SI POP, NEXT,     L: >BLIT AL LODS, L: >BPUSH 0 #, AH MOV, >PUSH JMP,             L: >DLIT DUP, LODSW, AX BX XCHG,                                L: >LIT   LODSW, >PUSH JMP, L: F> SI JMP, END-CODE           CODE !+    0 /BX POP, L: >2+ 2 /BX BX LEA, NEXT,  END-CODE      CODE @+  0 /BX PUSH, >2+ JMP,  END-CODE                         CODE C!+  CX POP,  CL 0 /BX MOV,  L: >1+ BX INC, NEXT, END-CODE CODE C@+  0 CH MOV, 0 /BX CL MOV, CX PUSH, >1+ JMP, END-CODE    CODE COUNT  0 /BX AL MOV, BX INC, >BPUSH JMP, END-CODE          CODE NIP   AX POP, NEXT,  L: REGA 0 ,  L: CARR 0 ,  END-CODE    CODE A REGA /// AX MOV, >PUSH JMP, END-CODE                     CODE A!  BX REGA /// MOV, >DROP JMP, END-CODE                   HEADER RP! >RP! ,  HEADER RP@ >RP@ ,  HEADER 1+  >1+  ,         HEADER SP! >SP! ,  HEADER SP@ >SP@ ,  HEADER 2+ >2+ ,  -->                                                                      ASM L: ?CARRY CX POP, 1 #, W/ CARR /// SHL, CX CALL,                L: >CARRY  1 #, W/ CARR /// RCR, NEXT,                      L: >IF  BX BX OR, L: >0=IF 0=, IF, L: >JMP 0 /SI SI MOV, NEXT,  L: >UNNEST  0 /BP SI MOV, L: >RDROP  2 /BP BP LEA, NEXT, THEN,                L: >SKIP 2 /SI SI LEA, NEXT,                      L: >IFC  CARR /// AX MOV,  $ 8000 #, AX TEST, >0=IF JMP,        L: >#IF  AX POP, AX BX XCHG, AX AX OR,  >0=IF JMP,              L: >-IF  BX BX OR,  >JMP JNM,  >SKIP SJMP,                      L: >NEXT -1 #, CX MOV,  CX 0 /BP ADD,  >JMP JC,                              2 /SI SI LEA, >RDROP SJMP,                         L: >?FOR  AX POP,  AX BX XCHG,  AX DEC, >JMP JM, 2 /SI SI LEA,             >ARPH JMP,    SCASW,                                 L: >PVAR! 2 /DI DI MOV, BX 0 /DI MOV, >DROP JMP, SCASW, SCASW,  L: >PVECT DUP, 4 /DI BX MOV, >PERF JMP,   SCASW,                L: >VECT 4 /DI AX MOV, >?EX JMP,            END-CODE  -->                                                                       CODE AND   AX POP,  AX  BX AND,  NEXT,  END-CODE                CODE OR    AX POP,  AX  BX OR,   NEXT,  END-CODE                CODE XOR   AX POP,  AX  BX XOR,  NEXT,  END-CODE                CODE 2-   BX DEC,  L: >1- BX DEC, NEXT, END-CODE                CODE INVERT BX COM, NEXT, END-CODE    HEADER 1- >1- ,           CODE U2/C  ?CARRY #, CALL,  1 #, BX RCR, RET, END-CODE          CODE +C   AX POP, ?CARRY #, CALL, AX BX ADC, RET, END-CODE      CODE +    AX POP,  AX BX ADD,  >CARRY JMP, END-CODE             CODE 2*  1 #, BX SHL, >CARRY JMP, END-CODE                      CODE 2/  1 #, BX SAR, >CARRY JMP, END-CODE                      CODE DUP   DUP, NEXT, END-CODE                                  CODE POP   DUP, 0 /BP BX MOV, >RDROP JMP, END-CODE              CODE SWAP  AX POP, >PUSH JMP, END-CODE                          CODE OVER  AX POP, AX PUSH, >PUSH JMP, END-CODE  \ -->             L: >MAIN LODSW,  \ >MAIN TO ?NEXT                                                                                            CODE +*  REGA /// AX MOV, 1 #, AL TEST, 0=, NOT, IF,                   AX POP, AX BX ADD, AX PUSH, THEN,  1 #, BX RCR,                1 #, W/ REGA /// RCR, NEXT, END-CODE                      CODE -/   1 #, W/ REGA /// SHL,  1 #, BX RCL, AX POP,                    AX BX CMP,  AX PUSH,                                       U<, NOT, IF, AX BX SUB, W/ REGA /// INC, THEN,  NEXT,       L: >@PC+ AX AX XOR, CX POP, DUP, SI 0 /BP XCHG, SI BX MOV,          CX CALL, AX SI ADD, >;: JMP,                                L: >@PC' >@PC+ #, CALL, AL LODS, RET, END-CODE                  CODE (DOS AX BX XCHG, CX POP, DX POP, 33 #, INT, DX PUSH,          CX PUSH, BX PUSH, AX PUSH, 1 #, AX RCR, >SWAP JMP, END-CODE  HEADER DROP >DROP ,  HEADER EXEC >EXEC ,  HEADER RDROP >RDROP , HEADER PERFORM >PERF , HEADER NOP >MAIN ,  HEADER PUSH >#PUSH , HEADER EXIT >UNNEST ,  HEADER EX >;: ,                          HEADER X    0 HERE 3 - C!  >UNNEST ,   IMMEDIATE  \ -->                                                                         HEADER +COMP >ARY , >START , >MAIN ,  >CALL ,  >JMP , >UNNEST ,  >IF   ,   >IFC ,   >-IF ,   >NEXT , >?FOR ,   >SKIP ,           >LIT  ,  >BLIT ,  >DLIT ,      >F ,   >F: ,      F> ,           >VAR! , >CONST ,   >VAR ,   >DOES , >NEST ,  >VECT  ,          >PVECT , >PVAR! ,  >PUSH ,  >SWAP , >RDROP ,  >#IF   ,                                                                          ] HEADER [ ' [ , ' ] , ] , C, BLOCK  FLUSH : WORD [ ' ; ,                                                                       -1      +C: #START   +C: #MAIN +C: #CALL +C: #JMP  +C: #EXIT    +C: IF#   +C: #IFC   +C: #-IF  +C: #NEXT +C: #?FOR +C: #AHEAD   +C: #LIT  +C: #BLIT  +C: #DLIT +C: #>F   +C: #>F:  +C: #F>      +C: #VAR! +C: #CONST +C: #VAR  +C: #DOES +C: #NEST +C: #VECT    +C: #PVECT +C: #PVAR! +C: #PUSH  +C: #SWAP +C: #RDROP +C: ##IF  +C: #HEAD  +C: #[    +C: #]    +C: #,    +C: #C,   +C: #BLOCK   +C: #FLUSH +C: #:    +C: #WORD +C: #;    DROP                                                                                   -MAC    PRUNE    MARKER -ROOT PRUNE  F83 ONLY                   VOCABULARY ROOT  VOCABULARY CONTROL  VOCABULARY COMMON          : OLDY ONLY F83                                                  [ ' [LIT] 2+ @ ] LITERAL   [ ' [LIT] 2+ ] LITERAL !  ;         FORTH ALSO   CONTROL ALSO  COMMON ALSO  ROOT ALSO                                                                               <%  TO COMMON     112 LOAD  %>  \ PREPARE TARGET SYSTEM             TO ROOT       105 LOAD      \ KERNEL CODE                   \ <%  TO CONTROL    114 LOAD   %> \ CONTROL FLOW STATEMENTS     \    TO ROOT       129 LOAD      \ OTHER CODE                                                                                      FORTH  OLDY  ROOT            \ OLD STATE OF SYSTEM                                                                                                                                                                                                                                                                           : C: <%  CONSTANT  %> ; : L: HERE C: ;  : +C: 1+ DUP C: ;       : W, WCOUNT , ;         : +JUMP POP + PUSH ;                    \ : X, COMPILE [ ASM SP BP XCHG, END-CODE ] ;                   : DUP, BCOMPILE [ ASM BX PUSH, END-CODE ] ;                     : DROP, BCOMPILE [ ASM BX POP, END-CODE ] ;                     : MAKER CREATE NOT 3 AND 2* DUP C, +JUMP  , , ,  ' ,                    DOES> COUNT HEADER +JUMP W, W, W, AT EXEC ;              54  LOAD   \ CSP! ?CSP                                          62  LOAD   \ .MARK .....                                       \ 113  LOAD   \ ALIASES                                                                                                                                                                            -->                                                                                                                                                                                                                                                                                 FORTH                                     ' FORTH   ALIAS FORTH          ' ROOT    ALIAS ROOT             ' CONTROL ALIAS CONTROL        ' '       ALIAS '                ' LOAD ALIAS LOAD              ' (( ALIAS ((                    ' IMMEDIATE ALIAS IMMEDIATE    ' TO   ALIAS TO  IMMEDIATE       ' \ ALIAS \  IMMEDIATE         ' (    ALIAS (   IMMEDIATE       ' . ALIAS .                    ' H.   ALIAS H.                  ' WORDS ALIAS WORDS            ' ALSO ALIAS ALSO                ' --> ALIAS --> IMMEDIATE      ' [']  ALIAS ['] IMMEDIATE      ' <%  ALIAS <%                  ' %>  ALIAS %>                  ' ALIAS ALIAS ALIAS             ' .BLOCK ALIAS .BLOCK           ' 2Z,   ALIAS 2Z,               ' ,      ALIAS ,                ' COMPILE ALIAS COMPILE         ' [     ALIAS [    IMMEDIATE    ' ]     ALIAS ]                 ' [',]  ALIAS [',] IMMEDIATE    ' $     ALIAS $ IMMEDIATE       ' C"    ALIAS C" IMMEDIATE      ' S.    ALIAS S.                ' "     ALIAS "  IMMEDIATE      : ONLY  ORDER# OFF  COMMON ALSO   CONTROL ALSO  ROOT ALSO           [ #LIT +COMP ] LITERAL   [ ' [LIT] 2+ ] LITERAL !  ;                                                                        : DONEST HEADER COMPILE [ #NEST +COMP @ , ] ]  CSP! ;           : UNNEST   ?CSP COMPILE [ ROOT ] EXIT [',] [ ;                  COMMON ONLY                                                                                 >PVAR! >PVECT 2 MAKER PVECTOR ,     ' DONEST  ALIAS :                                               ' UNNEST  ALIAS ; IMMEDIATE                                                                                                        -->                                                                                                                                                                                                                                                                                                                                                                                          ' .MARK  #JMP +COMP (( SKIP     ' ,<MARK #JMP +COMP (( AGAIN    ' .MARK   #-IF +COMP (( -IF     ' .MARK  #IFC +COMP (( <IF      ' .MARK    ##IF +COMP (( IF     ' .MARK  IF#  +COMP (( #IF      ' <MARK  ' PUSH  (( FOR         ' ,<MARK #NEXT +COMP (( NEXT    ' >LOOP  #?FOR +COMP (( FOR/    ' ,>LOOP #NEXT +COMP (( /NEXT   ' .MARK  #?FOR +COMP (( ?FOR    ' .MARK  #NEXT +COMP (( ?NEXT   ' <MARK ALIAS BEGIN IMMEDIATE   ' ,<MARK ##IF +COMP (( UNTIL    ' ,.MARK  ALIAS THEN IMMEDIATE  ' IF ALIAS WHILE IMMEDIATE                                                                      : REPEAT [',] AGAIN [',] THEN ; IMMEDIATE                       : ;THEN COMPILE EXIT [',] THEN ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                      MARKER -PROBA   0 VALUE SADR  -HEADERS    117 LOAD              : ?N CREATE C, DOES> COUNT SADR 2- @ TO SCAN 1+ ;               : SHOW ." | " SADR @ DUP H. ?WORD ;                                2 ?N IS_1+? ] BLIT BCOMPILE [ 1 ?N IS_3+? ] ;code [            11 ?N  IS_2+? ] (BR TO (BR AT (BR (FOR LIT (OF (DO TO (DO         (LP TO (LP COMPILE [ 2 ?N IS_4+? ] DCOMPILE DLIT [             3 ?N IS_STR? ] TO ABORT (" TO (" [                           | : WW CR SADR H. SHOW  2 SADR+ IS_2+? IF SHOW 2 SADR+ ;THEN        IS_4+?  IF SADR 2@ D. SADR 2@ SWAP H. H. 4 SADR+ ;THEN          IS_3+?  IF SADR C@ . SADR 1+ WCOUNT + H. 3 SADR+ ;THEN          IS_STR? IF SADR DUP "STR" C@ 1+ SADR+ ;THEN                     IS_1+?  IF SADR C@ DUP H. .  1 SADR+ THEN ;                 : L WW WW WW WW WW WW WW ; : @SEE TO SADR L ; : SEE ' @SEE ;    : 'SEE SADR+ SADR N>C DUP TO SADR ?WORD L ; : +SEE SADR+ L ;    : /SEE -14 SADR+ ;  : .SEE SADR PUSH L POP TO SADR ;                                                                                                                                                                                                            : SADR+ SADR + TO SADR ;                                        : C/NUM DUP >EMIT? IF 'CHAR' ;THEN #NUM ;                       : ?STR C>N 0= IF 1 ;THEN      \ CODE TO NAME                           COUNT DUP 31 AND       \ A N  #LEN                              SWAP 96 AND            \ A #LEN  &96                            OVER 0= OR             \ A (1)  ((2)  (1) 0=) OR                IF DROP ;THEN          \ A CNT / A  INVALID LENGTH              FOR COUNT >EMIT?       \ A' C                                     0= IF UNNEST ;THEN   \ A' - UNPRINTABLE CHARACTER             NEXT DUP XOR ;         \ 0  - OK                         : ?WORD DUP ?STR IF C/NUM ;THEN ?ID. ;                                                                                                                                                                                                                          HEADER (JUMP (NEST , ] POP @+ DROP PUSH (UNNEST [               HEADER (-IF (NEST , ] DUP MSB# AND (IF [ HERE 14 + , ]                     DROP POP @+ PUSH DROP (UNNEST   \ SKIP                          DROP POP @+ DROP PUSH (UNNEST [ \ JUMP               HEADER (NEXT (NEST , ] POP @+ POP (IF [ HERE 14 + , ]                     -1  + PUSH DROP PUSH (UNNEST     \ JUMP                               DROP PUSH DROP (UNNEST [   \ SKIP               HEADER (?FOR (NEST , ] POP @+ PUSH SWAP POP SWAP                             (IF [ HERE 14 + , ]                                          -1  + PUSH PUSH DROP (UNNEST     \ SKIP                               DROP DROP PUSH (UNNEST [   \ JUMP               HEADER (IFC (NEST , ] DUP U2/C MSB# AND (IF [ HERE 14 + , ]                DROP POP @+ PUSH DROP (UNNEST   \ SKIP                          DROP POP @+ DROP PUSH (UNNEST [ \ JUMP               : TLOOP 10 ?FOR IND . ?NEXT ;                                   : T2    9  FOR  IND .  NEXT ;                                   \ CREATE (DOES ASM X, SI PUSH, X, SI POP, BX PUSH,              \          2 /DI BX LEA, NEXT, END-CODE                         \ CREATE (NEST ASM (DOES #, CALL, END-CODE ] PUSH (UNNEST [     \ HEADER (LIT (NEST , ] POP @+ PUSH (UNNEST [                   \ CREATE (VAR   ASM (DOES #, CALL, END-CODE ] (UNNEST [         \ CREATE (CONST ASM (DOES #, CALL, END-CODE ] @+ DROP (UNNEST [ CREATE DOVAR    ASM   BX PUSH, 2 /DI BX LEA, NEXT, END-CODE     CREATE DOCONST  ASM   BX PUSH, 2 /DI BX MOV, NEXT, END-CODE                                                                     : OLDY  F83 [ ALSO FORTH ] ONLY [ PREVIOUS ]                     [ ' [LIT] 2+ @ ] LITERAL   [ ' [LIT] 2+ ] LITERAL !  ;         : +* A U2/C DROP IFC OVER + THEN U2/C A U2/C A! ;               : -/ A 2* A! 2*C OVER OVER - IFC DROP ;THEN NIP A1+ ;           : +C IFC 1+ IF +  ;THEN 1+ U2/C DROP ;THEN + ;  : 2*C DUP +C ;  : C-OFF 0 U2/C DROP ; : C-ON -1 U2/C DROP ; : U2/ C-OFF U2/C ;  : 2* DUP + ;   : 2/ DUP 2* DROP U2/C ; : C-? 0 2*C ;            : 1+ 1 + ; : 1- -1 + ;  : INVERT -1 XOR ; : NEGATE INVERT 1+ ;  : >BYTE BYTE# AND ; : COUNT  @+ 1- SWAP >BYTE ;                 : C@ @+ DROP >BYTE ; : C! SWAP >BYTE OVER @ $ FF00 AND OR SWAP! ;  : OVER PUSH DUP POP SWAP ;  : OR OVER INVERT AND XOR ;       : TUCK SWAP OVER ; : NIP SWAP DROP ;                            : -ROT SWAP PUSH SWAP POP ;     : ;: POP POP SWAP PUSH PUSH ;           : A1+ A 1+ A! ;           : @A A @ ;   : !A A ! ;       : REPEAT  [',] AGAIN [',] THEN ; IMMEDIATE                       : ELSE [',] SKIP SWAP [',] THEN ; IMMEDIATE                    HEADER (JUMP LJMP ,   HEADER AHEAD LSKIP ,                      \ ' EXIT ALIAS X IMMEDIATE                                      \ 0 AT CURRENT 1+ C!  \ !!! VERI SPECIAL                        : DONEST HEADER COMPILE [ #NEST ` , ] ]    CSP! ;               : UNNEST ?CSP COMPILE EXIT [',] [ ;                             #:    +COMP  PVECTOR :                  ' DONEST TO :           #;    +COMP  PVECTOR ;  IMMEDIATE       ' UNNEST TO ;           VARIABLE SRC    : >= < 0= ;       : ?BLK BLK @ 1 -2 WITHIN ;    : ;TI POP      BLK @ PUSH    >IN @ PUSH   SRC @ PUSH                  PUSH EX  POP SRC !     POP >IN !    POP BLK ! ;           : ;IN CREG @ EX >IN ! ;                                         : SOURCE! A DUP 1- A! SRC @ - ;                                 : SRC@ SRC @ >IN @ #IF TUCK NEGATE CREG ! + A! ;THEN RDROP ;    : SRC? SRC @ IF ;THEN ?BLK IF BLK @ BLOCK 1K + SRC ! THEN ;     : ?WS  ;IN FOR/ C@A+ 33 >= IF RDROP SOURCE! 1- ;THEN /NEXT 0 ;  : ?NWS ;IN FOR/ C@A+ DREG @ = IF RDROP SOURCE! ;THEN /NEXT 0 ;  : PARSE DREG ! SRC? SRC@                                                DREG @ 33 >= IF ?WS SRC@ THEN                                   A ?NWS  A OVER - ;                                      : ". COUNT TYPE ;                                               : (."  ;LIT"  ". ;  : (LIT" ;LIT" ;                             : SSS " SERTYUIOP[" ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           : ;RBUF POP RP@ ROT - RP@ OVER RP! PUSH SWAP PUSH EX POP RP! ;  VARIABLE LINES  VARIABLE ?HAND : ?SEOF ?HAND @ HANDLES @ = ;    : HAND! HANDLES @ ?HAND ! HANDLES ! LINES OFF ;                 : OK? CR BLK @ IF EX ;THEN C" > EMIT EX SPACE ;                 : 1LINE 1 LINES +! OK?  ACCEPT EX >INTERPRET ;                  : ?IO BLK @ IF FIO ;THEN SIO ;                                  : FOPEN HANDLES bs - 0= ?? FOPEN DUP 0< A" OPEN ERR" ;          : SEVAL ;TI BLK ! ?IO   90 ;RBUF 2+ TIB ! HAND!                          BEGIN 1LINE ?SEOF UNTIL ;                              : ;S HANDLES 0; AT HANDLES BLK 1+ 0= IF CLOSE THEN DROP ;       : FLOAD FOPEN  -1 SEVAL ?IO ;  : KBD  0 0 SEVAL ?IO ;                                                                           : 0>= 1+ ?FOR RDROP -1 ;THEN 0 ;                                : ;INVERTED INVERT EX INVERT ; : DECR PUSH ?NEXT -1 ;THEN POP ; : INCR ;INVERTED DECR ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #FLUSH +COMP  PVECTOR FLUSH   #BLOCK +COMP  PVECTOR BLOCK       #, +COMP  PVECTOR ,   #C, +COMP  PVECTOR C,                     #] +COMP  PVECTOR ]   #[ +COMP  PVECTOR [ IMMEDIATE             #HEAD +COMP  PVECTOR HEADER     : BCOMPILE POP C@+ PUSH C, ;    : COMPILE POP @+ PUSH , ;   : 2Z, COMPILE [ 0 , ] ;             : W, @+ SWAP , ; : DCOMPILE POP W, W, PUSH ;                    : VALUE HEADER DCOMPILE [ #CONST +COMP @+ DROP 1- ,                        #VAR! +COMP @+ DROP , ] , ;                          : VECTOR HEADER DCOMPILE [ #VECT +COMP @+ DROP ,                           #VAR! +COMP @+ DROP , ] , ;                          : CREATE HEADER COMPILE [ #VAR +COMP @+ DROP , ] ;              : VARIABLE CREATE 2Z, ;     : 2VARIABLE VARIABLE 2Z, ;          : CONSTANT HEADER COMPILE [ #CONST +COMP @+ DROP , ] , ;         1024  CONSTANT 1K     64  CONSTANT 1L   16  CONSTANT 1H         1030  CONSTANT B/BUF   0  CONSTANT 0    -1  CONSTANT -1           15  CONSTANT LEN#  255  CONSTANT BYTE#    -->            \\\ 1 CONSTANT 1    2 CONSTANT 2   -2 CONSTANT -2                   : ;LIT" POP POP DUP A! PUSH PUSH A EX  POP COUNT + PUSH ;       : ! !+ DROP ; : @ @+ DROP ;  : C! C!+ DROP ; : C@ C@+ DROP ;    : SWAP! SWAP ! ;  : OFF 0 SWAP! ;  : ON -1 SWAP! ;              : !A  A ! ; : @A A @ ; : +! A! @A + !A ;                        : WCOUNT @+ SWAP ;    : @SWAP OVER @ PUSH SWAP! POP ;           : C!A  A C! ;   : C@A  A C@ ;   : 2@ @+ @ SWAP ; : 2! !+ ! ;    : !A+ A !+ A! ; : @A+ A @+ A! ;  : C!A+ A C!+ A! ;              : C@A+ A C@+ A! ;                                               : IND POP POP DUP PUSH SWAP PUSH ;                              : ROT PUSH SWAP POP SWAP ;                                      : -ROT SWAP PUSH SWAP POP ;                                     : TUCK SWAP OVER ;                                              : NEGATE INVERT 1+ ;                                            : - NEGATE + ;  : ABS -IF NEGATE THEN ;  -->                                                                                    \ : ;code POP CFA @ ! ;  : HERE H @ ;  : ALLOT H +! ;           \ : DOES> COMPILE ;code [ >LIT , >DOES , ]                      \      BCOMPILE [ 232 C, ]  HERE 1+ 1+ - , ; IMMEDIATE          : 0= #IF DUP XOR ;THEN INVERT ; : S>D -IF -1 ;THEN 0 ;          : U< - DROP <IF 0 ;THEN -1 ; : = XOR 0= ; : 0< S>D NIP ;        : WITHIN OVER - PUSH - POP U< ;   : < - 0< ;                                    : 2DUP OVER OVER ;   : 3DROP DROP DROP DROP ;   : D+ PUSH A! PUSH A + POP POP +C ;   : M+ S>D D+ ;              : DNEGATE INVERT SWAP INVERT 1+ #IF SWAP ;THEN SWAP 1+ ;        : D- DNEGATE D+ ;        : DABS -IF DNEGATE THEN ;              : UM* A! 0  LEN# FOR +* NEXT NIP A SWAP ;                       : (M/MOD PUSH SWAP A! POP LEN# FOR -/ NEXT NIP A ;              : U/MOD 0 (M/MOD ; : UM/MOD TUCK  U/MOD  PUSH (M/MOD POP ;      : U/ U/MOD NIP ;   : UMOD U/MOD DROP ;                          -->                                                                                                                             : /MOD OVER S>D NIP (M/MOD ;                                    : / /MOD NIP ;                                                  : MOD /MOD DROP ;                                               : ;NEG 2DUP XOR 2* DROP <IF EX DNEGATE THEN ;                   : ;/ POP SWAP PUSH PUSH EX POP UM/MOD ROT DROP ;                : M* ;NEG ABS PUSH ABS POP UM* ;   : * M* DROP ;                : UM*/ ;/ UM* ;                                                 : M*/ PUSH M* POP ;NEG ABS ;/ DABS ;                            : */ M*/ DROP ;                                                 : 16/ 2/ 2/ 2/ 2/ ;  : 256/ 16/ 16/ ;                           VARIABLE H     VARIABLE BASE   VARIABLE BLK   VARIABLE >IN      VARIABLE TIB   VARIABLE SCR    VARIABLE SCRH  VARIABLE CFA      VARIABLE OUT   VARIABLE AREG   VARIABLE BREG  VARIABLE CREG     VARIABLE DREG  VARIABLE EREG   0 VECTOR ERROR 2VARIABLE NUM     VARIABLE FIN     -->                                                                                                            $ 5E TIB !     : DOSEMIT  DUP DUP $ 200 (DOS 3DROP 3DROP ;      : IO4 (DOS EREG ! AREG ! DROP  CREG ! DREG ! DROP ;             : ?ERR EREG @ 2* <IF 2/ ERROR THEN ;  : ;ERR ?ERR EX ?ERR ;     : IO BREG @ SWAP IO4 ; : CLOSE_H DUP DUP DUP $ 3E00 IO4 ;       : OPEN_H DUP $ 3D02 IO ;                                        : POSBLK  BREG ! 1K UM* $ 4200 IO 1K ;                          : READBLK  ( SCRH @ ) POSBLK ;ERR $ 3F00 IO ;                   : WRITEBLK ( SCRH @ ) POSBLK ;ERR $ 4000 IO ;                   : DOSKEY   DUP DUP DUP $ 800 IO4 AREG C@ ;                      ' DOSEMIT VECTOR 'EMIT : EMIT 'EMIT 1 OUT +! ;                  : ACCEPT  $ 84 TIB @ 2 - TUCK ! DUP DUP  $ A00 IO4                 0 TIB @ 1- COUNT DUP    CREG ! + C!  ;    -->                                                                                                                                                                                                                                                                                 10 BASE !     : ALPHA -10 + <IF 65 + ;THEN 58 + ;              : CR 13 EMIT 10 EMIT 0 OUT ! ;                                  : 1H. 15 AND ALPHA EMIT ;    : 1B. DUP 16/ 1H. 1H. ;            : 1W. DUP 256/ 1B.  1B. ;    : 1D. 1W. 1W. ;                    : TYPE FOR/ COUNT EMIT /NEXT DROP ; : STYPE FOR/ EMIT /NEXT ;   : HOLD SWAP 1+ ; : 1# NUM 2@ BASE @ UM/MOD NUM 2! ALPHA HOLD ;  : S# NUM 2! 0 BEGIN 1# NUM 2@ OR 0= UNTIL ;                     : N>TYPE A! OVER - FOR/ A HOLD /NEXT ;  : SPACE 32 EMIT ;       : D# #IF DROP DABS S# C" - HOLD ;THEN DROP S# ;                 : D.R PUSH D# POP 32 N>TYPE STYPE ; : SPACES FOR/ SPACE /NEXT ; : D. S>D 0 D.R SPACE ;   : . S>D D. ;  : U. 0 D. ;              : .R PUSH S>D S>D POP D.R ;   : U.R  0 0 ROT D.R ;              : UD. 0 0 D.R SPACE ;         : UD.R 0 SWAP D.R ;               : .. BASE @ PUSH 6 .R SPACE POP  BASE ! ;                       121 LOAD                                                                                                                                                                                                                                                                                                                                                                                                                                                        : READC BREG DUP OFF 1 FIN @ $ 3F00 IO4 AREG @ ;                \ IF BREG @ THEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              CODE GAGA S. 1+ 1 #, W/  100 /// ADD, NEXT, END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            