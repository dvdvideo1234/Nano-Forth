\ PRUNE 3                                                       FGDFG                                                           SDF                                                             DFG                                                             SDFGSDFGSDFGSDFGSDFGD                                           DFGDFGD FGDFG                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   MARKER -MYDO  : I RP@ 2+  2@ - ;  : I< RP@ 2+ 2@ + ;            \ CODE I  BX PUSH,  2 /BP BX MOV,  0 /BP BX SUB, NEXT, END-CODE \ : THRU  PUSH PUSH I RDROP 1+ FOR I LOAD NEXT RDROP ;          : |-| POP -ROT DUP PUSH COM + ABS SWAP PUSH ;                   : \' [',] [',] ;  IMMEDIATE                                     : \N COMPILE lit \' [',] ;  IMMEDIATE                           : MYDO   COMPILE |-| \' FOR ; IMMEDIATE                         : MYLOOP \' NEXT COMPILE RDROP ; IMMEDIATE                      : MYPROBA MYDO R. I . MYLOOP ;                                  : PROBA 2 PUSH 1 PUSH I RDROP RDROP ;                           : PROBA2 2 PUSH 5 PUSH I RDROP RDROP ;                          : INDEX  1+ SWAP DO I BLOCK I CR .LINE LOOP ;                   : INDEX2 DUP TO SCR 1+ SWAP - 0MAX FOR                                CR SCR R@ - DUP BLOCK SWAP .LINE NEXT ;                   : INDEX3 FOR R@ . NEXT ;                                                                                                        MARKER -TIMES         : H/MOD 16 /MOD ;                         : DIG. ALPHA EMIT ; : B. H/MOD DIG. DIG. ; : W. UNPACK B. B. ;  EXIT                                                            : H. ;SPACE UNPACK CALL> THEN H/MOD CALL> THEN ALPHA EMIT ;     0 VALUE BR : ;BR BR EX TO BR ; : C!B+ ;BR C!+ ; : !B+ ;BR !+ ;  0 VALUE AR : ;AR AR EX TO AR ; : C@A+ ;AR C@+ ; : @A+ ;AR @+ ;                                                                  : PROBA TIMES DUP . ;                                           : CMOVE -ROT TO BR TO AR TIMES C@A+ C!B+ ;                      : SPACES TIMES SPACE ;    : (TYPE TO AR TIMES C@+ ?EMIT ;       : STYPE C@+ (TYPE ;  : TYPE SWAP (TYPE ; : #> TIMES SWAP EMIT ; : (." POP STYPE AR PUSH ; : (" POP DUP C@+ + PUSH ;             : ;BASE BASE XCHG PUSH TO BASE EX POP TO BASE ;                                                                                                                                                                                                                 EDGE TO SPTR  : ;CSP CSP EX TO CSP ;   : CSP! ;CSP SP@ ;         : ?CSP SP@ ;CSP - A" PAIRS? " ;                                  0 NM: C@ (BR TO ;BASE ;M        1 NM: C@ TO BASE ;M             2 NM: C@ ;BASE BLWORD  NUM ?LITERAL ;M   VARIABLE  %!%            |  3 MAKER >BASE C,          16  >BASE $   IMMEDIATE            10  >BASE #   IMMEDIATE       2  >BASE %   IMMEDIATE        : #% @ IF %!% AT HDRS? OVER @ @SWAP @SWAP DROP THEN <N> ;       : <N  0 %!% ! AT HDRS? #% ;  ( START HI - CODE WITH NAMES)      : N>  %!% #% ;  : SEARCH @ SWAP  -1 -ROT (find  TO ?, ;         : RESCAN2 >IN BLWORD CURRENT SEARCH ROT TO >IN NIP 0;           ." \+" BLK [AT] # . 57 OUTC < IF CR THEN HERE ID. ;             ' RESCAN2 TO 'SAME    : =? - A" PAIRS!" ;                       ' : TO MPTR : : CSP! : ; MPTR EXEC ; [',] ; ?CSP ; IMMEDIATE                      -->                                                                                                                                                                           : ST  SPTR CSTR ; : SN ST + CSTR ;        \ STACK TOP / NEXT    : S-! DUP 1+ AT SPTR @-! C! ;             \ STRING ALLOC        : >S PUSH SPTR R@ - R@ MOVE POP S-! ;     \ PUSH STRING         : SDROP  ST + TO SPTR ;                   \ DROP STRING         : S> SPTR SDROP ;  : S! OVER C@ 1+ MOVE ; \ POP / MOVE STRING   : S-INS ST PUSH TO SPTR >S POP SPTR +! ;  \ INSERT STR IN TOP   : #>S S-! ST FOR C!+ NEXT DROP ;          \ FORMATED PUSHSTR    : S!+ PUSH C@+ OVER R@ C@+ + SWAP MOVE POP +! ; \ APPEND STR    : SWAP+S S> COUNT S-INS ;                 \ CONCAT TOP & NEXT   : C>S  1  #>S ;                           \ CHAR > STR          : C-INS C>S SWAP+S ;  : S>! S> SWAP S! ;  \ INSERT CHAR IN TOP  : S" C" " WORD COUNT S-! ST CMOVE ;       \ INPUT > SS          : SPOP! S> CSTR PUSH SWAP POP CMOVE ;     \ POP TO HERE         : N>S  D# #>S ; 0 0 >S  0 0 >S            \ NUM > STR == ITOA   : S+C! DUP PUSH C@+ + C! 1 POP +! ;       \ ADD CHAR                                                                            : BCONST CREATE C,         IMMEDIATE                            DOES> C@ STATE IF COMPILE blit C, THEN ;     \ KBD   CONSTANTS  : CONST CONSTANT DOES> @ [',] LITERAL ; IMMEDIATE                72 BCONST kUP       80 BCONST kDOWN     77 BCONST kRIGHT        75 BCONST kLEFT    116 BCONST kcRIGHT  115 BCONST kcLEFT        82 BCONST kINS      83 BCONST kDEL      73 BCONST kPGUP         81 BCONST kPGDN     71 BCONST kHOME     79 BCONST kEND         119 BCONST kcHOME   117 BCONST kcEND     59 BCONST kF1           60 BCONST kF2       61 BCONST kF3       62 BCONST kF4           63 BCONST kF5       64 BCONST kF6       65 BCONST kF7           66 BCONST kF8       67 BCONST kF9       27 BCONST kESQ          68 BCONST kF10      84 BCONST ksF1      93 BCONST ksF10         94 BCONST kCF1     103 BCONST kcF10     15 BCONST ksTAB        104 BCONST kaF1     113 BCONST kaF10      9 BCONST kTAB         ' CTRL  ALIAS  ^  IMMEDIATE                                                                                                     HERE TO FENCE  CREATE -MARKER  0 VALUE XK  : WHAT? 7 EMIT ;     : LOAD DUP .. LOAD ; : THRU 1+ SWAP ?DO I LOAD LOOP ;           : +LOAD BLK + LOAD ; : +THRU BLK TUCK + PUSH + POP THRU ;       : -:  ' , C,  XK 2+ DUP TO XK       ( BYTES FOR MOVE UP 1 )              HERE OVER - DUP PUSH       ( START ADDRESS   )                  DUP 1+ ROT                 ( PREPARE FOR MOVE)                  MOVE  HERE C@ POP C!   ;   ( FIX CODE  )               : SWITCH: CREATE HERE 73 1 TO XK 0 -:                               DOES> SWAP TO XK COUNT 2DUP XK SCANB 1+ 2* + + PERFORM ;    : ;SWITCH  73 - A" BAD KEYS" XK 2/ 1- SWAP C! ;                 3 LOAD     7 12 THRU           \ STRING # $ % EDITOR            \ 12            LOAD           \ MARKER ORDER <% ASM CODE             200       LOAD           \ WORD DECOMPILER                      195       LOAD   PRUNE   \ SOURCE DECOMPILER              \  214 LOAD \ 1 2 3 4 5 6 7 8    \ 44 LOAD                                                                                      (  EDITOR POSXY WIPE RELOAD SAVEBLK LB N B ARROW)               : >SORT 2DUP < IF SWAP THEN ;   : <SORT 2DUP > IF SWAP THEN ;   : MAX >SORT DROP ; : MIN <SORT DROP ;                           F83 ONLY TO FORTH \ VOCABULARY EDITOR                                                                                           ( ONLY FORTH ALSO  EDITOR  ALSO DEFINITIONS)   0 VALUE XY        -HEADERS       0 VALUE  PDATA     0 VALUE OLD_RP                 VARIABLE INS  0 VECTOR 'ADVANCE  : ?XY 1L U/MOD  7 2 D+  ;    : ?INS 1 INS @ AND ;               : POSXY XY ?XY GOTOXY   ;    : .INS  75 2 GOTOXY ?INS IF ." INS" ;THEN ." OVT" ;             : _INS  1 INS XOR! .INS ;    : RELOAD SCR BLOCK TO PDATA ;      : REDRAW .INS HOME PDATA .BLOCK ;                               : /L  1L 1- OR ;           ( LINE END)                          : L/ 1L NEGATE AND ;       ( LINE BEGIN)                        : ;LRUD  XY EX 1K 1- AND TO XY ;    : ;LPOS  XY EX PDATA + ;                                                                    ( COPY POS^ LINE/ /LINE LDRAW EL INSC DELC OVTC INSL DELL LL  ) : L_UP  ;LRUD  1L - ;     ( LINE UP)                            : L_DN  ;LRUD  1L + ;     ( LINE DOWN)                          : L_END ;LRUD  /L ;       ( LINE END)                           : L_BEG ;LRUD  L/ ;       ( LINE BEGIN)                         : ->    ;LRUD  1+ ;       ( MOVE 1 CHAR RIGHT)                  : <-    ;LRUD  1- ;       ( MOVE 1 CHAR LEFT)                   : TAB>  ;LRUD  7 OR 1+ ;  ( NEXT TABULATION )                   : <TAB  ;LRUD  1- -8 AND ;  ( PREVIOUS TABULATION)              : <_|   L_DN L_BEG    ;   ( CARRIGE RETURN L_DN L_BEG )         : APOS  ;LRUD  0 AND ;    ( HOME POSITION OF CURSOR)            : LINE/ ;LPOS L/ ;  : /LINE ;LPOS /L ;                          : LDRAW POSXY LINE/ cr EMIT XY 1L / .LINE ;                     : EJECTBLOCK DISCARD -1 PREV 1+ ! ;                             : RESET EJECTBLOCK RELOAD REDRAW ;   ( !!!!!!!)                                                                                 : LB SCR + 0 MAX TO SCR RELOAD REDRAW ;   ( +blk - )            : LEOS 1K  XY - 1L - 0 MAX ;  ( - chars_to_end_of_screen )      : POS^ PDATA XY + ;          ( - char^ )                        : P2 POS^ DUP DUP 1L + ;     ( - char^ char^ char^+1l )         : LL XY /L XY - ;            ( - chars_to_end_of_line )         : GETCHAR XY 0= 'ADVANCE POS^ C@ 33 U< ;                        : -BL BEGIN  GETCHAR 0= OR UNTIL ;        : N  1 LB ;           : -NONBL BEGIN GETCHAR OR UNTIL ;         : B -1 LB ;           : >NEXT TO 'ADVANCE -NONBL -BL ;  : ADV ['] -> >NEXT ;          : >EL 1K LEOS - 1L MIN ;      : BACK ['] <- >NEXT -> ;          : EL >EL BLANK ;  ( ERASE LINE OR LESS)                         : RDRC REDRAW UPDATE ;                                          : DELL P2 SWAP LEOS CMOVE LEOS +  EL RDRC ;                     : >INSL P2 LEOS CMOVE> EL ;                                                                                                                                                                     : C POS^ >EL L_DN >S ;             : G C L_UP DELL ;            : P ST NIP 0;  >INSL HERE S>! HERE CSTR                                 >EL MIN POS^ SWAP CMOVE RDRC ;                          : OVTC POS^ C! UPDATE ;                                         : INSL >INSL RDRC ;                                             : POSC POS^ DUP 1+ ;                                            : INSC ?INS IF POSC LL CMOVE> THEN OVTC ;                       : DELC POSC SWAP LL CMOVE bl /LINE C! LDRAW UPDATE ;            : BS <- DELC ;                                                  : X-POS 0 18 GOTOXY OLD_RP RP! ;                                : Q/ED  FLUSH  X-POS ;                                          : ESQ/E EMPTY-BUFS X-POS ;         <N  5 LOAD  N>                                                                                                                                                                                                                                                                               : @KEY POSXY KEY UNPACK OVER IF DROP ;THEN SWAP ;               : ONEC XK bl U<  IF WHAT? ;THEN XK INSC LDRAW -> ;              | SWITCH: EF WHAT?               kLEFT -: <-     kUP -: L_UP     kHOME -: L_BEG   kEND -: L_END  kPGUP -:  B   kPGDN -: N        kDOWN -: L_DN  kRIGHT -: ->     kINS  -: _INS  kDEL -: DELC     ksTAB -: <TAB  kcHOME -: APOS  ;SWITCH                                                                                         | SWITCH:  EK  ONEC   ^ J -: <-  ^ K -: ->     ^ X -:  G          127 -: DELL    bs -: BS        ^ D -: DELC  cr -: <_|          ^ N -: N     ^ B -: B    ^ L -: RESET   ^ I -: TAB>             ^ C -: C     ^ V -: P    ^ Q -: ESQ/E   ^ Z -: BACK             ^ A -: ADV   kESQ -: Q/ED  ^ S -: INSL   0 -: EF   ;SWITCH     : E  RELOAD REDRAW  RP@ TO OLD_RP  BEGIN @KEY EK AGAIN ;        : EDIT PAGE TO SCR  E ;     : ERR CSP TO XY SCR EDIT ;          : HELP SCR PUSH TO SCR E POP TO SCR E ;  FORTH                                                                                  : ?IN @R+ >IN PUSH ?EXEC POP TO >IN ;                           : MARKER ?IN -FIND NIP IF ?IN FORGET THEN                               CREATE DOES> 2- C>N DROP forget ;                       : ORDER. ORDER# WCOUNT FOR WCOUNT 6 - ?ID. NEXT DROP ;            : CLARY HERE OVER ERASE ALLOT ;                                 | : ARRAY CREATE , DOES> HEADER  @ ,                                  HERE DUP PUSH 2- EXEC POP - CLARY ;                     ' ORIGIN+ 2+ @ DUP        ARRAY QARY                              2+ DUP  ARRAY WARY   2+ ARRAY BARY                            : U/ 0 SWAP UM/MOD NIP ;   : UNITS? U/MOD SWAP IF 1+ THEN ;      : ;[] EMIT  C" [ EMIT EX  C" ] EMIT ;                          | : D8 SPACE bs FOR COUNT .H NEXT ;                             : DU CR DUP DUP H. D8 D8 bl ;[] SWAP 1H TYPE ;                  : DUMP 1H UNITS? FOR DU NEXT DROP ;                             : LIKE ' @ ; : BE ' ! ; : IS ' 2+ ! ;  : META ' IS ;                                                                            : S. POP R@ SWAP PUSH ;<A> CR S. KEY 283 = A" ESC ?" DROP ;     CODE NAP DX POP, /CODE CODE DAP DX PUSH, /CODE | : ;<A> DAP SWAP XCHG PUSH EX POP SWAP NAP ; | : /DBG RDROP RDROP ;                                                                    | : /DUMP DUP 8 - 8 DUMP ; | : #S. ;<A> ;[] SPACE OVER SWAP - 2 / 1- DUP  0< A" STACK UNDERFLOW" FOR 2- DUP @ . NEXT DROP ;    : VOC. CR ." CONTEXT =" CONTEXT 6 - ?ID. CR ." CURRENT = "    CURRENT 6 - ?ID. ;  : VOX. VOCLINK BEGIN ?DUP WHILE DUP 8 - C>N DROP CR DUP H. ID. @ REPEAT ;                                                          : S. S0 SP@ C" S #S. ; : R. TIB RP@ C" R #S. ;        | SWITCH: SS /DBG 27 -: ABORT  83 -: S. 82 -: R.  68 -: /DUMP  ;SWITCH  : INDBG  DUP H. @  DUP H. ?ID. [AT] $ SPACE                 25 OUTC - SPACES  S.  BEGIN CR KEY $ DF AND SS AGAIN ;     : DBG. R@ ;<A> INDBG ;                                                                                                                                                                          ASM  256 ALIGNED  L: >BOOT CLD, DI SKIPW, 0 ,  \ TRACE EMIT     ?IF, L: >EMIT Z, L: >KEY Z, L: >BLK Z, L: >DEBUG 20 ALLOT       THEN, CALL,? 63  DI PUSH, $4A #, AH MOV, DOS, ?, J, 5           L,? 3          L: >DO_DBG >DEBUG #, DI MOV, 0 /DI JMP,          HP, CALL,? 2 LODSW,   L: >EX AX DI XCHG, 0 /DI JMP,             L: >TRON  0 #, AX MOV, ?IF, HP, L:  F> SI JMP,  \ TO FIX        L: >TROFF >EX 1- /// AX MOV, THEN,    \ TRACE OFF               L: >TR! 0 /// AX XCHG, SAVE2 L,? 1 RET,  \ SET TRACE            HP, L: ;F> SI PUSH,  X, SI POP, X, RET,                         HP, L: >F: X, SI PUSH, X,  FB: 5  L: >F  SI POP, ?, NOT, IF,    L: >TRF: >TROFF CALLI, >F: JMP, L: >TRF >TROFF CALLI, >F JMP,   L: >KY >KEY /// AX MOV, ?IF, L: >EMT< >EMIT /// AX MOV, THEN,   L: >STEPA< CX POP, DUP, AX BX XCHG, X, CX PUSH, DX PUSH,        >TROFF CALLI, AX PUSH, SI PUSH, X, >F CALLI, >DO_DBG 2- , F>    2- , X, SI POP,  AX POP,  DX POP, CX POP, X, CX PUSH, >TR! JMP,                                                                 FL: 2  L: >?TR;  X, DX POP, AX POP, SI POP, X, >TR! JMP,        L: >SWAP! DI POP, CX SKIPW, SCASW,                              L: >VAR! SCASW, BX 0 /DI MOV,                                   L: >DROP DROP, ?, NOT, IF, SCASW, SCASW,                        L: >CONST SCASW, 0 /DI AX MOV, ?, NOT, IF,  SCASW, SCASW,       L: >VAR   SCASW, DI AX XCHG,  THEN,     L: >PUSH  DUP,          L: >SWAP AX BX XCHG, THEN, THEN, FL: 1  HERE TO ?NEXT ( !!!)    L: >MAIN >DO_DBG JMP, 0 /DI JMP,   >MAIN @ >TRON 1+ ! \ FIXED   L: >KEY< >KEY /// AX MOV,  >STEPA< JMP,  AX POP, AX BX XCHG,    L: >#CALL 2 /DI DI MOV, DI CALL, NEXT,                          L: >PERF 0 /BX BX MOV,      FL: 3  >EX 1- @ >MAIN ! \ MAIN FIX  L: >EXEC   AX POP, AX BX XCHG,                                  L: >?EX AX CX MOV, >MAIN JCXZ, >EX JMP, /ASM                                                                                                                                                                                                                    ASM SCASW, SCASW, L: >NEST 2 /DI AX LEA, L: >?NEST  SI AX XCHG, L: >ARPH -2 /BP BP LEA, AX 0 /BP MOV, NEXT,                     L: >FSUB 4 /DI AX MOV, >?NEST JMP, L: >FJMP 2 /DI SI MOV, NEXT, L: >PREP  2 /DI AX LEA, >ARPH JMP,   SCASW, SCASW,              L: >DOES AX POP, DUP,  2 /DI BX LEA, >?NEST JMP,                L: >;: SI 0 /BP XCHG, NEXT, SCASW, SCASW,                       L: >XCHG BX 0 /BP XCHG, NEXT, L: >CONT -2 /SI AX LEA, >ARPH JMP, L: >CALL LODSW, >?NEST JMP,  SCASW, SCASW,                     L: >>: SCASW, DI SI MOV, NEXT,   FL: 63                         L: >INIT BP POP,  CS AX MOV, AX DS MOV,  AX ES MOV,                       $1000 #, BX MOV, CLD, CX SKIPW, L: MFLG 0 , CXNZ,               IF, BX AX ADD, BX CX MOV, THEN, AX SS MOV,  SP SKIPW, L: SP#0 $FE00 ,  CX BX ADD,  BP PUSH,  BP SKIPW,                L: RP#0 $FF00 , RET,   /ASM                                                                                                                                                                     CODE XY@ ( - aacc) BX BX SUB,  $800 #, AX MOV,  VIDEO, RET,       HERE TOBE  DUP, 2 /DI CX LEA, CX CALL, >SWAP JMP, END-CODE    CODE PC@ ( port - c) AL IN, RET, HERE TOBE AH AH SUB, BX DX MOV,   2 /DI CX LEA, CX CALL, >SWAP  JMP, END-CODE                  CODE P@ ( port - n) AX IN, RET,   LIKE PC@ 2+ TOBE END-CODE     CODE (BKEY  ( - c)  KBD, RET,    HERE TOBE   AH AH SUB,               2 /DI CX LEA, CX CALL, >PUSH JMP, END-CODE                CODE CS@ ( - seg) CS AX MOV, RET, LIKE (BKEY 2+ TOBE END-CODE   CODE (DKEY? $0B #, AH MOV, DOS, CBW, RET, LIKE CS@ TOBE /ASM    CODE P!  ( n port  -) AX OUT, RET, HERE TOBE  BX DX MOV,                AX POP, 2 /DI CX LEA, CX CALL,  BX POP, /CODE           CODE PC! ( c port  -) AL OUT, RET,   LIKE P! TOBE END-CODE      CODE XY! ( row col -) AL DH MOV,  BX BX SUB, $200 #, AX MOV,              VIDEO, RET,   LIKE P! TOBE    END-CODE                  >TRON  >#CALL CODE, TRON ,  >TROFF >#CALL CODE, TROFF ,                                                                       ASM                                                             L: >?NONAM  AX POP,   DI POP,  DI PUSH,  SCASW,  0=, IF,                AX POP,  0 /DI PUSH,   THEN,  NEXT,                     L: >NONAM  BX BX  OR,   0=, NOT, IF,  >?NONAM  CALLI,           L: >ALIAS CX SKIPW,  SCASW, SCASW,                              L: >DEFER SCASW, 0 /DI AX MOV, >?EX JMP,                        L: >PVAR! SCASW,  L: >PVAL! 2 /DI  DI MOV, >VAR! 1+ JMP,        L: >PVECT   DUP, 6 /DI DI MOV,  >DEFER 1+ JMP,                  L: >PQUAN SCASW,  L: >PVAL  4 /DI  DI MOV,  >CONST 1+ JMP,          1 #, BX SHL,  BX DI ADD,  1 #, BX SHL,                      L: >WARY 1 #, BX SHL, 2 X/D BX LEA,         THEN,  NEXT,        L: >VBLK  DUP, >BLK /// BX MOV, BX INC, 0=, NOT, IF, SCASW,          BX DEC,  >DEFER 1- JNE,  THEN,   BX POP,  >DEFER JMP,      /ASM                                                                                                                                                                                            ASM  L: >#IF  BX BX OR, DROP,         0=, IF,                   L: >JMP 0 /SI SI MOV, NEXT,                                     L: >0; BX BX OR, DROP, 0=, IF, L: >UNNEST  0 /BP SI MOV,        L: >RDROP  2 /BP BP LEA,   THEN, NEXT,                          L: >=IF    AX POP,  AX BX XCHG,  AX BX CMP, >JMP JNE,  DROP,    THEN,  L: >SKIP 2 /SI SI LEA,   NEXT,                           L: >IF   BX BX OR,  >JMP JE,   >SKIP SJMP,                      L: >-IF  BX BX OR,  >JMP JNL,  >SKIP SJMP,                      L: >+IF  BX BX OR,  >JMP JL,   >SKIP SJMP,                      L: >~IF  BX BX OR,  >JMP JNE,  >SKIP SJMP,                      L: >NEXT LODSW, 0 /BP CX MOV,  >RDROP JCXZ,    W/  0 /BP DEC,   L: >NX2  AX SI XCHG,    NEXT,                                   L: >-TR  >TROFF CALLI, X, AX PUSH, DX PUSH, X, >DOES JMP,       L: >?FOR LODSW, BX CX MOV, DROP, CX DEC, >NX2 JL,                   X, CX PUSH, X, NEXT,  /ASM                                                                                                   >DROP  CODE, DROP   >UNNEST CODE, EXIT     >MAIN CODE, NOP       >JMP  CODE, (BR      >?FOR CODE, ?for    >PERF  CODE, PERFORM    >IF  CODE, if        >-IF CODE, -if      >NEXT CODE, next      >#IF  CODE, (0BR     >CALL CODE, call     >SKIP CODE, SKIP      >=IF  CODE, of       >~IF  CODE, ~if        >0; CODE, 0;        >EXEC CODE, EXEC       >;: CODE, EX     >RDROP  CODE, RDROP     >XCHG CODE, XCHG   >NONAM ,  ( !!!)     >SWAP!  CODE, SWAP!                                                                   \ CODE C!A! ( c A  -) AL 0 /BX MOV, RET, LIKE P! TOBE END-CODE  \ CODE !A! ( n A  -) AX 0 /BX MOV, RET, LIKE P! TOBE END-CODE   CODE LIT  LIKE CS@ TOBE LODSW, RET, END-CODE                    CODE S<>R  END-CODE                                             CODE PUSH  X,     HERE BE S<>R   DUP,  X, DROP, /CODE            >?TR; >#CALL CODE, ?TR; ,       >INIT >#CALL CODE, init ,                                                                                                                                      0 QUAN DERR  L: >DERR  0 , 0 , 0 , 0 , 0 , 0 ,                                  \ ERR AX  BX  CX  DX  ES  DS                                  \  ERRORS & RESULTS IN DOS FUNCTIONS                                                                              0 CODE, 2-      0 CODE, 1-      0 CODE, 2+      0 CODE, 1+      CODE !+  0 /BX POP,     HERE BE 2+    L: >2+ BX INC,                                    HERE BE 1+    L: >1+ BX INC, /CODE      CODE -! -2 /BX POP,     HERE BE 2-    L: >2- BX DEC,                                    HERE BE 1-    L: >1- BX DEC, /CODE      CODE RP!  BX BP MOV, >DROP JMP,  END-CODE                       CODE SP!  BX SP MOV, >DROP JMP,  END-CODE                       CODE RP@  BP AX MOV, >PUSH JMP,  END-CODE                       CODE SP@  SP AX MOV, >PUSH JMP,  END-CODE                       CODE BRK.  INT3, /CODE                                                                                                                                                                          CODE blit  LIKE (BKEY TOBE  LODSB, RET, END-CODE                CODE mlit  LIKE CS@   TOBE  LODSB, -1 #, AH MOV, RET, END-CODE  CODE I     LIKE CS@   TOBE  0 /BP AX MOV,  RET, END-CODE        CODE WITH  LIKE CS@   TOBE  2 /BP AX MOV,  RET, END-CODE        CODE CSTR  LIKE (BKEY TOBE  0 /BX AL MOV, BX INC, RET, END-CODE CODE STR   LIKE CS@   TOBE  SI BX XCHG, LODSW, SI BX XCHG, RET,                     END-CODE                                    \ CODE C@A! ( a - c) 0 /BX AL MOV, RET,  LIKE PC@ TOBE END-CODE   CODE @A! ( a - n) 0 /BX AX MOV, RET,   LIKE P@ TOBE END-CODE  \ CODE @!  CX POP,  CX 0 /BX XCHG, CX BX MOV,  /CODE            \ CODE C@! CX POP, 0 #, CH MOV, CL 0 /BX XCHG, CX BX MOV, /CODE                                                                                                                                                                                                                                                                                                                                 \ -/    U/MOD   UM/MOD                                          CODE +*  BEGIN  1 #, DL TEST, 0=, NOT, IF,  AX BX ADD, THEN,             1 #, BX RCR, 1 #, DX RCR, CXZ, UNTIL, RET,  HERE TOBE   1 #, CX MOV, AX POP, AX PUSH,  SCASW, DI CALL, /CODE           CODE -/   BEGIN, 1 #, DX SHL, 1 #, BX RCL, AX BX CMP, U<, NOT,              IF, AX BX SUB, DX INC, THEN, CXZ, UNTIL, RET,                   LIKE +* TOBE  END-CODE                              CODE U/MOD  CX POP, DX POP, CX PUSH, 16 #, CX MOV, ' -/ 2+ JMP,             HERE TOBE  AX AX XOR,  AX BX XCHG,                            ' U/MOD 2+ CALLI, DUP,   DX BX MOV, /CODE             CODE UM/MOD AX AX XOR, AX BX XCHG, ' U/MOD 2+ CALLI, DX DI MOV,             ' U/MOD 2+ CALLI, DUP, DX PUSH,  DI BX MOV,  /CODE  CODE UM*  AX AX XOR, AX BX XCHG,  DX POP,  16 #, CX MOV,           ' +* 2+ CALLI, DX PUSH, /CODE                                                                                                                                                                0 CONSTANT  LOCATED  HERE 2- C: >LOC                                                                                            CODE  FIND  BX DI MOV,  LODSB, AX CX AND,                         CL 0 /DI CMP,  0=, IF, DI INC,  REPZ: CMPSB,                    0=, IF,  DI SKIPW, THEN, THEN, CX SI ADD,  RET,  HERE TOBE      AX POP, SI PUSH, AX BX XCHG, CS PUSH, AX SI XCHG, ES POP,       BEGIN, SI DX MOV, 0 /SI CX MOV,                                     CXZ, J, 2  CX SI MOV, 31 #, CX MOV, ' FIND 2+ CALLI,        0=, UNTIL,  255 #, CH MOV,  2 /SI BX LEA,  FB: 2  SI POP,      DUP,  DX  >LOC /// MOV, CH AH MOV, AX BX XCHG, /CODE                                                                                                                                                                                                                                                                                                                                                                                                           CODE C!+ CX POP, CL 0 /BX MOV, >1+ JMP,  END-CODE               CODE C@+ 0 #, CH MOV, 0 /BX CL MOV, CX PUSH, >1+ JMP, END-CODE  CODE @+  0 /BX PUSH, >2+ JMP, END-CODE                          CODE -C! CX POP, CL -1 /BX MOV, >1- JMP,  END-CODE              CODE -@  -2 /BX PUSH, >2- JMP,  END-CODE                        CODE -C@ 0 #, CH MOV, -1 /BX CL MOV, CX PUSH, >1- JMP, END-CODE CODE ROT   CX POP,  AX POP, CX PUSH, DUP,  >SWAP JMP,  END-CODE CODE -ROT  AX POP,  CX POP, DUP, CX PUSH,  >SWAP JMP,  END-CODE CODE SWAP  AX POP, >PUSH JMP, END-CODE                          CODE POP   DUP, X, DROP, X, /CODE                               CODE OVER  AX POP, AX PUSH, >PUSH JMP, END-CODE                 CODE NIP   AX POP, /CODE                                        CODE TUCK AX POP, DUP, AX PUSH, /CODE                                                                                                                                                                                                                           0 CODE, INVERT         0 CODE, NEGATE         0 CODE, +         CODE ABS BX BX OR, 0<, IF,  HERE BE NEGATE      BX DEC,             HERE BE INVERT        BX INVERT, THEN, /CODE                CODE U<  END-CODE   CODE 0< END-CODE   CODE 0>= END-CODE        CODE 0=  1 #, BX SUB,  L:  >CARRY BX BX SBB, NEXT, END-CODE     CODE 0<=  BX BX OR,  LIKE 0= JE, DI SKIPW,  HERE BE 0>=            BX INVERT,  HERE BE 0< 1 #, BX SHL, >CARRY JMP, END-CODE     CODE U<= BX INC,  HERE BE U<                                                AX POP, BX AX SUB, >CARRY JMP, END-CODE             CODE -  BX NEG,  HERE BE +     AX POP,  AX  BX ADD,  /CODE      CODE AND   AX POP,  AX  BX AND,  /CODE                          CODE OR    AX POP,  AX  BX OR,   /CODE                          CODE XOR   AX POP,  AX  BX XOR,  /CODE                          CODE 2*  1 #, BX SHL, /CODE                                     CODE 2/  1 #, BX SAR, /CODE                                                                                                     CODE PACK AX POP, BL AH MOV, >SWAP JMP, END-CODE                CODE UNPACK AX AX XOR, AL BH XCHG, >PUSH JMP, END-CODE          CODE A  DUP,  DX BX MOV, /CODE                                  CODE NAP   DX POP, /CODE                                        CODE DAP  DX PUSH, /CODE                                        CODE A!  BX DX  MOV,  DROP, /CODE                               CODE DUP   DUP, /CODE                                           CODE +.2/  AX POP, AX BX ADD, DUP, 1 #, BX RCR, /CODE           CODE >CHAR BH BH XOR, 10 #, BL CMP, U<, NOT, IF,                    7 #, BL ADD, THEN, `0 #, BL ADD, /CODE                      CODE H/MOD  15 #, CX MOV,  BX CX AND, CX PUSH,                  L: >H/  4 #, CL MOV, BX SHR, /CODE     >H/ CODE, H/                                                                                                                                                                                                                                                                             CODE -lead   ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,         DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB: 1  /CODE                                                                                 CODE -lead#  ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,         DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB: 1  /CODE                                                                                CODE -trail  ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,           DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB: 1  /CODE                                                                                 CODE -trail#  ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,          DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB: 1  /CODE                                                                                CODE wblk  $40 #, CH MOV,      AX SKIPW,                        L: >RBLK  $3F #, CH MOV, DI POP, 1K #, AX MOV,  AX  PUSH,         CX PUSH,    DI MUL,       AX DX XCHG,   AX CX XCHG,                    $4200 #, AX MOV,  DOS,  DI POP,  U<, NOT,                  IF,      DUP, DI BX MOV,                                    L: >DOS AX BX XCHG, DROP,  CX POP, DX POP, DS PUSH, >DERR #, DI  MOV,  8 /DI DI LDS, DI ES MOV,  DOS, DS POP,  DI SKIPW,            THEN,    DI POP, DI POP,  ES PUSH,  CS PUSH,  ES  POP,          >DERR  #, DI MOV,   U<, IF,  AX -2 /DI MOV, THEN,               STOSW,  BX AX XCHG, STOSW,  CX AX XCHG, STOSW,  DX AX XCHG,     STOSW,  AX POP, STOSW, >DROP JMP, END-CODE                  CODE SCANI AX POP, AX SI XCHG, CX CX XOR, CX BX XCHG, CXNZ, IF,          BEGIN  0 /SI BL MOV,  1 X/S SI LEA,  CXZ, UNTIL,       THEN,  SI AX XCHG, >SWAP JMP,  END-CODE                                                                                                                                                         CODE SCANW REP: SCASW, RET, HERE TOBE 2 /DI AX LEA, AX BX XCHG,   CX POP,  DI POP,  CS PUSH, ES POP, CX PUSH, SI PUSH, BX CALL,   SI POP,  DI POP,  0=, NOT, IF,   DI CX MOV,  THEN,  CLD,        CX INC,   CX DI SUB,  AX DI XCHG,  >SWAP JMP,  END-CODE       CODE SCANS  LIKE SCANW TOBE  AX BX XCHG,  DI SI MOV,  CXNZ, IF,   BX DI MOV, BEGIN, CX PUSH,  255 #, CX MOV, ' FIND 2+ CALLI,    CX POP,  EQ, UNTIL,  THEN,  RET,  END-CODE                     CODE SCANB LIKE SCANW TOBE  REP: SCASB, RET,  END-CODE          CODE SCANW<  LIKE SCANW TOBE  STD,  CX BX MOV, 0 X/D DI LEA,     -2 X/D DI LEA,   REP: SCASW, RET,  END-CODE                    CODE SCANB<  LIKE SCANW TOBE  STD,  CX BX MOV,                     -1 X/D DI LEA,   REP: SCASB,  RET,  END-CODE                                                                                   >RBLK  CODE, rblk       >DOS CODE, dos                                                                                                                                                        \ ABORT  ERROR  ON-ER  DEBUG   'ERR  'INIT   'LOAD  'same       0 VALUE  TIB     0 VALUE /TIB   0 VALUE SPTR    0 VALUE CFA     0 VALUE  NPTR    0 VALUE HERE   0 VALUE SCR     0 VALUE XY      0 VALUE  CSP    -1 VALUE SCRH   0 VALUE OUT  HERE 2- C: >OUT        SP#0 PVAL SP0       RP#0 PVAL RP0     >BLK PVAL BLK                                                                           H' DBG. VECTOR DBG.                                                                                       H' S. VECTOR S.                                                                     ' NOP  VECTOR PAUSE         ' NOP VECTOR 'SAME                  ' NOP  VECTOR ON-ERR        ' NOP VECTOR 'INIT                  ' DROP VECTOR LITERAL   H' ABORT  VECTOR ABORT                     >KEY  PVAL 'KEY            >EMIT PVAL 'EMIT                                                                                                                                                                                                                  \ ! @ C! C@ ?EMIT EMIT SPACE ;CODE TYPE SPACES CR                 0 CONSTANT 0       1 CONSTANT 1       2 CONSTANT 2              3 CONSTANT 3      -1 CONSTANT -1     31 CONSTANT LEN#          64 CONSTANT 1L   1024 CONSTANT 1K  -1024 CONSTANT -1K            8 CONSTANT bs     16 CONSTANT 1H     13 CONSTANT cr            32 CONSTANT bl   1028 CONSTANT B/BUF  10 CONSTANT lf            90 CONSTANT TIB#      VARIABLE ATTR  2  IS ATTR                FWD: !  : ;code POP CFA  [:] ! !+ DROP  ;  META ;code ;code,    : C! C!+ DROP ;  : @ @+ DROP ;    : C@ C@+ DROP ;               | : ;A A EX A! ;  | : ;.A A EX DROP ;  \ : A1- ;A 1- ;          : !A+ ;A !+ ;   : C!A+ ;A C!+ ; : @A+ ;A @+ ;   : C@A+ ;A C@+ ; : !A ;.A !+ ;   : C!A ;.A C!+ ; : @A ;.A @+ ;   : C@A ;.A C@+ ; : = XOR 0= ;  : ON -1 SWAP! ;  : OFF 0 SWAP! ;  : -@A ;A -@ ;   HERE ASM >-TR CALLI, ] DROP EX ?TR; [ /ASM                      CODE, ;-TR                                                                                                                      \ ?EMIT EMIT SPACE SPACES TYPE STYPE CR (A" LIT" (." (STR ;STR  0 CODE, EMIT    0 CODE, ?EMIT  CODE SPACE DUP, bl #, BL MOV,    HERE BE ?EMIT  bl #, BL CMP, U<, IF, `. #, BL MOV,  THEN,       HERE BE EMIT   >EMT<  CALLI,  >OUT W/ /// INC, /CODE                                                                            : CR cr EMIT lf EMIT 0 TO OUT ;                                 FWD: TYPE  | FWD: ;/S  FWD: STYPE | FWD: ;STR                    :  LIT" POP DUP ;STR EXIT                                      [:] ;STR C@+ + A!                                               [:] ;/S EX A PUSH ;                                              :  (A" IF POP ON-ERR ABORT THEN POP ;STR ;                      :  (." POP ;/S [:] STYPE CSTR                                  [:] TYPE NAP FOR C@A+ ?EMIT NEXT ;                                                                                              META (." ."     META LIT" "   META (A" A"                                                                                       FWD: ;NIP    FWD: ;DROP  FWD: <   : <? OVER OVER [:] < - 0< ;     : ;NX <? IF [:] ;DROP EX DROP ;THEN  [:] ;NIP  EX NIP ;       : MIN ;NX ;  : MAX ;NX SWAP ;                                                                                                   FWD: W.  FWD: B.  FWD: A.   : ;SPC EX SPACE ;                   : H. ;SPC [:] W. UNPACK B. [:] B. H/MOD A. [:] A. >CHAR EMIT ;                                                                  \ : TLOOP DAP 10 FOR/ I H. /NEXT NAP ;                          \ : T2  9  FOR  I  H.  NEXT ;                                   \ FWD: TIMES                                                    \ : TW  SWAP PUSH [:] TIMES  FOR WITH EXEC NEXT RDROP ;         \ : STARS TIMES 42 EMIT ;                                                                                                                                                                                                                                                                                                       \ SWAP A! === NAP      A SWAP === DAP                           | FWD: ;MOV   |  : ;FIL -ROT [:] ;MOV  NAP  EX DROP ;           FWD: CMOVE              : PLACE ( SRC DST -) OVER C@ 1+         [:] CMOVE ( SRC DST LEN -)  ;MOV FOR C@+ SWAP C!A+ NEXT ;       FWD: FILL       : BLANK bl TO FILL ;                            : ERASE 0 [:] FILL  ( DST LEN WITH -) ;FIL FOR DUP C!A+ NEXT ;                                                                  \ : XCHANGE ( SRC DST -) NAP 1- FOR/ R@ A U<                    \          IF RDROP DROP ;THEN   C@A R@ C@! C!A+  /NEXT ;       FWD: -COMP : -TEXT ( SRC DST - RES ) DUP C@ 1+                  [:] -COMP ( SRC DST LEN - RESULT) ;NIP  NAP                            FOR CSTR  C@A+ - #IF RDROP ;THEN DROP NEXT 0 ;                                                                                                                                                                                                                                                                           FWD: ;DNEGATE  FWD: DNEGATE  FWD: D1+                           : ;NEG OVER OVER XOR 0< IF   [:] ;DNEGATE  EX                   [:] DNEGATE A! INVERT A INVERT                                  [:] D1+ A! 1+ #IF A ;THEN A 1+ THEN ;                           FWD: M*    : * ;DROP  [:] M* ;NEG ABS SWAP ABS UM* ;            : ;-?REM -IF EX ROT NEGATE -ROT THEN ;  : ;ROT/ EX ROT DROP ;   FWD: M*/MOD   FWD: M*/  : ;/ ABS XCHG PUSH EX POP UM/MOD ;      FWD: UM*/  : U*/ ;DROP [:] UM*/ ;ROT/ ;/  UM* ;                 FWD: DABS  FWD: /MOD                                            : /  ;NIP  [:] /MOD ;DROP 1 SWAP    [:] M*/MOD PUSH M* POP           ;NEG           ;-?REM  ;/      [:] DABS -IF DNEGATE THEN ; : MOD ;DROP TO /MOD ;  : */ ;DROP   [:] M*/ ;ROT/  TO M*/MOD ;                                                                                                                                                                                                                                                                  CODE (DKEY ( - c) LIKE (BKEY TOBE                                      8 #, AH MOV, DOS, AH AH XOR, RET, END-CODE               CODE XY? ( - row+col) LIKE CS@ TOBE BX BX SUB,  $300 #, AX MOV,     VIDEO, AX DX XCHG, RET, END-CODE                            CODE .ATTR ( # -) LIKE P! 3 + TOBE       BX CX MOV,                 ' ATTR 2 + /// BX MOV, $920 #, AX MOV, VIDEO, RET, END-CODE CODE (BEMIT ( c -)  LIKE .ATTR TOBE     BX AX MOV,                        $0E #, AH MOV, BH BL MOV, $10 #, INT, RET, END-CODE   CODE (DEMIT  LIKE .ATTR TOBE                                              BX DX MOV, 2 #, AH MOV, DOS, RET, END-CODE            : HOME 0 0 XY! ;  : PAGE HOME 2000 .ATTR ;                      : (KEY ( - c)    BEGIN PAUSE (DKEY? UNTIL (BKEY ;               CODE CLOSEF ( HANDLE - STATUS ) LIKE P@ TOBE  $3E00 #, AX MOV,          PNT! DOS, CS, IF, AX NEG, THEN, RET,  END-CODE          CODE OPENF ( NA - HND) LIKE P@ TOBE $3D02 #, AX MOV, >PNT                    END-CODE                                                        0 VALUE CONTEXT   0 VALUE CURRENT                                                                                    0 VALUE /BLK     0 VALUE BLK     0 VALUE >IN                       1: @A! #IF 1- !A @A+ 2* A + @ ;THEN 1 A" EMPTY LIST" ;          2: DUP @ 1H = A" LIST OVERFLOW" @A! 1+ DUP !A 2* A + ! ;   >VAR 2-   HEADER ORDER#   ,  ,  , Z,       1H 2* CLARY          ' ORDER#  2+                                                    >CONST 2- HEADER HANDLES  , W, W, Z, DROP  1H 2* CLARY                                                                          : ALSO CONTEXT TO ORDER# ; : PREVIOUS AT ORDER# TO CONTEXT ;                                                                    | : CLOSE1  HANDLES  0; AT HANDLES  CLOSEF DROP ;               | : CLOSALL BEGIN CLOSE1 HANDLES 0= UNTIL ;                                                                                                                                                                                                                     0 VAR EOS  ( VALUE )                                            | : ;THRU TO /BLK ;   ' ;THRU ' NOP ' CLOSE1  | V3BLK /STRM     : ;S EOS ON  /STRM  0 TO >IN ;                                                                                                  CODE (FEMIT ( c hndl -) LIKE  P! 2+ TOBE                          AX PUSH, SP DX MOV, DS PUSH,  SS PUSH, DS POP, $40 #, AH MOV,   1 #, CX MOV, DOS, DS POP, AX POP, RET,    END-CODE                                                                            ' (BEMIT  >EMIT !      ' (BKEY  >KEY !                                                                                          \ USE WITH HANDLE                                                                                                                                                                                                                                                                                                                                                                               CODE (FKEY  (  - c ) LIKE CS@ TOBE                                      ' HANDLES 6 + #, DI MOV,   0 /DI BX MOV, BX BX ADD,             0 X/D BX MOV,               ' EOS 2+ #, DI MOV,                 ^Z $3F PACK #, AX MOV,  0 /DI AL XCHG,  AL 1 /DI MOV,           2 /DI BX MOV,  DI DX MOV,  1 #, CX MOV, DOS,  CX NEG,           0 /DI AX MOV,  ^Z #, AL CMP,  0=, IF,                           CX  0 /DI MOV,                          \ EOF SIGNAL            ' CLOSE1 #, AX MOV,   >STEPA<  CALLI,   \ CLOSE FILE                           PNT!  ^M #, AL MOV,  \ SEND cr to EXPECT THEN,   ^M #, AL CMP,  0=, IF, RET, THEN,                               ^J #, AL CMP,  0=, IF,  ^J #, AH CMP,  PNT@ JE,                 ^M #, AH CMP,  ' (FKEY 2+ JE,                           THEN,   ^` #, AL CMP,  U<, NOT, IF, RET,                        THEN,   ^` #, AL MOV, RET,    END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          MARKER -OS                                                      : N>S  0 0 D# #>S ;                                             : S>OS bl C-INS COUNT S-INS S> ". ;      \ COMMAND TO OS                                                                        | : CM0  CREATE ,S" ;    | : CMD2" CM0 DOES> S" S>OS ;          | : A>S [AT] $ SWAP  N>S C" : C-INS  N>S SWAP+S ;               | : CMD1# CM0 DOES> SWAP ?CS: A>S S>OS ;                        CMD1# $TEST ..\AFD.COM"   CMD2" REN REN"  CMD2" DOS COMMAND /C"   CMD2" DIR DIR /O"       CMD2" DEL DEL"  CMD2" ED EDT"           CMD2" CD CD"            CMD2" RD RD"                            CMD2" ATEST ..\AFD.COM" : '$ ' @ $TEST ;                                                                                                                                                                                                                                                                                                                                                      MARKER -MOD     CODE 16/MOD  AX AX XOR,  AX BX XCHG,              AAH, AH BL XCHG,  AX PUSH,  NEXT, END-CODE                    CODE MY/MOD AX POP, AX BX XCHG, AL 0 /// MOV, HERE 2- AX AX        XOR,  AX BX XCHG,  AAH, HERE 1- SWAP!                                     AH BL XCHG,  AX PUSH,  NEXT, END-CODE              : P1 ( NUM NSTART NUMEND)  1+ SWAP                               DO  CR I .. DUP I MY/MOD  OVER .. DUP .. I * + ..  LOOP DROP ; : +.+ + PUSH + POP ;  : ++ TUCK +.+ ;  : C+ ROT +.+ ;           : -.- - PUSH - POP ;  : -- TUCK -.- ;  : C- ROT -.- ;           : /STR TUCK NEGATE +.+ ;                                        : COPY SWAP BLOCK SWAP BUFFER 1K CMOVE UPDATE ;                 | : COPY1 2DUP COPY ROT DUP PUSH ++ POP -ROT ;                  | : NCOPY SWAP PUSH -ROT POP FOR COPY1 NEXT 2DROP DROP FLUSH ;  : <COPY 1 NCOPY ;  : COPY> DUP PUSH ++ 1 -- POP -1 NCOPY ;      \ : KEYS BEGIN KEY UNPACK DROP DUP SPACE H. DUP EMIT 0= UNTIL ; \ : PROBA " RTYUIOP" STYPE ;                                    FORTH MARKER -TARG    55 LOAD                                   CODE NAP  DX POP, /CODE         CODE DAP  DX PUSH, /CODE        \ : S. DAP POP R@ SWAP PUSH CR S. KEY 283 = A" ESC ?" DROP NAP ; VOCABULARY COMP  VOCABULARY ROOT  VOCABULARY OTHER             ONLY ROOT ALSO  OTHER ALSO  DEFINITIONS  | : ;-NAME <N EX N> ;  | : LOCT BLWORD AT COMP SEARCH IF  2 ;THEN                      AT ROOT SEARCH IF 1 ;THEN  0 ;   0 VALUE RAM                    : ;NS  CURRENT XCHG PUSH TO CURRENT EX POP TO CURRENT ;         : CALIAS AT COMP ;NS ALIAS ;  : RALIAS AT ROOT ;NS ALIAS ;      : C: AT HIDDEN ;NS ['] CONSTANT ;-NAME EXEC ;  : L: HERE C: ;   : IS ' 2+ ! ;  : META ' IS ;  : [IS] @R+ 2+ ! ; : ? @ . ;       0 VALUE THERE : <% HERE THERE TO HERE TO THERE ; ' <% ALIAS %>     0 CONSTANT TSTART      0 CONSTANT TEND                          : TSIZE THERE TSTART - ;                  1 4 +THRU                                                                                                                                          : ZARY,  HERE DUP PUSH 2- EXEC POP - CLARY ;                    : (W, CREATE , DOES> @ , ; | : (C (W, EX ' , ;  0 (W, Z,        : (0 (C DOES> W, PERFORM ;  : (- (C DOES> STR SWAP PERFORM ;    : (X (0 DOES> PUSH @R+ EXEC POP PERFORM ; ' HERE (X H2+ 2+      ' HEADER (X CODE, ,   ' HERE (X >MARK Z,  ' HERE (X ,MARK SWAP! ' >MARK (X >LOOP HERE  ' , (X ,LOOP ,MARK  0 (W, TLIT ,         : (B, CREATE C, DOES> C@ C, ; : (WRC, (B, DOES> C@ C, H2+ - , ; : (BC, (B, DOES> C@ C, C, ; | : (, HEADER EX W, PERFORM ;       : (? (B, DOES> C@ LOCT 0= A" ?" + ;  0 (? ?0  2 (? ?1  4 (? ?2  : [:] ?2 DUP PUSH @ A" REDEFINE?" POP ,MARK ;                   : (1 (C DOES> (, ; : (2 (C , DOES> (, W, ;                      : (3 (C , , DOES> (, W, W, ; : (WC, (B, DOES> C@ C, , ;         0 (B, ZC,  ' CODE, (X CODE,, ,    ' TLIT (X TLIT, ,             -2 (- SAVE2 ALLOT      -1 (- SAVE1 ALLOT   232 (WRC, CALLI,     ' ' ALIAS  H'                                                                                                                   : ;CNTX CONTEXT XCHG PUSH TO CONTEXT EX POP TO CONTEXT ;        | : ?TARGET TSTART TEND WITHIN EX A" NOT TARGET!" ;             | : TARGET, DUP ?TARGET 0= EX , ;                               \ | : TARG+  AT FORTH ;CNTX -FIND ;                               HERE 16 ALIGN DUP  IS TSTART  DUP  TO THERE  TO HERE           12000 CLARY         HERE IS TEND    PAD  TO HERE \ SPACE       | : LOC2 -FIND  ( DUP IF OVER ?TARGET EX THEN) ?DUP 2+ 2+ ;     | : NOT_FND2 [',] NUM [',] ?LITERAL ;                           | : >: : SAVE2 COMPILE [ ' (INT @ , ] ;                         |  0 VALUE POINT  0 VALUE CICLES | : POINT! POP TO POINT ;      | >: CICLE  POINT  PUSH  CICLES 1+ TO CICLES ;                  | >: GGG DUP [IS] INTERPRET EXEC ;                                                                                                                                                                                                                                                                                               156 LOAD  ' SNUMBER TO NUM   ' LITERAL TO ?LITERAL                                            | : NOT_FND SNUMBER TLIT, ;      | 0 WARY CMND ] NOT_FND TARGET, EXEC ?, NOT_FND2 ?, [           : [ [',] [  POINT!  LOC2 CMND PERFORM CICLE ; ( INTERPRETTER)   : ]      ]  POINT!  LOCT CMND PERFORM CICLE ; ( COMPILER)       >: GO! ['] CICLE [ GGG ;                                        >: STOP ['] (INT GGG ;                                          >: ': : STOP ;                                                  >: '; [',] ; GO! ; IMMEDIATE              PRUNE                 TO ROOT   <% 14 17 THRU %>  TO OTHER  ROOT  META LIT TLIT       \ ONLY OTHER ALSO                                                              TO COMP  ' [ ALIAS [                                                                                                                                                                                                                                                                                             \ MAIN SCREEN   & TEST                                          OTHER TO ROOT   <%     18  LOAD %>                                                     30  LOAD    \ DEFINING WORDS             OTHER TO ROOT   <% 19  26  THRU %>                              ROOT  TO COMP    27 LOAD    \ COMPILING WORDS                   OTHER TO OTHER   28 LOAD    \ HELPERS FOR COMPILING WORDS       COMP TO COMP     29 LOAD    \ COMPILING WORDS                                    49 LOAD    \ : ; DOES> ;CODE ABORT" ."         OTHER TO ROOT    GO! <%     \ TST PLACE                                                                                                                                                         %>               STOP ROOT                                                                                                                                                                                                                                                                                                      OTHER TO OTHER   >NEST (1  : CSP] \ COLON DEFINITION FROM NOW                    >>:   (1 >: CSP] \                             OTHER TO ROOT    GO!                                            <%           31 33 THRU   \ CONSTANTS, VARIABLES & PRINTS       %>               STOP                                           COMP                                                                             META ;code DOES>   META ;code ;CODE                             META (A" ABORT"    META LIT" "                                  META (." ."        \ NOW FIXED                 OTHER TO ROOT    GO!                                            <%           34 40 THRU                                         %>               STOP                                                                                                                                                                                                                                                                                                           \ CODE BSTR  >PUSHES CALLI,  LODSB, CBW, RET, END-CODE          | : U. [AT] # 0 D. ;                                            | : ##. EMIT C" # EMIT U. ; | : bl#. bl ##. ;                   :TR- FOPEN BLWORD 1+ OPEN DUP 0< A"  OPEN ERROR " ;             \ : +.+ + PUSH + POP ; : /STR TUCK NEGATE +.+ ; : ++ TUCK +.+ ; \ : THRU 1+ SWAP ?DO I LOAD LOOP ;   : +THRU BLK ++ THRU ;      | : /META IF ' 2+ STR , 2- , ;THEN  DO: @R+ @R+ ! ; IMMEDIATE                                  META COMPILE /META               : P#. CR BLK U. >IN 1L /MOD ." ROW " U. ." POS " U. BIOS-KEY ;  \ : ADDR. DUP ?ID. ['] : OVER = 0; DUP H. DUP BIOS-KEY ;        \ : TEST C" | EMIT SPACE  >IN . BLK . BIOS-KEY ; IMMEDIATE      \ : ;S EOS-ON ; IMMEDIATE  : TEST ; IMMEDIATE                   \ : LOAD ( n -) DUP C" < ##. DUP PUSH LOAD  BIOS-KEY            \      HERE bl#. S. POP bl#. ." LOADED #>" CR ;                                                                                                                                                 \ VOCABULARY TEMP                                                                 0 VALUE P1    0 VALUE P2 \ REORDER  OF VOCAB  : ?GET1 CONTEXT @ DUP TO P1 ?DUP IF  N>C 2- @ CONTEXT ! THEN ;  : PUT1  CURRENT @  P1 N>C 2- !  P1 CURRENT ! ;                  : ?INSERT  CURRENT @ TO P2 P2 P1 U< IF PUT1 ;THEN BEGIN P2 DUP    PUSH N>C 2- @ TO P2  P1 P2 U<  WHILE RDROP REPEAT P2  P1 N>C     2- !  P1 POP  N>C 2- ! ;  : ?SAME CONTEXT CURRENT XOR ;      : >LIST  ?SAME 0;  BEGIN ?GET1 P1 WHILE PUT1 REPEAT ;           : XLIST CONTEXT CURRENT TO CONTEXT TO CURRENT ;                 : ;XLIST ?SAME 0= IF RDROP ;THEN >LIST XLIST EX XLIST ;         : ;CURRENT CURRENT XCHG PUSH TO CURRENT EX  POP TO CURRENT ;    : <ORDER ;XLIST BEGIN ?GET1 P1 WHILE  ?INSERT  REPEAT ;         : MPUT? P1 C@ 128 AND IF AT MACROS ;CURRENT THEN PUT1 ;         : >IMMED ;XLIST BEGIN ?GET1 P1 WHILE MPUT? REPEAT ;                                                                                                                                             : EXECUTE PUSH ;                                                 : 1Z, 0 C, ;                                                    : N>LINK N>C 2- ;                                               : OFF 0 SWAP! ;                                                 : ON -1 SWAP! ;                                                 : ALIGN 1- SWAP 1- OR 1+ ;                                                                                                      ' IOV @ ' SCRH TO @ 1- SWAP 1- SWAP 3 MAKER QUAN ,              ' bl @ 1 MAKER CONSTANT ,                                       ' SCRH TO @ 2 MAKER VALUE ,                                     ' INITW TO @ 2 MAKER VECTOR ,                                                                                                    HERE VALUE THERE   ' H.  VECTOR  `.                             : T|H HERE THERE TO HERE TO THERE ;                                                                                                                                                            ( FLOAD CONTROL.TX  1                                          : CSP! CSP SP TO CSP ;                                          : ?CSP SP CSP - A" SP CHG!" TO CSP ; )                                                                                           1024  CONSTANT 1K                                              32768  CONSTANT #SIGN                                            1028  CONSTANT B/BUF                                            16    CONSTANT 1H                                               31    CONSTANT #LEN                                             64    CONSTANT 1L                                                                                                                HERE TO THERE   15000 ALLOT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ MARKER --FIND                                                 CODE  FIND  BX DI MOV,  LODSB, AX CX AND,                         CL 0 /DI CMP,  0=, IF, DI INC,  REPZ: CMPSB,                    0=, IF,  DI SKIPW, THEN, THEN, CX SI ADD,  RET,               HERE TOBE                                                         AX POP, SI PUSH, AX BX XCHG, CS PUSH, AX SI XCHG, ES POP,       BEGIN, SI DX MOV, 0 /SI CX MOV,                                     CXZ, J, 2  CX SI MOV, 31 #, CX MOV, ' WFIND 2+ CALLI,       0=, UNTIL,  255 #, CH MOV,  2 /SI BX LEA,  FB: 2  SI POP,       DUP, DX PUSH, CH AH MOV, AX BX XCHG, NEXT, END-CODE           EXIT                                                            CODE SCOMP  255 #, CX MOV, AX POP,  SI PUSH, AX SI XCHG,            ' WFIND 2+ CALLI, 0=, NOT, IF, CX INC, THEN, CX BX MOV,         SI POP, NEXT,  END-CODE                                     : PROBA BLWORD AT FORTH VFIND ; ' VFIND @ $TEST                                                                                  MARKER --FIND  MACROS TO MACROS   55 LOAD                      \                                                                 : ;VAR! TUCK @SWAP XCHG SWAP PUSH PUSH EX POP POP SWAP! ;       0 VARIABLE 'WITH     : DOWITH 'WITH ;VAR! 'WITH PERFORM ;     : WPARSE bl WORD ;                                              : WSEARCH ( VOCA -' CFA PWA) BLWORD  SWAP WFIND  0< 0= A" ?" ;  : ?' ( ANAME AVOC - CFA/ANAME -1/0 ) WFIND  NIP 0< ;            : WGET  ( CFA PWA - WA)   SWAP 2- @ @SWAP ;                     : WCUT  ( VOCA -' WA) WSEARCH WGET ;                            : WPASTE ( WA -) DUP PUSH CURRENT SWAP @SWAP POP N>C 2- ! ;     : WMOVE CONTEXT WCUT  CURRENT WPASTE ;                          : PROBA ;                                                                                                                                                                                                                                                                                                                       \ NEW MAIN CICLE  ax-sp  sp-rp dx-top di-ar bx-w cx-?  bp-      \ >does >var >l >.br >sbr >0br >br >next >for >-br              L: >DOES  CX POP,  SI PUSH,  CX SI MOV,   L: >V  2 /BX CX LEA,  L: >W     DX CX XCHG,           L: >DIPC    AX SP XCHG,         L: >DUPC  CX PUSH,              L: >XS      AX SP XCHG,         L: >N ( NOP / NEXT )  BX AX XCHG,  LODSW,  BX AX XCHG,          L: >XI   0 /BX JMP,    L: >L AX SP XCHG, DX PUSH, AX SP XCHG,   L: >_    0 /SI DX MOV,          L: >.BR 2 /SI SI LEA, >N JMP,   L: >SBR  2 /SI BX LEA, BX PUSH, L: >BR  0 /SI SI MOV, >N JMP,   L: >0BR  DX CX MOV, >BR JCXZ, >.BR JMP,                         L: >NEXT CX POP, >.BR JCXZ, CX DEC,  CX PUSH, >BR JMP,          L: >FOR  AX CX XCHG,  LODSW, AX CX XCHG, DX DEC, >PUSH JNL,       CX SI MOV, >DROP JMP,   L: >-BR DX DX OR, >JMP JNL, >.BR JMP, L: >EX  CX POP, SI PUSH, CX PUSH,    L: >RET  SI POP, >N JMP,                                                                                                                                   L: >-C  DX NEG,         L: >+C  AX SP XCHG,  CX POP,              CX DX ADD, DX PUSH,   1 #, DX RCR, >X JMP,                    L: >@A   0 /DI CX MOV,  BX SKIPW,                               L: >DUP  DX CX MOV,     >W JMP,                                 L: >OR  AX SP XCHG,  CX POP,  CX DX OR,   >X JMP,               L: >AND AX SP XCHG,  CX POP,  CX DX AND,  >X JMP,               L: >XOR AX SP XCHG,  CX POP,  CX DX XOR,  >X JMP,               L: >NOT  DX INVERT,  >NOP JMP,   L: >A!   DX DI MOV, >DROP JMP, L: >@!A  DX 0 /DI XCHG, >NOP JMP,  L: >POP CX POP,              L: >!A+  DX AX XCHG, STOSW, DX AX XCHG,  CL SKIPB,              L: >P ( PUSH)    BX PUSH,       L: >D ( DROP)   AX SP XCHG,     L: >/D  DX POP, >XS JMP,        L: >@A+   0 /DI CX MOV,         L: >A++ 2 /DI DI LEA,   >W JMP,                                                                                                                                                                                                                                 MARKER -S. SWITCH: SS RDROP 27 -: ABORT                                         83 -: S. 82 -: R. ;SWITCH                        : S. R@ DUP H. @ DUP H. ?ID.  [AT] $                                 BEGIN CR KEY $ DF AND SS AGAIN ;                          CODE @.! AX POP,  AX 0 /BX XCHG, AX PUSH, /CODE                 | CODE (;@.! AX POP, AX 0 /BX XCHG, X,                                  CX POP, BX PUSH, AX PUSH, CX PUSH, X, DROP, /CODE       : ;VAR! ( N VARA) (;@.! EX POP POP ! ;                                                                                            VARIABLE P1  VARIABLE P2                                      \ : DOWITH 'WITH  ;VAR!  'WITH  PERFORM  ;                      : SUM P1 ;VAR! P2 ;VAR! P1 @ P2 @ +  ;                                                                                                                                                                                                                                                                                          MARKER -LOC | 16 6 * ALLOT   VARIABLE SFRAME   \ 16  LOCALS     ASM SFRAME 2- NEGATE /DI DI LEA, -16 #, DI OR,                      SFRAME /// AX MOV,   AX DI ADD, RET,  /ASM                  CODE FUNC( DUP,  -4 /BP AX LEA, X, SI PUSH,                        SFRAME /// AX XCHG,  AX PUSH,   2 /DI SI LEA,   \ FRAME            AH AH XOR, LODSB,  AX CX MOV,  CXZ, NOT, IF,                BEGIN X, DROP, X, DUP, CXZ, UNTIL,        \ PARAMETTERS         THEN,  LODSB,  AX CX XCHG,  CXZ, NOT, IF, \ LOCALS              BEGIN AX PUSH, CXZ, UNTIL,  THEN,  X, DROP, /CODE             HERE ASM  DUP, SFRAME 2+ CALLI, DI BX MOV,  /CODE    \ LOC      HERE ASM  SFRAME 2+ CALLI, BX 0 /DI MOV, DROP, /CODE \ LOC!     HERE ASM  DUP, SFRAME 2+ CALLI, 0 /DI BX MOV, /CODE  \ LOC@     3 MAKER LVAR ,                                                  CODE RETURN X, SFRAME /// SP MOV, SFRAME /// POP,                       SI POP, X, /CODE                      PRUNE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ ?EMIT ?TYPE DUMPLINE DUMP                                        : ?EMIT DUP bl < IF DROP C" . THEN EMIT ;                       : ?TYPE FOR COUNT ?EMIT NEXT DROP ;                          : >EMIT? 33 127 WITHIN ;                  -HEADERS              | : 'C CREATE [',] C" C, DOES> C@ EMIT ;                          'C `" "     'C `' '     'C `# #                                 'C `[ [     'C `] ]     'C `. .                               | : DUMPLINE CR DUP H. 1H  2DUP 2/ FOR WCOUNT SPACE FLIP H.              NEXT DROP SPACE `[ ?TYPE `] ;                            : DUMP 1H ALIGN 1H / FOR DUP DUMPLINE 1H + NEXT DROP ;         : TRACE CR ' TR EXEC -TR ; IMMEDIATE                           : #NUM `# 0 .R SPACE ;    : 'CHAR' `' EMIT `' SPACE ;           : "STR"  `" COUNT ?TYPE `" SPACE ;                              : ?STACK POP WCOUNT SWAP PUSH SP PUSH ?EXEC  POP SP - #NUM ;    : UNNEST POP RDROP RDROP RDROP PUSH ;                                                                                                                                                                                                                            : PREVIOUS AT ORDER# TO CONTEXT ;                               : ALSO CONTEXT TO ORDER# ;                                      : DEFINITIONS CONTEXT TO CURRENT ;                              : ONLY ORDER# OFF TO FORTH ALSO MACROS ALSO HIDDEN ALSO ;       : SPACES 0MAX FOR SPACE NEXT ;                                   : HOME 0 0 GOTOXY ;                                             : PAGE (CLSC HOME ;                                             : .LINE ( 3 .R) `. SPACE 1L ?TYPE ;                             : .BLOCK CR SCR `. 16 0 DO DUP I CR .LINE 1L + LOOP DROP ;                                                                      ONLY                                                                                                                                                                                                                                                            0 VALUE FENCE                                                   : forget DUP FENCE  U< A" fence !" PUSH (  - R@ )  BEGIN VOCLINK                                                       (      - )            @ ?DUP R@ U<        (  -     ?)        ~WHILE @ VOCLINK !                                              REPEAT   (    -      )    VOCLINK  (      - )     BEGIN DUP 2- (         )     BEGIN @ DUP                                                      (     -   )           -->                                                                                                                                                                                                                                                                                                                                                                                               R@ U<           ( -  -     ?)         ~WHILE N>C 2-     ( -    -   )       REPEAT            ( -    -v )                  OVER 2- !         (    )                    @ ?DUP            (      ?)             ~UNTIL FORTH        ( FORTH -> CONTEXT)                         TO FORTH POP        ( FORTH -> CURRENT)                         TO HERE             ( R> -> HERE )                              DROP ;              ( VOCLINK @ )                               : FORGET ' C>N DROP forget ;                                                                                                    HERE TO FENCE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  : PRUNE VOCLINK                                                  BEGIN DUP PUSH  (                   )               V>LINK   (              )          BEGIN @ DUP   (              )            HERE U<     (    >= HERE                 )        ~WHILE N>LINK REPEAT  (             )        DUP R@ V>LINK !                                                       (        < HERE)              (                 )        ?DUP IF DUP PUSH      (     -  )        BEGIN N>LINK          (                    )                                                                             -->                                                                                                                                                                                        @ ?DUP                (                           )        WHILE DUP HERE U<     (      < HERE)        IF DUP POP            (            )          N>LINK                (        )           ! DUP PUSH            (                              )          THEN                  (                             )           REPEAT                (                              )          0 POP N>LINK !        (     )          THEN                                                            POP @ ?DUP ~UNTIL     (  )                         -HEAD                                                           ;                                                                                                                                                                                                                                                             : ;SWAP! SWAP OVER @ CO SWAP! ;                                 : +!       ;SWAP! + ;                                           : XOR!     ;SWAP! XOR ;                                         : OR!      ;SWAP! OR ;                                          : AND!     ;SWAP! AND ;                                         : @!  SWAP ;SWAP! -ROT ;                                        : EXCHANGE ;SWAP! @! ;                                                                                                          \ : EXCHANGE  OVER @ @! @! DROP ;                                                                                                                                                                                                                               -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ MACRO ENGINE                                                                                                                   M: DUP BEGIN COUNT  0= UNTIL 1- OVER - ;M                       ( 4 TO HEADER)                                                  0 VALUE MH   : SWAPH HERE MH TO HERE TO MH ;                    M: TO MH AT MACROS ! ;M                                                                                                         M: AT MACROS @ MH ;M   HEADER MAC , , ,  C" ; STACK> MAC:       : MAC> CREATE AT MAC: @ WORD COUNT STR, 1Z, IMMEDIATE                  DOES>  EVAL ;                                           : >MAC SWAPH CURRENT PUSH TO MACROS EXEC POP TO CURRENT SWAPH ;  M: ['] MAC> >MAC ;M    ' MAC: !    : ?MAC ' 2+ AT MAC TYPE ;   M: AT MAC: @ [',] C" AT MAC: ! MAC: AT MAC: ! ;M   ' MAC: 2+ !   : -MAC  0 MPTR TO MAC ;     -MAC                                : MLOAD ['] LOAD CONTEXT PUSH MACROS >MAC POP TO CONTEXT ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \ STREEM EVALUATION  - SEVAL   USING EXPECT3                  \\: ;GETBUF ( N -- A )  POP   RP ROT - RP OVER                       TO RP  PUSH SWAP PUSH   CO POP TO RP ;                       VARIABLE LINES  CREATE OK ," ><o  bl C, 15 ALLOT  1 OK +!        -HEADERS    0 VALUE ?HAND  : ?SEOF ?HAND HANDLES = ;           : HAND! HANDLES TO ?HAND  TO HANDLES  0 LINES !  ;              : OK? CR BLK IF CO EXIT THEN OK ". CO SPACE ;                   : 1LINE 1 LINES +! OK?  0 TO >IN  TIB 80 EXPECT  CO                   0  TIB SPAN + C! TO INTERPRET ;                           : ?IO BLK NOT IF SIO EXIT THEN FIO ;                            : FOPEN HANDLES bs - 0= ?? FOPEN DUP 0< A" OPEN ERR" ;          | : SEVAL ( HANDLE NBLK ) ;TI  TO BLK  ?IO                        90 ;GETBUF TO TIB  HAND!  BEGIN  1LINE  ?SEOF UNTIL  ;        : ;S HANDLES 0; AT HANDLES BLK 1+ 0= IF CLOSE THEN DROP ;       : FLOAD FOPEN  -1 SEVAL ?IO ;  : KBD  0 0 SEVAL ?IO ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ 63 64 THRU  \ CONTROL                                         \ 49 LOAD \ FUNC: RETURN LOCALS                                 \ 77 LOAD \ STREEM EVALUATION                                    104 LOAD \ MARKER                                               103 LOAD \ S. R.                                                 31 LOAD \ $ # % <# #>                                          116 LOAD \ SEE                                                 87 101 THRU \ ASSEMBLER                                         \ FLOAD DEBUG.F  CR BLK . .( BLOCK NUMBER)                      \ VOCABULARY ROOT  VOCABULARY CONTROL MARKER -ROOT              \  PRUNE   F83   35 LOAD 116 LOAD                               \ 111 LOAD  \ TARGET COMPILATION                                                                                                                                                                                                                                                                                                  55    LOAD     \ ALIASES                                                                                                        44    LOAD \ STRINGS                                            47    LOAD \ DOS COMMANDS, SHELL                                75 76 THRU \ MACRO ENGINE  + MACROSES                           25 30 THRU                                                      65 LOAD                                                                                                                       \ 83 84 THRU \ RECURCE CO   \ ; :                                 86    LOAD \ .(                                               \ 79    LOAD                                                      2 ATTR C!                                                      \ 67 LOAD \ FORGET      \ 70 LOAD \ PRUNE                       \ 69 LOAD \ WORDS       \ 81 LOAD \ NUMBERS                                                                                                                                                    (   PAD SPACES <# #> # #S SIGN D# D.R D. .R . U.   )             : UM/MOD TUCK U/MOD PUSH  SWAP TO U/MOD POP ;                   : S# 0 BEGIN 1+ PUSH BASE UM/MOD 2DUP OR POP SWAP                               0= UNTIL -ROT 2DROP ;                           : D# IF DABS S# 1+ PUSH -10 POP EXIT THEN S# ;                  : D.R PUSH D# POP OVER - SPACES  FOR ALPHA EMIT NEXT ;          : D. S>D 0 D.R SPACE ;                                          : . S>D D. ;                                                    : U. 0 D. ;                                                     : .R PUSH S>D S>D POP D.R ;                                     : U.R  0 0 ROT D.R ;                                            : UD. 0 0 D.R SPACE ;                                           : UD.R 0 SWAP D.R ;                                            : .. BASE PUSH 6 .R SPACE POP TO BASE ;                                                                                                                                                         \ LOAD EVAL THRU +THRU LIST ?LD --> COPY                                                                                        \ 0 NM: BLK PUSH >IN PUSH EXECUTE POP TO >IN POP TO BLK ;M      \  DUP                                                          \ HEADER LOAD , ] 0 TO >IN  TO BLK ?LD TO INTERPRET [           \ HEADER EVAL , ] 0 TO BLK TIB - TO >IN  TO INTERPRET [           : THRU 1+ SWAP DO I LOAD LOOP ;                                 : +THRU BLK DUP D+ THRU ;                                       : LIST DUP TO SCR BLOCK .BLOCK ;                                : ?LD BLK 0= A" LOADING?" ;                                     : --> ?LD 0 TO >IN BLK 1+ TO BLK ; IMMEDIATE                  : COPY BLOCK SCR BLOCK 1K CMOVE UPDATE ;                        : NCOPY FOR DUP COPY 1+ SCR 1+ TO SCR NEXT DROP ;               : <NCOPY FOR 1- DUP SCR 1- TO SCR COPY NEXT DROP ;                                                                                                                                              \ RECURCE CO                                                     ( WITH-ADDR ROOTLINK_ADR WITH-ADDR - )                          M: ( FIXLINX) BEGIN OVER @XCHG ?DUP 0= UNTIL DROP ;M TO ON;     0 NM: AT CURRENT N>C OVER ( FIXLINX) [ >MARK TO ON; ] OFF ;M    1 NM: LINK+ ;M                                                  2 MAKER RECUR ,                                                 ( TO FORTH ( AT RECURCE - FIXLINX)                              0 RECUR RECURCE HERE ON; ! ON; , IMMEDIATE                      M: ON; PUSH ;M ( THIS IS "AT CO")                               M: POP TO ON; AT , [ >MARK TO ON; ] TO ON; ;M                   ' RP 4 + @ ( v-- --v "DO" ">RELEASE" TRICKY WAY)                ( TO HIDDEN)                                                    HEADER CO , , ,  HERE 2- ON; !                                  ( TO FORTH)                                                                                                                                                                                    \ ;  :                                                           ' :  ( !!! VERY SPECIAL )                                      : : MAC  0 TO ON; CS! CSP! : TO CO                                       ?CS TO MAC [TO] RECURCE ;                               ( EXEC = LAST : )                                              EXEC ; ?CSP [',] ; BEGIN ON; ?DUP                                           WHILE EXEC REPEAT ; IMMEDIATE                       : .( C" ) WORD ". ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : WORDS CR 10 TO CSP CONTEXT -1 0 DO @ ?DUP                      IF DUP                                                             C@ #LEN AND 6 + OUTC + 80 <                                     ~IF CR CSP ?DUP                                                     IF 1- TO CSP                                                    ELSE 10 TO CSP KEY B>W 27 =                                         IF DROP I " LISTED" LEAVE THEN                              THEN                                                        THEN DUP H. DUP ID.                                             1H OUTC OVER MOD ?DUP                                           ~IF DUP THEN - DUP 13 < ~IF DROP 1 THEN                         OUTC 64 < ~IF 1- THEN SPACES                                    N>C 2-                                                       ELSE CR I " TOTAL" LEAVE THEN                                   LOOP ". ."  WORDS = " `. ;                                      F83                                                           ( assembler  -  control words   )                               F83 ONLY ASSEMBLER  ALSO DEFINITIONS  0 VALUE ?NEXT HEX         | : ?-CREATE >IN PUSH BLWORD 1+ C@ C" - = IF                           RDROP DROP ;THEN  POP  TO >IN ?NEXT EXEC ;               | : FAMILY ' TO ?NEXT FOR DUP ?-CREATE OVER + NEXT 2DROP ;      | : NFAMILY ' TO ?NEXT FOR [',] $ ?-CREATE NEXT ;               | : opc ( opcode -) ( - opcode) CREATE C, DOES> C@ ;            01 E1 2 FAMILY opc  EQ, CXZ,  -HEADERS                          0 0 3 FAMILY VALUE DISP FLAGS IMMED  | 4 BARY OPC : W, , ;      | : ASM-RESET 2 TO FLAGS  0 TO DISP  0 OPC OFF ;   : B, C, ;    02 70 8 FAMILY opc  O?, U<, 0=, U<=, 0<, P?, <, <=,  EA opc ?,  | : SHORT? ( n - f)  -80 80 WITHIN ;                            : BEGIN, ( - a) HERE ; | : ?A DUP SHORT? 0= A" SHORT-ADR?" ;    : N, 1 XOR ;    : IF,  ( OPC - A) N,  W, HERE ;                                                                                                                                                 : WHILE, ( A OPC -) IF, SWAP ; | : -?A - ?A EX 1- C! ;          : THEN,  ( A -) HERE OVER -?A SWAP ;      1L | WARY BRANCHES    : UNTIL, ( a opc) IF, -?A HERE ;   : ELSE, ?, WHILE, THEN, ;    | : FBI 0 1L FOR R@ BRANCHES 0 @SWAP IF R@ .. 7 EMIT 1+ THEN               NEXT  ?DUP IF DUP CR .. A" UNRESOLVED !" THEN ;      | : ^BRANCH [',] # DUP 1L U< 0= A"  BR#? "  BRANCHES ;          | : FB, ^BRANCH DUP 0 @SWAP A" REDEFINED! " HERE 2+ SWAP! , ;   | : ^< ^BRANCH 0 @SWAP ;        : L,? HERE 2+ FB, ;             : JMP,? E9 C, L,? ;     : CALL,? E8 C, L,? ;                    : FB: ^< THEN, ;  ( RESOLVE FORWARD BRANCH NUMBER)              | : FL?      ( A - A) 2- @ OVER - A" LBL? " ;                   | : WREL-FIX?  ( A -)  HERE OVER  3 - C@ FE AND E8 =                        IF  OVER - THEN SWAP 2- ! ;                         : FL: ^< DUP  FL?  WREL-FIX? ; : J, UNTIL, ;   : SJMP, ?, J, ;  : END-CODE FBI /ASM ;     ' ASM-RESET TO ASM%                                                                                   | : ;FLAGS ( MASK -) FLAGS EX TO FLAGS ;                        | : F-SET ( mask -) ;FLAGS OR ; | : F-GET ( mask -) FLAGS AND ; | : F-CLR ( mask -) COM ;FLAGS AND ; | : F-FLIP  ;FLAGS XOR ;   HEX  ( relative jumps   ) | : ;C,RST C@ EX C, C, ASM-RESET ;    | : ;RST C@ C, EX ASM-RESET ; | : ;,RST C@ EX C, , ASM-RESET ;  | : -CREATE >IN PUSH BLWORD 1+ C@ C" - = IF RDROP RDROP             ;THEN POP TO >IN CREATE ;                                   | : M1 ( n -) ( -)  -CREATE B, DOES> ;RST ;  \ CLC              | : G4 -CREATE C, DOES> ;RST HERE 2+ - W, ; \ CALLI             E8  G4  CALLI,    E9 G4 JMPI,                                   | : IMM? ( -f) 20 F-GET  ;  | : ACC? ( -f) 10 F-GET ;           | : ,IMM  ( n -) 5 F-GET 4 = IF ( S,-W)  B, ELSE  W, THEN ;       : W/ ( -)  1 F-SET  ; ( WORD PTR - the default is byte )      | : R>M  2/ 2/ 2/ ;   | : 1REG? 100 F-GET ;  | : 8* 2* 2* 2* ;    : F/ ( -)  2 F-SET ;  | : 16/ R>M 2/ ;                                                                                        HEX  ( bit-flags and reg seg & r/m defining words )             | : 2REGS? ( -f) 200 F-GET ;  ( xxxxxAccOIMBRSDW )              ( M=r/m; cc=reg count; I=immediate; A=accumulator; G=seg;)      ( S=imm.size; D=direction;  W=word or byte; O=disp only  )      | : <reg> ( a -n) DUP 1+ C@ DUP 1 AND 1 XOR 2* 2* OR F-SET C@ ; | : reg ( 000a000w00rrr000 -) ( - 0000000000rrr000)  CREATE ,         DOES> <reg>   2 F-FLIP  100 ;FLAGS + ;  ( COUNT REGS)     | : seg ( n -) ( -n) CREATE ,  DOES> <reg> 2 F-SET ;            | : r/m ( n -) ( disp - n) CREATE ,                                   DOES> <reg>  2 F-CLR ( D) SWAP TO DISP ;                  : B#,  24 F-SET ; : W#, 20 F-SET ;                              : #, ( n1 - n1) DUP SHORT? IF B#,  ;THEN W#, ;                                                                                                                                                                                                                                                                                  ( default D is on, r/m clears it, reg flips it, seg sets it)    ( D=0 when r/m field is destination )                           ( bits 3-5=reg, bit 8=W, bit 9=D flg, bit 12=ACC flg )          HEX ( R/M & REG are 16bit constants, but reg keeps count )        1 4000 8 FAMILY r/m  X/S X/D P/S P/D /SI /DI /BP /BX          1000 reg AL     8 0008 7 FAMILY reg  CL DL BL AH CH DH BH       1100 reg AX     8 0108 7 FAMILY reg  CX DX BX SP BP SI DI        C006 r/m ///   8 0900 4 FAMILY seg  ES CS SS DS                | 0 BARY F$  4457 , 4753 , 4941 , 4F4D ,                        : .F ( -) 8 FOR 20 R@ 2^ F-GET IF DROP R@ F$ C@ THEN               EMIT NEXT FLAGS 100 / 3 U.R ."  regs " ;                                                                                                                                                                                                                                                                                                                                                     HEX ( REG>R/M  #,  orW  11mod  01mod  10mod  ,DISP BYTE )       | : orW ( --opc---   -  --opc--w)  1 F-GET  OR ;                | : orDW ( --opc---  -  --opc-dw)  3 F-GET  OR ;                | : modDISP, ( 2nd - ) 40 F-GET ( ie M)                           IF 80 F-GET ( ie Only) IF C, DISP ,                               ELSE 8 F-GET ( ie G) DISP OR  OVER 7 AND 6 = OR ( ie[BP])       IF DISP SWAP OVER SHORT?                                          IF 40 OR C, C, ELSE 80 OR C,  , THEN                          ELSE ( zero & not seg) C, THEN  THEN ELSE C0 OR C,  THEN ;                                                                  \   DECIMAL  84 LOAD                                            | : NAME? ; IMMEDIATE                                                                                                                                                                                                                                                                                                           HEX     ( one byte opcodes with no variables )                  8 NFAMILY M1  D7 XLAT,  CF IRET,  C3 RET,  CB RETF,  90 NOP,                  53 DUP,  5B DROP,   CC INT3,                      1 98 8 FAMILY M1  CBW, CWD, - WAIT, PUSHF, POPF, SAHF, LAHF,    1 F8 6 FAMILY M1  CLC, STC, CLI, STI, CLD, STD,                 1 F0 6 FAMILY M1  LOCK: - REP: REPZ: HALT: CMC,                 8 26 4 FAMILY M1  ES: CS: SS: DS:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( 2 operand instructions such as ADD,  )                        HEX     | : M2 ( n -) ( various - ) CREATE C,                     DOES> NAME? C@ PUSH  IMM?                                        IF ACC? IF     DROP  POP orW 4 OR C,                                    ELSE   1REG? IF R>M THEN  80 orW C,                                    POP 38 AND OR  modDISP,                                  THEN  ,IMM                                              ELSE  2REGS?  IF SWAP R>M THEN                                        POP orDW C, OR modDISP,    THEN  ASM-RESET  ;           8 0 8 FAMILY M2  ADD, OR, ADC, SBB, AND, SUB, XOR, CMP,                                                                        HEX  | : M3 ( n -) ( reg -) CREATE C, DOES> NAME? C@                   orW C, DROP ASM-RESET   ;                                2 A6 5 FAMILY M3 CMPS, LODS, MOVS, SCAS, STOS,                  2 6C 2 FAMILY M3 INS,  OUTS,                                                                                                    HEX ( MOV,) ( one byte instr w/ W  - the string instructions )  : MOV, NAME? IMM?                                                 IF  1REG?  IF   R>M B0 OR 1 F-GET  2* 2* 2* OR C,                          ELSE C6 orW C, modDISP,    THEN  ,IMM                ELSE 90 F-GET 90 =                                              IF   DROP DROP A0 2 F-FLIP orDW C, DISP ,                       ELSE  2REGS? IF   2 F-GET ( ie D) IF SWAP THEN  R>M  THEN        8 F-GET ( ie G) IF 1 F-CLR 8C ELSE 88 THEN  orDW C,             OR  modDISP,  THEN THEN  ASM-RESET ;                         ( M6 for the rotate & shift instructions )                      HEX  | : M6 ( n -) ( n# r/m | r/m    - ) CREATE C,               DOES> NAME? C@ IMM? 16/  2 XOR  1 F-GET ( ie W) OR D0 OR C,        1REG? IF SWAP R>M THEN OR modDISP,  IMM? IF DROP THEN                 ASM-RESET  ;                                          8 0 8  FAMILY M6  ROL, ROR, RCL, RCR, SHL, SHR, - SAR,                                                                          ( mul, div, xxxxxxxW  mdNNNr/m ) ( M5 for LDS, LEA, & LES, )    HEX  | : M4 ( n -) ( -) CREATE C,                                DOES> NAME? C@ F6 orW C, SWAP 1REG? IF R>M THEN OR  modDISP,         ASM-RESET  ;                                              -8 38 6 FAMILY M4  IDIV, DIV, IMUL, MUL, NEG, INVERT,           | : M5 CREATE C, DOES> NAME? C@ C, OR modDISP, ASM-RESET  ;     3 NFAMILY M5    C5 LDS,  8D LEA,  C4 LES,                                                                                       : RECOVERB 0 C, RECOVER ;                                       : SKIPB, 0 SWAP B#, MOV, RECOVERB ;                             : SKIPW, 0 SWAP W#, MOV, RECOVER ;                              : SKIPCB, 0 #, AL ' EXEC RECOVERB ;                             : SKIPCW, 0 #, AX ' EXEC RECOVER ;                              | : int CREATE C, DOES> C@ C, C, ;                              $ CD int INT,                                                                                                                   HEX ( INC, & DEC, instructions )   ( IN, OUT, instr )           | : M7 ( n -) ( r1 | r/m  -) CREATE C,                             DOES> NAME? C@ SWAP  1REG? IF  ( opc r1) R>M THEN               1REG? 100 =  1 F-GET AND  ( ie it's a 2-byte register)          IF  ( opc rX)  OR 40 OR C,  ( opc mem | opc rH | opc rL )       ELSE FE orW C,  OR modDISP, THEN  ASM-RESET  ;               08 M7 DEC,   00 M7 INC,                                         | : M9 ( n# r1 | r1) CREATE C,  DOES> NAME? C@  orW NIP              IMM? IF ( n# opc)  C, ( n#) ELSE ( opc) 8 OR THEN C,            ASM-RESET ;                                                2 E4 2  FAMILY M9   IN, OUT,                                                                                                                                                                                                                                                                                                                                                                    ( PUSH, & POP, instructions ) HEX                               | : M8 ( n -) ( reg | seg | r/m  -)  CREATE ,                      DOES> NAME? @  8 F-GET                                            IF  ( seg opc ) 16/ 1 AND 1 XOR 6 OR OR C,                      ELSE 1REG?                                                      IF  ( reg opc ) 2/ 8 AND 8 XOR 50 OR SWAP R>M OR C,             ELSE ( r/m opc) DUP 100 U/ FF AND C,  OR modDISP,               THEN  THEN  ASM-RESET ;                                    FF30 M8 PUSH,  8F00 M8 POP,                                     ( use   port #, AL IN,  or  port #, AX IN,  for 8 bit ports )   ( or    AL IN,  or  AX IN,   for port in the DX register  )     | : M10 CREATE , DOES> NAME? @ , ;                              8 NFAMILY M10   21CD DOS,  16CD KBD,  10CD VIDEO,  0AD4 AAM,                0AD5 AAD,  13CD DISK,   E587 X,  10D4 AAH,                                                                                                                                          HEX ( XCHG )  ( TEST, instruction  - almost like ADD, etc. )    : TEST,  ( various - ) NAME? IMM?                                  IF ACC? IF     DROP  A8 orW ( 4 OR) C,                                  ELSE   1REG? IF R>M THEN  F6 orW C, ( OR)  modDISP,             THEN  ,IMM                                              ELSE  2REGS?  IF SWAP R>M THEN                                        84 orW C, OR modDISP,                                     THEN  ASM-RESET  ;                                           : XCHG,  ( reg mem | mem reg | reg1 reg2   -)   NAME?             211 F-GET 211 = ( 2 regs & one is AX)                           IF  ?DUP IF NIP THEN ( r1 ) R>M  90 OR C,                       ELSE  2REGS? IF  R>M  THEN  OR  86 orW C, modDISP,              THEN  ASM-RESET ;                                                                                                                                                                                                                                             HEX ( CALL, instr  ) ( INT,  & segment override instructions )  : CALL, ( various -) NAME?  IMM?   ( intra-seg direct )           IF  ( n#)  HERE 3 + - ( make it relative)                           E8 C, , ( eg 2389 #, CALL, calls addr $2389)                ELSE ( mem | reg  -)  1REG?  IF R>M  THEN                           FF C,  10 OR modDISP, ( eg 0 [BX] CALL, or DX CALL, )       THEN  ASM-RESET ;         ( this is intra-seg indirect )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( JMP, instr  &  NXT, )    HEX                                  : JMP, NAME?                                                           ( various -) 140 F-GET ( ie R or M  intra-seg indirect )    IF ( mem | reg  -)  1REG?  IF R>M  THEN                            FF C,  20 OR modDISP, ( eg 0 [BX] JMP, DX JMP, )                                      ( or 3759 rt-paren JMP,  )             ELSE  ( a) HERE 3 + -                                            ( relative) DUP SHORT? IF 1+ EB C, C, ELSE  E9 C,  ,  THEN      ( disp is added to IP, so this is a relative jump )          THEN  ASM-RESET ;   : AGAIN, JMP, ;  | 0 VALUE JPOINT          : PNT! HERE TO JPOINT ;  : PNT@ JPOINT ; : >PNT JPOINT JMP, ;    ' NOP @   TO ?NEXT      : TOBE CFA ! ;                         : NEXT, ( -) ?NEXT JMP, ;  : /CODE NEXT, END-CODE ;             PREVIOUS                                                        FORTH  F83 ( 96 LOAD)  ASM  ' JPOINT ALIAS PNT@ /ASM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ASM  L: >BOOT CLD, 0 #, JMP,    L: >COLD CLD, 0 #, JMP,         L,? 3   L,? 2   LODSW, L: >EX AX DI XCHG, 0 /DI JMP,            L: >TRON  $ 2EB #, AX MOV, ?, NOT, IF,    L:  F> SI JMP,        L: >TROFF >EX 1- AX MOV, THEN,   DI SKIPW, L,? 1 STOSW, RET,    L: :F> SI PUSH,  X, SI POP, X, RET,   L: >TRF: >TROFF CALLI,    L: >F: X, SI PUSH, X,           L: >F  SI POP, ?, NOT, IF,      L: >SWAP! DI POP, CX SKIPW, SCASW,                              L: >VAR! SCASW, BX 0 /DI MOV,                                   L: >DROP DROP, ?, NOT, IF, SCASW, SCASW,  FL: 3                 L: >CONST 2 /DI AX MOV, ?, NOT, IF,  SCASW, SCASW,              L: >VAR   2 /DI AX LEA,  THEN,    L: >PUSH  DUP,                L: >SWAP AX BX XCHG, THEN, THEN, FL: 1  HERE TO ?NEXT ( !!!)    L: >MAIN LODSW, AX DI XCHG, 0 /DI JMP,                          >TRF: CALLI, FL: 2 Z,    :F> , >TRON CALLI, >EX 1- JMP,                                                                                                                                         L: >RP@ BP AX MOV, >PUSH JMP,   L: >RP! BX BP MOV, >DROP JMP,   L: >SP@ DUP, SP BX MOV, NEXT,   L: >SP! BX SP MOV, >DROP JMP,   L: >PERF 0 /BX BX MOV,          L: >EXEC   AX POP, AX BX XCHG,  L: >?EX AX CX MOV, >MAIN JCXZ, >EX JMP,   SCASW, SCASW,         L: >DEFER SCASW, 0 /DI AX MOV, >?EX JMP,  L: >ALIAS >DEFER JMP,            SCASW, SCASW,        L: >NEST   2 /DI AX LEA,        L: >?NEST  SI AX XCHG,                                          L: >ARPH -2 /BP BP LEA, AX 0 /BP MOV, NEXT,                     L: >;: SI 0 /BP XCHG, NEXT, SCASW, SCASW,                       L: >DOES AX POP, DUP,  2 /DI BX LEA, >?NEST JMP,                L: >XCHG BX 0 /BP XCHG, NEXT,  \ XCHG                           L: >CONT -2 /SI AX LEA, >ARPH JMP,                              L: >#PUSH  AX POP, BX AX XCHG, >ARPH JMP,                       L: >CALL LODSW, >?NEST JMP,                                                                                                                                                                         1 #, BX SHL,  BX DI ADD,  1 #, BX SHL,                      L: >ARY 1 #, BX SHL, 2 X/D BX LEA, NEXT,                        L: >BLIT LODSB,        L: >BPUSH   0 #, AH MOV, >PUSH JMP,      L: >MLIT LODSB,        L: >MPUSH  -1 #, AH MOV, >PUSH JMP,      L: >DLIT DUP, LODSW, AX BX XCHG,                                L: >LIT   LODSW, >PUSH JMP,                                     L: >!+  0 /BX POP,     L: >2+ BX INC,    L: >1+ BX INC, NEXT,   L: >-! -2 /BX POP,     L: >2- BX DEC,    L: >1- BX DEC, NEXT,   L: >@PC+ AX AX XOR, CX POP, DUP, SI 0 /BP XCHG, SI BX MOV,          CX CALL, AX SI ADD, >;: JMP,                                L: >@PC' >@PC+ CALLI, AL LODS, RET,                                END-CODE                                                                                                                     \  >F: IS #4th:   >F IS #4th   >VAR IS #var  >CONST IS #const   \ >NEST IS #nest   >CALL  IS #call  >DOES IS #does                                                                              CODE C!+ CX POP, CL 0 /BX MOV, >1+ JMP,  END-CODE               CODE C@+  0 CH MOV, 0 /BX CL MOV, CX PUSH, >1+ JMP, END-CODE    CODE @+  0 /BX PUSH, >2+ JMP, END-CODE                          CODE -C! CX POP, CL -1 /BX MOV, >1- JMP,  END-CODE              CODE -@ -2 /BX PUSH, >2- JMP,  END-CODE                         CODE -C@ 0 CH MOV,  -1 /BX CL MOV, CX PUSH, >1- JMP, END-CODE   CODE 2*  1 #, BX SHL, NEXT, END-CODE                            CODE 2/  1 #, BX SAR, NEXT, END-CODE                            CODE ROT   CX POP,  AX POP, CX PUSH, DUP,  >SWAP JMP,  END-CODE CODE -ROT  AX POP,  CX POP, DUP, CX PUSH,  >SWAP JMP,  END-CODE CODE AND   AX POP,  AX  BX AND,  NEXT,  END-CODE                CODE OR    AX POP,  AX  BX OR,   NEXT,  END-CODE                CODE XOR   AX POP,  AX  BX XOR,  NEXT,  END-CODE                CODE - BX NEG, L: >PLUS AX POP,  AX  BX ADD,  NEXT,  END-CODE                                                                                                                                   CODE +.2/  AX POP, AX BX ADD, DUP, 1 #, BX RCR, NEXT,           L: >IF  BX BX OR,               L: >0=IF 0=, IF,                L: >JMP 0 /SI SI MOV, NEXT,     L: >UNNEST  0 /BP SI MOV,       L: >RDROP  2 /BP BP LEA, NEXT, THEN,                            L: >SKIP 2 /SI SI LEA, NEXT,                                    L: >#IF  AX POP, AX BX XCHG, AX AX OR,  >0=IF JMP,              L: >-IF  BX BX OR,  >JMP JNL,  >SKIP SJMP,                      L: >NEXT -1 #, CX MOV,  CX 0 /BP ADD,  >JMP JB,                              2 /SI SI LEA, >RDROP SJMP,                         L: >OF    AX POP,  AX BX XCHG,  AX BX CMP, >JMP JNE,                      DROP, >SKIP JMP,                                      L: >?FOR  AX POP,  AX BX XCHG,  AX DEC, >JMP JL,                         2 /SI SI LEA,  >ARPH JMP,                                 204 LOAD     END-CODE   \ FIND  STR=  ...                                                                                                                                                    CODE INVERT BX INVERT, NEXT,    L:  >PUSHES CX POP, BX SI XCHG,      CX CALL,  BX SI XCHG,  >PUSH JMP, END-CODE                 CODE NIP    AX POP, NEXT,  END-CODE                             CODE SWAP  AX POP, >PUSH JMP, END-CODE                          CODE STR   >PUSHES CALLI,  LODSW, RET, END-CODE                 CODE CSTR  >PUSHES CALLI,  LODSB, 0 #, AH MOV, RET, END-CODE    CODE BSTR  >PUSHES CALLI,  LODSB, CBW, RET, END-CODE            CODE DSTR  >PUSHES CALLI,  CX POP, DUP, LODSW, AX BX XCHG,            LODSW, CX JMP,  END-CODE                                  CODE 0=  1 #, BX SUB,     L:  >CARRY BX BX SBB, NEXT, END-CODE  CODE 0< 1 #, BX SHL, >CARRY JMP, END-CODE                       CODE U< AX POP, BX AX SUB, >CARRY JMP, END-CODE                 CODE UNPACK AX AX XOR, AL BH XCHG, >PUSH JMP, END-CODE                                                                                                                                                                                                          CODE PACK AX POP, BL AH MOV, >SWAP JMP, END-CODE                CODE +*   1 #, DL TEST, 0=, NOT, IF,                                   AX POP, AX BX ADD, AX PUSH, THEN,  1 #, BX RCR,                1 #, DX RCR, NEXT, END-CODE                               CODE -/ 1 #, DX SHL,  1 #, BX RCL, AX POP,  AX BX CMP, AX PUSH,     U<, NOT, IF, AX BX SUB, DX INC, THEN,  NEXT, END-CODE       CODE DUP   DUP, NEXT, END-CODE                                  CODE POP   DUP, 0 /BP BX MOV, >RDROP JMP, END-CODE              CODE  A  DUP,  DX BX MOV, NEXT, END-CODE                        CODE A!  BX DX  MOV,  DROP, NEXT, END-CODE                      CODE OVER  AX POP, AX PUSH, >PUSH JMP, END-CODE                                                                                                                                                                                                                                                                                                                                                   >JMP  CODE, jump     >?FOR CODE, ?for     >SKIP CODE, skip       >IF  CODE, if        >-IF CODE, -if      >NEXT CODE, next      >#IF  CODE, #if      >CALL CODE, call        F> CODE, 4th>       >OF  CODE, of                                                >UNNEST CODE, EXIT    >PERF  CODE, PERFORM  >MAIN CODE, NOP      >EXEC  CODE, EXEC       >;: CODE, EX     >RDROP  CODE, RDROP   >XCHG   CODE, XCHG    >#PUSH CODE, PUSH   >SWAP!  CODE, SWAP!     >MLIT CODE, mlit   >DROP   CODE, DROP     >@PC' CODE, @pc+       >LIT CODE, lit      >BLIT CODE, blit     >DLIT CODE, dlit      >RP!  CODE, RP!      >RP@  CODE, RP@        >2+ CODE, 2+        >SP!  CODE, SP!      >SP@  CODE, SP@        >1- CODE, 1-        >PLUS CODE, +          >1+ CODE, 1+      TSTART CODE, boot      >FIND CODE, find       >2- CODE, 2-                           >CONST 2- CODE, DERR  >VAR! 1- , >VAR ,  L: >DERR 0 ,               0 , 0 , 0 , 0 ,  \  ERRORS IN DOS FUNCTIONS                                                                                 CODE -LEAD   ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,         DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB: 1  NEXT, END-CODE                                                                        CODE -LEAD#  ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,         DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB: 1  NEXT, END-CODE                                                                       CODE -TRAIL   ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,          DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB: 1  NEXT, END-CODE                                                                        CODE -TRAIL#  ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,          DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB: 1  NEXT, END-CODE                                                                       CODE WBLK  $ 40 #, CH MOV,      AX SKIPW,                       L: >RBLK  $ 3F #, CH MOV, DI POP, 1024 #, AX MOV,  AX  PUSH,      CX PUSH,    DI MUL,       AX DX XCHG,   AX CX XCHG,                    $ 4200 #, AX MOV,  DOS,  DI POP,  U<, NOT,                 IF,      DUP, DI BX MOV,                                    L: >DOS AX BX XCHG, DROP,  CX POP, DX POP, DS PUSH,                 >DERR 10 +  /// DS MOV, DOS, DS POP,  DI SKIPW,                 THEN,    DI POP, DI POP,  ES PUSH,  CS PUSH,  ES  POP,          >DERR 2+  #, DI MOV,   U<, IF,  AX -2 /DI MOV, THEN,            STOSW,  BX AX XCHG, STOSW,  CX AX XCHG, STOSW,  DX AX XCHG,     STOSW,  AX POP, STOSW, >DROP JMP, END-CODE                  CODE SCANI AX POP, AX SI XCHG, CX CX XOR, CX BX XCHG, CXNZ, IF,            BEGIN  0 /SI BL MOV,  1 X/S SI LEA,  CXNZ, UNTIL,    THEN,  SI AX XCHG, >SWAP JMP,                                                                                                                                                                   L: >SCAN: AX POP,  AX BX XCHG,     CX POP,    DI POP,                    CS PUSH,      ES POP,  CX DX MOV,   BX CALL,                    0=, NOT, IF,   DX CX MOV,  THEN,                         CX INC,   CX DX SUB,  AX DX XCHG,  >SWAP JMP,  END-CODE       CODE SCANW >SCAN: CALLI,  REP: SCASW, RET,  END-CODE            CODE SCANW< >SCAN: CALLI, STD  CX BX MOV, 0 X/D DI LEA,          -2 X/D DI LEA,   REP: SCASW,   CLD RET,  END-CODE              CODE SCANB< >SCAN: CALLI, STD  CX BX MOV,                          -1 X/D DI LEA,   REP: SCASB,   CLD RET,  END-CODE            CODE SCANB >SCAN: CALLI,  REP: SCASB, RET,  END-CODE            CODE SCANL >SCAN: CALLI,   SI PUSH,   BX BX  OR,                     AX BX  XCHG,   SI DI  MOV,   CXNZ,                         IF,  BX DI MOV,                                                      BEGIN, CX PUSH,  >STR= #,  CALL, CX POP,  EQ, UNTIL,       THEN,   SI POP,  RET,            END-CODE                         >RBLK  CODE, RBLK       >DOS CODE, (DOS                       10 VALUE BASE \ NUMBERS OUT   \ TEMPORARY  NUMBER               | 0 VALUE TN1  | 0 VALUE TN2  | : ;TNUM TN1 EX TO TN1 ;         FWD: SPACES  FWD: HOLD  FWD: S#                                 FWD: UD.   FWD: UD.R  FWD: U.R  FWD: .DH  FWD: D.R   FWD: D.    : S>D DUP 0< ; : <# TO TN2 TO TN1 0 ; : ;#> EX FOR EMIT NEXT ;  | : T/ ;TNUM TN2 BASE UM/MOD TO TN2 ;                           : ;.R XCHG PUSH EX POP OVER - [:] SPACES FOR SPACE NEXT ;       : ;SGN IF DABS EX  `- [:] HOLD SWAP 1+ THEN ;                   : 1# T/ >CHAR  TO HOLD ; SAVE2                                  : U. 0          [:] UD. 0 ;SPC          [:] UD.R 0 SWAP         [:] D.R ;#> ;.R ;SGN <# [:] S# BEGIN 1# TN1 TN2 OR 0= UNTIL ;   : . ;-TR S>D  [:] D. ;SPC S>D 0 TO D.R  ;  SAVE2                                                                                                                                                                                                                                                                                FWD: ;BASE                                                      1: C@ ;BASE U. ;                                                2: C@ [:] ;BASE BASE XCHG PUSH TO BASE EX POP  TO BASE ;        3: C@ TO BASE ;                                                 HEADER DECIMAL   ,   ,   ,   10  C,        HERE 7 -             HEADER HEX      W,  W,  W,   16  C,  DROP  HERE 7 -             HEADER BINARY   W,  W,  W,    2  C,  DROP  HERE 7 -             HEADER ALPHA    W,  W,  W,  201  C,  DROP  HERE 7 -             HEADER SEXTAL   W,  W,  W,    6  C,  DROP                       >VAR 2: TO CURRENT ;  3: TO CONTEXT ;                                         HEADER MACRO      ,  ,  , Z, Z,                    ' MACRO      HEADER ASSEMBLER W, W, W, W, ,                    ' ASSEMBLER   HEADER FORTH     W, W, W, W, ,                     HERE 2-       VALUE VOCLINK                                                                                                                                                                    : DIGIT? `A - -IF 7 + THEN 10 + DUP BASE U< ;                   | : T* ;TNUM BASE *  ;          | : ;SIGN EX NEGATE ;           | : T+ ;TNUM  C@A+ DIGIT? 0= A" ?" ;                            | : ;SWAP SWAP EX SWAP ;        |  FWD: (SSCAN                  1: CSTR [:] (SSCAN C@A+ SCANB  INVERT #IF OVER 1 SWAP U<                IF ;SWAP 1-  ;THEN THEN DROP ;A 1- ;                    2: CSTR 1- TO (SSCAN ;   |   HEADER @CH=? , , ,S" #$%^&`~-"     | FWD: @CH | >: @CH- CALL> [:] @CH  DROP C@A+ ;THEN EX 1L - ;   | 0 WARY XTABLE ] TO DECIMAL  TO HEX  TO BINARY  @CH-                   TO SEXTAL  TO @CH  TO ALPHA  ;SIGN [                    : (SNUMBER ( a # - n) NAP   @CH=? #IF INVERT XTABLE PERFORM         TO @CH=? #IF INVERT XTABLE PERFORM 0 THEN THEN  TO TN1         FOR  A T* A!  T+  NEXT  TN1 ;                                                                                                                                                                                                                                \ BLOCK BUFFER  FLUSH SAVE-BUFS EMPTY-BUFS  INIT-BUFS           | 0 VALUE LIMIT | 0 VALUE FIRST  | 0 VALUE USE  | 0 VALUE PREV  | : ;ERR EX PREV 2+ 1+ DERR A" IO-BLK ?" ;   | FWD: EMPTY-BUF   | : INIT-B FIRST DUP DUP TO USE TO PREV TO ;DROP ;              | : +BUF B/BUF + DUP LIMIT =  IF DROP FIRST  THEN DUP PREV - ;  | : ?SAVE-BUF CSTR IF DUP STR SCRH wblk 0 OVER 1- C! THEN 1- ;  FWD: EMPTY-BUFS : INIT-BUFS TO FIRST  TO LIMIT  [:] EMPTY-BUFS               INIT-B BEGIN DUP -1 EMPTY-BUF 3 - +BUF 0= UNTIL ;  : SAVE-BUFS  INIT-B BEGIN ?SAVE-BUF +BUF 0= UNTIL ;             : BUFFER USE DUP BEGIN +BUF UNTIL  TO USE DUP TO PREV               ?SAVE-BUF [:] EMPTY-BUF SWAP DUP B/BUF ERASE 1+ !+ ;        : BLOCK ;ERR PUSH PREV 1+ @ I  -  IF PREV BEGIN +BUF 0=             IF DROP POP BUFFER 2- STR SCRH rblk  ;THEN                           DUP 1+ @ I = UNTIL   TO PREV  THEN RDROP ;             : FLUSH SAVE-BUFS TO EMPTY-BUFS ;                                                                                               \ KEY / STR  EXPECT                                             CODE KEY  >KY CALLI, /CODE                                      : /STR TUCK - PUSH + POP ;                                      : EXPECT ( a # - /a -# ) 0 -ROT ( 0 A # - )  BEGIN #IF PUSH         CR DUP H. OVER H. I  H.                                           KEY 255 AND  ( # a key) CASE                                    13 OF RDROP EXIT ENDOF                                           8 OF OVER #IF DROP 1 /STR 1                                                bs EMIT SPACE bs EMIT THEN ENDOF                       DUP 32 U< IF 7 EMIT  0  ELSE                                  ( # a key) DUP EMIT OVER C! -1 /STR -1                            THEN   DUP                                                   ENDCASE                                                     POP + REPEAT DROP ;                                                                                                                                                                           \ WORD BLWORD C>STR MAKESTR NBLK  /THRU                                                         : ?LD 1 A" LOADING?" ;          FWD: STREEM  FWD: >STREEM       FWD: >LOAD   FWD: -->           ' NOP  ' ?LD   ' ?LD   V3BLK ?BLK  | : ;WORD EX 0 C!A+ HERE ;   : BLKSTRM /TIB #IF NIP >IN ;THEN DROP                               BLOCK 1K + TO /TIB  [:] STREEM /TIB >IN ;                   : /THRU /BLK = IF RDROP ;THEN   [:] --> ?BLK 1+                 [:] >LOAD PUSH -1K 0 POP [:] >STREEM  TO BLK TO /TIB  TO >IN ;  ' BLKSTRM ' STREEM  DUP   V3BLK NBLK   FWD: C>STR  FWD: MAKESTR ' /THRU   ' RDROP ' RDROP   V3BLK X                             FWD: WORD    : BLWORD bl (  TO WORD ;)                          [:] WORD ;WORD PUSH  BLK NBLK I -lead  TUCK POP -lead#              TO >IN OVER + SWAP NEGATE >IN +  HERE  OVER 0= IF ;DROP     [:] C>STR   A!  1  C!A+ C!A+     ;THEN                          [:] MAKESTR ;DROP A! DUP C!A+ FOR CSTR C!A+ NEXT ;                                                                              \ ;TI  LOAD  EVAL  ;TBUF IO! OK? KBD  SEVAL THRU                FWD: IO! FWD: SEVAL FWD: THRU \ 0 VALUE POINT                   0 VALUE CICLES   0 VALUE  'PNT  0 VECTOR  'NUM                  0 VECTOR 'LIT  0 VECTOR INTERPRET                               : ;TI POP BLK PUSH /TIB PUSH >IN PUSH /BLK PUSH PUSH EX               POP TO /BLK POP POP POP  >STREEM ; \ IN /TIB BLK          : LOAD DUP [:] THRU ( blk /blk -) ;TI TO /BLK >LOAD INTERPRET ; : EVAL ( a l -)  ;TI NEGATE TUCK + 0 >STREEM INTERPRET ;        : ;IO   POP 'EMIT PUSH 'KEY PUSH PUSH IO! EX POP POP            [:]  IO!  TO 'EMIT TO 'KEY ;                                    : ;TBUF POP RP@ TIB OVER TIB# - DUP RP! TO TIB  PUSH PUSH              PUSH TO BLK  EX   POP  POP  TO TIB  RP!  EOS OFF  ;      : OK? BLK IF EX CR ;THEN      ."  Ok" CR EX SPACE ;             : 1LINE OK? TIB TIB# EXPECT BLK >STREEM EX INTERPRET ;                                                                                                                                          ' (DEMIT  CONSTANT  STD-EMIT    ' (BKEY  CONSTANT D-KEY         ' (DKEY   CONSTANT  STD-KEY     ' (BEMIT CONSTANT D-EMIT        ' (FKEY   CONSTANT  STD-FKEY                                                                                                    : KBD  0 STD-KEY   STD-EMIT      \ BLK=0 IS FLAG FOR KEYBOARD   [:] SEVAL ;IO ;TI  ;TBUF  BEGIN EOS @ 1+  0; 1LINE AGAIN ;      : FOPEN BLWORD 1+ OPENF DUP 0< A"  OPEN ERROR " TO HANDLES ;    : FLOAD FOPEN  -1  STD-FKEY  STD-EMIT  TO SEVAL ; \ -1 FILE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     FWD: VSEARCH  : \' BLWORD AT MACRO  TO VSEARCH ; SAVE2          : -' BLWORD AT FORTH  [:] VSEARCH FIND TO XCHG ;                0 VECTOR COMPILE,   : LITERAL, 'NUM ', LITERAL ;                | : PNT! POP TO 'PNT ;                                          >: QUIT init BEGIN KBD AGAIN ;  SAVE2                                                                                           : ?ANY SWAP -ROT VSEARCH ROT PUSH IF  POP THEN RDROP ;          | : FINDING BLWORD 'PNT  PUSH  CICLES 1+ TO CICLES ;              0 WARY AWORD ] LITERAL, COMPILE, 'NUM EXEC [ \ TABLE          | >: INTER FINDING AWORD PERFORM INTERPRET ;  SAVE2             MACRO   : [ PNT! 3 AT FORTH ?ANY 2 ;                \ INTERPRET FORTH   : ] PNT! 3 AT MACRO ?ANY 1 AT FORTH ?ANY 0 ; \ COMPILE                                                                  : STOP! \\ [ ['] INTER TO INTERPRET ;                                                                                                                                                           \ U.R# UR.  .H .DH  DU DUMP  N>C C>N                            : N>C CSTR + 2+ ;       : ;.[] EMIT `[ EMIT EX `] EMIT ;        : U.R# ;SPC lf ;BASE  [:] U.R 0 SWAP  TO UD.R ;  SAVE2          | : HDU SPACE bs FOR CSTR B. SPACE NEXT ;                       | : UNITS? U/MOD SWAP IF 1+ THEN ;                              : DU CR DUP DUP H. HDU HDU  SWAP bl ;.[] 1H TYPE ;              : DUMP 1H UNITS? FOR DU NEXT DROP ;                                                 FWD: :HEX    FWD: ID.                       | : C>N? 2- DUP PUSH 2- bl FOR -C@ SWAP 0= 0= OVER                   N>C WITH =  AND  IF RDROP POP ;THEN                            DUP C@ bl U<= IF I POP XOR PUSH THEN   NEXT DROP POP 0 ;    : C>N  2+ C>N? IF 1 ;THEN C>N? IF 3 ;THEN  C>N?                       IF 5 ;THEN  2+ 2+ 0 ;                                                                                                                                                                                                                                     \ :HEX  ID. C>N  ?ID.  (ERROR STKIP S. R.                       | HERE 2- MARK/ MARK/ /MARK ," AT /MARK ," TO  CONSTANT TO_AT   : ?ID. C>N #IF 1- #IF SPACE TO_AT + @ ID. SKIP THEN DROP        [:] ID. CSTR TYPE SPACE ;THEN DROP  [:] :HEX `: EMIT H. ;                                                                       : (ERROR CR HERE ID. BLK TO SCR >IN TO CSP STYPE CR ;           ' (ERROR  TO  ON-ERR  | FWD: MS2 | : ;S<>R S<>R PUSH EX S<>R ;                                0 VALUE STKIP  \ STACK SKIP ON R. | : MS1 POP SWAP ;.[] SPACE -ROT SWAP - 2- DUP 0< A" STK UNDER"       1K OVER U< A" STK OVER" 2/ NAP  0; A PUSH cr MIN  A! ;    : S. SP@ SP0 `S MS1  0 TO STKIP TO MS2 ; SAVE2                  : R. RP@ RP0 `R MS1 ;S<>R  [:] MS2 A STKIP + FOR XCHG PUSH NEXT   A  FOR POP I U. XCHG NEXT   STKIP  FOR POP XCHG  NEXT  ;                                                                                                                                                                                                      \ NAME HIDDING                                                  \ : WITHIN OVER - PUSH - POP U< ;                               | >DEBUG 10 + CONSTANT DEBUGP  ! : ROT. ROT DUP H. ;            ! : 3ROT. ;.[] ROT. ROT. ROT. bs EMIT ;                         : DBG. DUP H. @ DUP H. PUSH `S 3ROT. POP S<>R                            SPACE `R 3ROT. S<>R SPACE  ?ID. ;                      HERE >DEBUG !   ' DBG.  >DEBUG 2+ ! \ FIX DEBUGGER              ASM >-TR CALLI, ] PERFORM  KEY DROP   BRK. [ >EX 6 - , /ASM                                                                     | : ;CSP CSP EX TO CSP ;  : ?CSP SP@ ;CSP - A" SP CHG!" ;       : CSP! ;CSP SP@ ;                  : /ASM PREVIOUS ?CSP ;       | 0 VECTOR ASM%          : ASM ALSO ASSEMBLER CSP! ASM% ;                                                                                                                                                                                                                                                                       \ COMPILER STUFF   - NO NAME GENERATION                         0 VALUE  THERE    FWD: <N>   | : ;<N> EX TO <N> ; SAVE2         : SWAP@! SWAP STR -ROT 2- ! ; : VSWAP OVER @ SWAP@! SWAP! ;     | : ;HERE HERE EX TO HERE ;                                     VARIABLE -HEADERS     | VARIABLE HIDE-CNT     | FWD: HIDE?      : <N HIDE-CNT OFF  -HEADERS  TO HIDE? ; SAVE2                   : N> HIDE-CNT [:] HIDE? @ IF HIDE-CNT -HEADERS VSWAP THEN       [:] <N> NPTR ;HERE TO NPTR ;    : <% THERE ;HERE TO THERE ;     | : ;-HEAD -HEADERS @ EX -HEADERS ! ;                                                                                           \ : C>N? 2- DUP PUSH 2- 31 FOR -@ SWAP  UNPACK  bl U<=  SWAP    \       0=  OR     IF RDROP TO ;C>N? THEN   DUP N>C WITH =      \       IF RDROP POP ;THEN 1+ NEXT  [:] ;C>N? DROP POP 0 ;      \ CODE VSWAP LIKE P! 2+ TOBE AX DI XCHG, 0 /DI AX MOV,          \   AX 0 /BX XCHG,  STOSW, RET, END-CODE                                                                                        FWD: ,   FWD: C,   FWD: ALLOT  FWD: S,  | FWD: H2+              | : ;CFA! EX HERE TO CFA ;    | : ;, EX , ;                     : BCOMPILE POP C@+ PUSH        [:] C,     ;HERE C!+ ;           : COMPILE POP @+ PUSH          [:] ,      ;HERE !+ ;            : HP, ;,                       [:] H2+ HERE 2+ ;                : SAVE2 ;HERE 2- ;              : SAVE1 ;HERE 1- ;              : Z, 0 , ;                      : ZC, 0 C, ;                    : MARK/ HERE Z, ;               : /MARK HERE SWAP! ;            : LOOP/ MARK/ HERE ;            : /LOOP , /MARK ;               : FIX    DUP PUSH @ A" REDEFINE?" POP /MARK ;                   : W, STR , ;                    : =? - A" PAIRS!" ;                                             : ?? 0= A" ?" ;                                                                                                                                                                                                                                                                                 \ ' >ALIGN ALIGN ALIGNED CLARY ZARY IS ;-NAME                   ( : ' -' ?? ; )  FWD: >ALIGN   FWD: CLARY  FWD: IS                                                                              : ALIGN DUP 1- SWAP IF DUP DUP 1+ AND THEN A" 2^?" SWAP         [:] >ALIGN 1- OR 1+ ;   : ALIGNED HERE SWAP ALIGN HERE -        [:] CLARY HERE OVER ERASE ALLOT ;       : ? @ . ;               : ZARY,  HERE DUP PUSH 2- EXEC POP - TO CLARY ; SAVE2           | : [IS] POP @+ PUSH 2+ ! ;     | : ;-NAME <N EX N> ;           \ : META '   [:]  IS ' 2+ ! ;     : LIKE ' @ ; : BE ' ! ;       : RESCAN2 >IN BLWORD CURRENT VSEARCH  ROT TO >IN  NIP 0;             ." \+" BLK  TO DECIMAL  57 OUT < IF CR THEN HERE ID. ;     ' RESCAN2 TO 'SAME                                                                                                                                                                                                                                                                                                              >VAR    CONSTANT  #VARIABLE     >ALIAS  CONSTANT  #ALIAS        FWD: HEADER | FWD: HEAD  FWD: ,S     FWD: CREATE  FWD: ALIAS    FWD: VAR     FWD: 2VAR  FWD: 3VAR   FWD: CODE,     \                                                                            : 4VAR ;, [:] 3VAR   ;, [:] 2VAR   ;, [:] VAR  ;,  \            [:] CREATE #VARIABLE    [:] CODE,  ;,  \                        [:] HEADER ;CFA! ;-HEAD  DUP   IF      \ ?-HEAD  ;CFA!                   1- EX EX  HERE  <N>  ;<N>     \ ;-HEAD  IS DISCARDED   [:] ALIAS  ;, #ALIAS ;, ELSE RDROP DROP THEN \                  [:] HEAD BLK , 'SAME CURRENT HERE SWAP@! ;,  \                  [:] ,S BLWORD CSTR LEN# MIN SWAP -C!         \                  [:] S,    C@ 1+                              \                  [:] ALLOT ;HERE + ;  : VARIABLE  0 TO VAR ;  : CVAR CREATE C, ;                                                                                                                                                                                                 | : ;( HEADER  EX  W, PERFORM ;       \         : (XW   2VAR DOES> W, PERFORM ;     \ 1      : (X1   2VAR DOES> ;( ;             \ 2 .. 1MAKER  + EXEC   : (X2   3VAR DOES> ;( W, ;          \ ..       2MAKER  + EXEC   : (X3   4VAR DOES> ;( W, W, ;       \ ..       3MAKER  + EXEC   : (W     VAR DOES> @ , ;            \ WORD COMPILER             : (X@   2VAR DOES> @+ PERFORM ;    : W3,  , , , ;               : (XX   2VAR DOES> @+ PUSH EXEC POP PERFORM ;                   | : (BR,  CVAR DOES> C@ C, H2+ - , ; \ .. + R,                    232 (BR, CALLI,   : ,S" `" WORD S, ;                          MACRO    ' , 0 (XW LITERAL  ' CALLI, 0 (X@ DOES,  0 (W ;code,    0 (W  DROP,  ' ,S"  0 (XW A"   ' ,S"  0 (XW ." ' ,S"  0 (XW "  ( : [:] ' 2+ 2+ FIX ;)  : \\ \' ?? , ;                           : ['] [ ?1 LITERAL ] LITERAL @ , ;                             FORTH                                                                                                                           1: C@ -' ?? + ;  0 OVER HEADER ?0 , C,                          2 OVER HEADER ?1 , C,        4 SWAP HEADER ?2 , C,              | 0 VECTOR %ASM                                                             ' ZARY,     >WARY (X1  WARY                                     ' ZARY,  >WARY 2+ (X1  BARY                                     ' ZARY,  >WARY 2- (X1  DARY                                     ' ZARY, >WARY 4 - (X1  FARY                                     ' ,        >CONST (X1  CONSTANT                                 ' Z,       >DEFER (X1  DEFER                               ' Z,   >FJMP >FSUB     (X2  FWD:                                ' ,    >VAR! >CONST 1- (X2  VALUE                               ' ,   >VAR! >DEFER 1-  (X2  VECTOR                                         ' W3, >VBLK (X1  V3BLK                                                                                                                                                                                                                        \ HELPERS & DEFINING WORDS                                       ' ,  >VAR >VAR! 1- >CONST 2- (X3  QUAN                          ' ,  >VAR >VAR! 1- >DEFER 2- (X3  VQUAN                        |   : CSP] CSP! ]  ;       |  : [CSP ?CSP \\ [ ;                |   : (M: HERE SWAP CALLI, CSP]  ;                              |   : (A>F CALLI, /ASM CSP] ;     | : (F>A [CSP ASM ;           ' (M:      >F: (X@  N:     ' (M:     >DOES (X@  1:              ' (M: >DOES 1- (X@  2:     ' (M:  >DOES 2- (X@  3:              ' (A>F      >F (X@ >4TH    ' (A>F     >F:  (X@  4TH:                                                                            ' CSP]   >>:   (X1 >:    \ JUMP TO WORD - NO NESTING                                                                                                                                                                                                                                                                                                                                            MACRO                           \ COMPILATION WORDS                               \ DOES, & ;code, NEEDS OVERIDDING              ' (F>A ' ;code, (XX  ;CODE     ' DOES, ' ;code, (XX  DOES>       ' (F>A  F> 2- (XW  4TH>        ' (F>A ;F> 2- (XW  ;4TH                                                                              ' , H' ?0  (XX  ',                                              ' , H' ?2  (XX  AT       ' LITERAL   ' ?0  (XX  \'        ' LITERAL H' ?1  (XX  \TO      ' LITERAL   ' ?2  (XX  \AT        ' HERE  ' PUSH (XW  FOR/      ' ,      ' next (XW  /NEXT        ' LOOP/ ' ?for (XW  FOR       ' /LOOP  ' next (XW  NEXT         ' MARK/ ' (0BR (XW  IF        ' MARK/    ' of (XW  OF           ' MARK/  ' -if (XW  -IF       ' MARK/    ' if (XW  #IF          ' MARK/ ' call (XW  CALL>     ' /MARK  ' EXIT (XW  ;THEN                                                                                                                                                                                                       \ COMPILATION WORDS   -  EXTENSION                               ' ,      ' (BR (XW  AGAIN          ' , ' (0BR (XW  UNTIL        ' MARK/  ' (BR (XW  AHEAD           ' /MARK ALIAS  THEN         ' CSP! ALIAS CASE                                              : ELSE \\ AHEAD  SWAP \\ THEN ;                                 : ENDCASE COMPILE DROP BEGIN SP@ CSP - WHILE                        \\ THEN  REPEAT TO CSP ;   : REPEAT SWAP \\ AGAIN \\ THEN ; : BEGIN HERE ;       : WHILE \\ IF ;   : ENDOF \\ ELSE ;        \    H' \ ALIAS \       H' ( ALIAS (      H' T[ ALIAS  [        FORTH                                                           : TO ?1  EXEC ;  : AT ?2  EXEC ;                                 ' CSP]   >NEST (X1 :                                           \ MACRO    ' ,  ' ?1  (XX  TO      ' ,  ' ?2  (XX  AT           \                           ' [CSP ' EXIT  (XW ;                \ FORTH                                                                                                                         $C000 CONSTANT EDGE   : -HEAD EDGE TO NPTR ;  3 VALUE NBUFS                                                                     : F83 FORTH TO FORTH DECIMAL STOP! D-KEY  D-EMIT TO IO! ; SAVE2 >: _ABORT  F83 CLOSALL init QUIT ;  SAVE2                       >: BOOT   init  F83      RP0                                            -HEAD -1K NBUFS B/BUF * - DUP  \' _ABORT TO ABORT               TO RP0  1K - TO SP0  init   -1K RP0  INIT-BUFS                  ABORT  'INIT ( $80 CSTR EVAL) QUIT ; SAVE2                                                                              : T. TRON + TROFF ;                                                                                                             ' BOOT 2+  >BOOT 2+ !                                           HERE ' HERE 4 + !                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               : ;RBUF POP RP@ ROT - RP@ OVER RP! PUSH SWAP PUSH EX POP RP! ;  VARIABLE LINES  VARIABLE ?HAND : ?SEOF ?HAND @ HANDLES @ = ;    : HAND! HANDLES @ ?HAND ! HANDLES ! LINES OFF ;                 : OK? CR BLK @ IF EX ;THEN C" > EMIT EX SPACE ;                 : 1LINE 1 LINES +! OK?  ACCEPT EX >INTERPRET ;                  : ?IO BLK @ IF FIO ;THEN SIO ;                                  : FOPEN HANDLES bs - 0= ?? FOPEN DUP 0< A" OPEN ERR" ;          : SEVAL ;TI BLK ! ?IO   90 ;RBUF 2+ TIB ! HAND!                          BEGIN 1LINE ?SEOF UNTIL ;                              : ;S HANDLES 0; AT HANDLES BLK 1+ 0= IF CLOSE THEN DROP ;       : FLOAD FOPEN  -1 SEVAL ?IO ;  : KBD  0 0 SEVAL ?IO ;                                                                                                                                                                                                                                                                                                                                           #FLUSH +COMP  PVECTOR FLUSH   #BLOCK +COMP  PVECTOR BLOCK       #, +COMP  PVECTOR ,   #C, +COMP  PVECTOR C,                     #] +COMP  PVECTOR ]   #[ +COMP  PVECTOR [ IMMEDIATE             #HEAD +COMP  PVECTOR HEADER     : BCOMPILE POP C@+ PUSH C, ;    : COMPILE POP @+ PUSH , ;   : 2Z, COMPILE [ 0 , ] ;             : W, @+ SWAP , ; : DCOMPILE POP W, W, PUSH ;                    : VALUE HEADER DCOMPILE [ #CONST +COMP @+ DROP 1- ,                        #VAR! +COMP @+ DROP , ] , ;                          : VECTOR HEADER DCOMPILE [ #VECT +COMP @+ DROP ,                           #VAR! +COMP @+ DROP , ] , ;                          : CREATE HEADER COMPILE [ #VAR +COMP @+ DROP , ] ;              : VARIABLE CREATE 2Z, ;     : 2VARIABLE VARIABLE 2Z, ;          : CONSTANT HEADER COMPILE [ #CONST +COMP @+ DROP , ] , ;         1024  CONSTANT 1K     64  CONSTANT 1L   16  CONSTANT 1H         1030  CONSTANT B/BUF   0  CONSTANT 0    -1  CONSTANT -1           15  CONSTANT LEN#  255  CONSTANT BYTE#    -->            \\\ 1 CONSTANT 1    2 CONSTANT 2   -2 CONSTANT -2                   : ;LIT" POP POP DUP A! PUSH PUSH A EX  POP COUNT + PUSH ;       : ! !+ DROP ; : @ @+ DROP ;  : C! C!+ DROP ; : C@ C@+ DROP ;    : SWAP! SWAP ! ;  : OFF 0 SWAP! ;  : ON -1 SWAP! ;              : !A  A ! ; : @A A @ ; : +! A! @A + !A ;                        : WCOUNT @+ SWAP ;    : @SWAP OVER @ PUSH SWAP! POP ;           : C!A  A C! ;   : C@A  A C@ ;   : 2@ @+ @ SWAP ; : 2! !+ ! ;    : !A+ A !+ A! ; : @A+ A @+ A! ;  : C!A+ A C!+ A! ;              : C@A+ A C@+ A! ;                                               : IND POP POP DUP PUSH SWAP PUSH ;                              : ROT PUSH SWAP POP SWAP ;                                      : -ROT SWAP PUSH SWAP POP ;                                     : TUCK SWAP OVER ;                                              : NEGATE INVERT 1+ ;                                            : - NEGATE + ;  : ABS -IF NEGATE THEN ;  -->                                                                                    \ : ;code POP CFA @ ! ;  : HERE H @ ;  : ALLOT H +! ;           \ : DOES> COMPILE ;code [ >LIT , >DOES , ]                      \      BCOMPILE [ 232 C, ]  HERE 1+ 1+ - , ; IMMEDIATE          : 0= #IF DUP XOR ;THEN INVERT ; : S>D -IF -1 ;THEN 0 ;          : U< - DROP <IF 0 ;THEN -1 ; : = XOR 0= ; : 0< S>D NIP ;        : WITHIN OVER - PUSH - POP U< ;   : < - 0< ;                                    : 2DUP OVER OVER ;   : 3DROP DROP DROP DROP ;   : D+ PUSH A! PUSH A + POP POP +C ;   : M+ S>D D+ ;              : DNEGATE INVERT SWAP INVERT 1+ #IF SWAP ;THEN SWAP 1+ ;        : D- DNEGATE D+ ;        : DABS -IF DNEGATE THEN ;              : UM* A! 0  LEN# FOR +* NEXT NIP A SWAP ;                       : (M/MOD PUSH SWAP A! POP LEN# FOR -/ NEXT NIP A ;              : U/MOD 0 (M/MOD ; : UM/MOD TUCK  U/MOD  PUSH (M/MOD POP ;      : U/ U/MOD NIP ;   : UMOD U/MOD DROP ;                          -->                                                                                                                             : /MOD OVER S>D NIP (M/MOD ;                                    : / /MOD NIP ;                                                  : MOD /MOD DROP ;                                               : ;NEG 2DUP XOR 2* DROP <IF EX DNEGATE THEN ;                   : ;/ POP SWAP PUSH PUSH EX POP UM/MOD ROT DROP ;                : M* ;NEG ABS PUSH ABS POP UM* ;   : * M* DROP ;                : UM*/ ;/ UM* ;                                                 : M*/ PUSH M* POP ;NEG ABS ;/ DABS ;                            : */ M*/ DROP ;                                                 : 16/ 2/ 2/ 2/ 2/ ;  : 256/ 16/ 16/ ;                           VARIABLE H     VARIABLE BASE   VARIABLE BLK   VARIABLE >IN      VARIABLE TIB   VARIABLE SCR    VARIABLE SCRH  VARIABLE CFA      VARIABLE OUT   VARIABLE AREG   VARIABLE BREG  VARIABLE CREG     VARIABLE DREG  VARIABLE EREG   0 VECTOR ERROR 2VARIABLE NUM     VARIABLE FIN     -->                                                                                                            $ 5E TIB !     : DOSEMIT  DUP DUP $ 200 (DOS 3DROP 3DROP ;      : IO4 (DOS EREG ! AREG ! DROP  CREG ! DREG ! DROP ;             : ?ERR EREG @ 2* <IF 2/ ERROR THEN ;  : ;ERR ?ERR EX ?ERR ;     : IO BREG @ SWAP IO4 ; : CLOSE_H DUP DUP DUP $ 3E00 IO4 ;       : OPEN_H DUP $ 3D02 IO ;                                        : POSBLK  BREG ! 1K UM* $ 4200 IO 1K ;                          : READBLK  ( SCRH @ ) POSBLK ;ERR $ 3F00 IO ;                   : WRITEBLK ( SCRH @ ) POSBLK ;ERR $ 4000 IO ;                   : DOSKEY   DUP DUP DUP $ 800 IO4 AREG C@ ;                      ' DOSEMIT VECTOR 'EMIT : EMIT 'EMIT 1 OUT +! ;                  : ACCEPT  $ 84 TIB @ 2 - TUCK ! DUP DUP  $ A00 IO4                 0 TIB @ 1- COUNT DUP    CREG ! + C!  ;    -->                                                                                                                                                                                                                                                                                 10 BASE !     : ALPHA -10 + <IF 65 + ;THEN 58 + ;              : CR 13 EMIT 10 EMIT 0 OUT ! ;                                  : 1H. 15 AND ALPHA EMIT ;    : 1B. DUP 16/ 1H. 1H. ;            : 1W. DUP 256/ 1B.  1B. ;    : 1D. 1W. 1W. ;                    : TYPE FOR/ COUNT EMIT /NEXT DROP ; : STYPE FOR/ EMIT /NEXT ;   : HOLD SWAP 1+ ; : 1# NUM 2@ BASE @ UM/MOD NUM 2! ALPHA HOLD ;  : S# NUM 2! 0 BEGIN 1# NUM 2@ OR 0= UNTIL ;                     : N>TYPE A! OVER - FOR/ A HOLD /NEXT ;  : SPACE 32 EMIT ;       : D# #IF DROP DABS S# C" - HOLD ;THEN DROP S# ;                 : D.R PUSH D# POP 32 N>TYPE STYPE ; : SPACES FOR/ SPACE /NEXT ; : D. S>D 0 D.R SPACE ;   : . S>D D. ;  : U. 0 D. ;              : .R PUSH S>D S>D POP D.R ;   : U.R  0 0 ROT D.R ;              : UD. 0 0 D.R SPACE ;         : UD.R 0 SWAP D.R ;               : .. BASE @ PUSH 6 .R SPACE POP  BASE ! ;                       121 LOAD                                                                                                                        ( HASH     WORD)                                                                                                                : WORD ( c - a)                                                   PUSH  SOURCE ( buf rem#) OVER SWAP ( buf buf #)                 >IN @ /STRING 0 MAX  ( ie remaining string)                     R@ -LEADING=  ( buf 1stChr rem#)                                OVER SWAP  ( buf 1stChr 1stChr rem#)                            POP -LEADING<> ( buf 1stChr LastChr+1 rem#) DROP DUP PUSH       ( buf 1stChr LastChr+1) OVER - ( buf 1stChr #) DUP HERE C!      HERE 1+ SWAP CMOVE ( buf) POP SWAP -  1+   >IN !  (   )         HERE ( a)    ;                                                                                                                : HASH ( n - vocab-a) CONTEXT SWAP - ;                                                                                                                                                                                                                          HEX TALIAS @ dA@- CONSTANT NONESUCH  ( no opcode $D6 )           CODE -FIND  ( h n -  h true | pfa false)                         SI DX MOV, ( save IP)  ' CONTEXT 2 + @ #, DI MOV,               BX DI SUB, ( hash)  DS AX MOV, AX ES MOV,  BX POP, ( 'here')    0 [BX] AL MOV, AH AH SUB, ( cnt)   AX INC,    DI PUSH,         BEGIN, DI POP,  0 [DI] DI MOV, ( get next link addr)             DI DI TEST, 0=, IF, BX PUSH,  BX BX SUB, BX DEC, DX SI MOV,     NXT, THEN, DI PUSH,  2 #, DI ADD, ( move to name field)        BX SI MOV, ( here) AX CX MOV, ( reload count) REPZ, AL CMPS,    0=, UNTIL,  ( fall thru occurs when count is all used up and )   ( the last compare was still equal, now check if indirect  )    AX POP, NONESUCH #, W-PTR 0 [DI] CMP, ( indirect pfa?)          0=, IF,  ( get indirect addr) 2 [DI] DI MOV, THEN,             DI PUSH, ( the pfa) BX BX SUB, ( the flag) DX SI MOV,            NXT,   END-CODE                                                                                                                 ( multiplies number by BASE & adds digit)                     | : -DIGIT ( c - n $ DF  AND)    $ 30 -  DUP 10 < 0=               IF  7 - DUP $ A < OR THEN   DUP BASE ( @) U< 0= A" ?" ;      |  : 10*+ ( u a c - u a)                                          -DIGIT ROT BASE ( @) * + SWAP ;                               | : ;SIGN OVER C@ $ 2D = IF 1 STR- EX NEGATE THEN ;              : (SNUMBER ( a # - n) ;SIGN                                      OVER C@ C" $ OF [AT] $  1 STR-  ELSE                                    C" # OF [AT] #  1 STR-  ELSE                                    C" % OF [AT] %  1 STR-  ELSE                                    C" ^ OF DROP 1+ C@ 64 - ;THEN ( char value)                     C" ` OF DROP 1+ C@      ;THEN DROP THEN THEN THEN        0 -ROT   FOR  CSTR 10*+ NEXT DROP  ;                          ( above allows  $FF  and  'a   type literals )                 : SNUMBER ( a - n) COUNT ( a #) (SNUMBER  ;                                                                                     ( Intrepreter                                         )         : -'  ( u - here t | pfa f)  32 WORD  SWAP -FIND  ;             : ' ( - pfa)   CONTEXT @ -' ABORT" ?"  ;                        : INTERPRET  ( blk# offset -)                                     >IN 2!    BEGIN 2 -' ( search FORTH)  IF NUMBER                                 ELSE EXECUTE  THEN  AGAIN  ;      RECOVER     : QUERY ( -) TIB @ 255 EXPECT  SPAN @ #TIB !  0 0 >IN 2!  ;     VARIABLE DEFAULT-TIB         ( must be initialized by RESET )   VARIABLE DEFAULT-FIB                                            : RESET-TIB ( -)  DEFAULT-TIB @ TIB !  DEFAULT-FIB @ FIB !  ;   : (QUIT  R0 @ RP!  RESET-TIB  ( CR )                              BEGIN CR QUERY                                                     0 0 ( blk offset) INTERPRET  ."  ok"                         AGAIN ;   RECOVER    ' (QUIT IS QUIT                                                                                                                                                          ( CLEAR  LIST                                         )                                                                         : (LIST ( n -)                                                    BLOCK ( n a) 16 FOR CR  DUP 64 TYPE   64 + NEXT  DROP  CR ;                                                                   : LIST ( n -)                                                     SCR N! DUP CR ." scr " U. SPACE  DUP >UNIT# .FILE  (LIST  ;                                                                   : CLEAR ( n -) BLOCK 1024 32 FILL  UPDATE ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (  compiling       )                                            2 CONSTANT CELL       : CELLS ( # - #')  2*  ;                  : ALIGN ( -)   H @ DUP 1 AND +  H !  ;                          : ALLOT ( n -)  H +! ;                                          : , ( n -)  H @ !   CELL ALLOT ;                                : C, ( c -) H @ C!  1 ALLOT ;                                   : ,A  ( a -)  dA @ - , ;                                        : COMPILE  POP DUP @ , CELL + PUSH ;                            COMPILER                                                          DEFER LITERAL                                                   : SLITERAL ( n - ) COMPILE lit  ,  ;    ' SLITERAL IS LITERAL   : [  POP DROP ;                                               FORTH                                                           : ]  BEGIN  4 -' IF 2 -FIND IF NUMBER \ LITERAL                          ELSE  ,A  THEN  ELSE EXECUTE  THEN AGAIN ;   RECOVER                                                                   ( compiling   )                                                 : LASTW ( - nfa n)  CONTEXT @ HASH @ 2 +  DUP C@ ;              : >CFA ( nfa len -pfa) + 1+ DUP @ NONESUCH = IF 1+ 1+ @ THEN  ; : SMUDGE  LASTW $20 XOR SWAP C! ; ( flip bit 5 of len byte)     : FORTH    2 CONTEXT ! ;                                        : COMPILER 4 CONTEXT ! ;                                        : ;code  POP LASTW ( + 1+) >CFA  ! ;                            COMPILER                                                        : [']  COMPILE lit   ;                                          : DOES> COMPILE ;code  $E8 C, ( call) ['] dodoes HERE 2 + - , ; : RECURSIVE  LASTW $0DF AND SWAP C! ;                           : ;  \ RECURSIVE  POP DROP  COMPILE EXIT  ;                     FORTH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( Defining words   )                                            FORTH                                                           : STRING ( delim -) WORD C@ 1+ ALLOT ;                          : CREATE  HEAD  COMPILE var ;                                   : :   HEAD  COMPILE docol  SMUDGE  ] ;                          : CONSTANT ( n) HEAD  COMPILE [ TCONST @ dA@- , ] , ;           : VARIABLE ( -)  CREATE  0 ,  ;                                 : CRASH ( -) -1 ABORT" no vector " ;             RECOVER        : DEFER ( -) HEAD  COMPILE [ TDODEF @ dA@- , ]                          COMPILE CRASH ;                                         : IS    ( a -) ' 1+ 1+ ! ;                                                                                                                                                                                                                                                                                                                                                                      ( WORDS  SP@  DEPTH  .S   ? )                                                                                                   : WORDS ( -) CR CONTEXT @ HASH BEGIN @ DUP WHILE DUP 2 +          COUNT 31 AND TYPE  2 SPACES  ?SCROLL  REPEAT DROP  ;                                                                          CODE SP@ ( - a) BX PUSH,  SP BX MOV,  NXT,  END-CODE                                                                            : DEPTH ( - words) SP@  S0 @ SWAP - CELL /   1-  ;                                                                              : .S  ( -) DEPTH  DUP 0< ABORT"  underflow "                       ?DUP IF DUP FOR  POP ROT PUSH PUSH NEXT                                   FOR  POP POP DUP U. SWAP PUSH NEXT ." <top "          ELSE ."  stack empty " THEN   ;                                                                                              : ? ( a -)  @ . ;                                                                                                               ( Structures       )                                            COMPILER                                                        : \ 4 -'  ABORT" ?"  ,A ;                                       : BEGIN ( - a) H @ ;                                            : UNTIL ( a -) COMPILE 0branch  ,A  ;                           : AGAIN ( a -) COMPILE branch   ,A  ;                           : THEN  ( a -) H @ dA @ -  SWAP ! ;                             : IF    ( - a) COMPILE 0branch  >MARK ;                         : WHILE ( a - a a ) \ IF  SWAP ;                                : REPEAT ( a a -) \ AGAIN  \ THEN ;                             : ELSE   ( a - a)  COMPILE branch  >MARK SWAP \ THEN ;                                                                          : FOR  ( - h) COMPILE for  >MARK  ;                             : NEXT ( h -) DUP \ THEN  2 + COMPILE next   ,A  ;              : I ( - n)  COMPILE R@ ;                                                                                                        ( Strings                                             )         HEX                                                             COMPILER                                                          : ABORT"  COMPILE abort"  22 STRING ;                           : ."      COMPILE dot"    22 STRING ;                           : (   29 WORD DROP ;                                            : IS ( pfa )  ' 1+ 1+  \ LITERAL COMPILE ! ;                    : "  ( -)  COMPILE (")  22 STRING 0 C,  ( asciiz for files) ;                                                                 FORTH                                                             : (  \ (  ;                                                     : ."  22 WORD TYPE$  ;  forget                                  : "  ( - a)   HERE  '" STRING  0 C,  ;                                        ( embed the string in the dictionary )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ BLK NBLK >IN HERE (WORD TO >IN ;                                                                                              : WORD ( c - a)                                                   PUSH  BLK NBLK DUP SPAN ( buf buf #)  >IN STR- ( remaining)     0 MAX R@   >LEAD< -LEADING=  ( buf 1stChr rem#)                 OVER SWAP  ( buf 1stChr 1stChr rem#)                            POP >LEAD< -LEADING<> ( bf Chr/ /Chr+1 rem#) DROP DUP PUSH      ( buf 1stChr LastChr+1) OVER - ( buf 1stChr #) DUP HERE C!      HERE 1+ SWAP CMOVE ( buf) POP SWAP -  1+   >IN !  (   )         HERE 0 OVER  COUNT + ! ( a)    ;                                                                                              : PROBA 32 WORD PAD "MOVE ;                                                                                                                                                                                                                                                                                                     : -LEADING=  ( ADR LEN CHAR -- ADR' LEN')   PUSH                  BEGIN 2DUP 0= SWAP C@ R@ XOR AND WHILE 1 STR- REPEAT RDROP ;  : -LEADING<> ( ADR LEN CHAR -- ADR' LEN')   PUSH                  BEGIN 2DUP 0= SWAP C@ R@ =   AND WHILE 1 STR- REPEAT RDROP ;                                                                  : WORD ( c - a)   PUSH  SOURCE  OVER SWAP ( buf buf #)            >IN @ /STRING 0 MAX   R@                                              -LEADING=  ( buf 1stChr rem#)                             OVER SWAP  ( buf 1stChr 1stChr rem#)                            POP   -LEADING<>                                                               ( buf 1stChr LastChr+1 rem#) DROP DUP PUSH       ( buf 1stChr LastChr+1) OVER - ( buf 1stChr #) DUP HERE C!      HERE 1+ SWAP CMOVE ( buf) POP SWAP -  1+   >IN !  (   )         HERE ( a)    ;                                                                                                                                                                                CODE -LEADING=   ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,     DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB! 1  NEXT, END-CODE                                                                        CODE -LEADING<>  ( /ADR -LEN CHAR -- /ADR -LEN') AX BX XCHG,     DROP, DI POP,  BX DEC, DI PUSH,   BEGIN,  BX INC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB! 1  NEXT, END-CODE                                                                       CODE -TRAILING=   ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,      DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,  0=, J, 1        AL 0 X/D CMP,  0=, NOT, UNTIL, FB! 1  NEXT, END-CODE                                                                        CODE -TRAILING<>  ( ADR/ LEN CHAR -- ADR/ LEN') AX BX XCHG,      DROP, DI POP,  BX INC, DI PUSH,   BEGIN,  BX DEC,               0=, J, 1  AL 0 X/D CMP, 0=, UNTIL, FB! 1  NEXT, END-CODE                                                                       MARKER -WORD   : +LOAD BLK + LOAD ;                             : (LEAD 0 SWAP STR- ;                                           : >LEAD< PUSH (LEAD POP @R+ EXEC (LEAD ;                        -1 +LOAD                                                                                                                        : WORD ( c - a)                                                   PUSH  BLK NBLK DUP SPAN ( buf buf #)  >IN STR- ( remaining)     0 MAX R@   >LEAD< -LEADING=  ( buf 1stChr rem#)                 OVER SWAP  ( buf 1stChr 1stChr rem#)                            POP >LEAD< -LEADING<> ( bf Chr/ /Chr+1 rem#) DROP DUP PUSH      ( buf 1stChr LastChr+1) OVER - ( buf 1stChr #) DUP HERE C!      HERE 1+ SWAP CMOVE ( buf) POP SWAP -  1+   >IN !  (   )         HERE 0 OVER  COUNT + ! ( a)    ;                                                                                                                                                                                                                                ( multiplies number by BASE & adds digit)                     : -DIGIT ( c - n $ DF  AND)    $ 30 -  DUP 10 < 0=                 IF  7 - DUP $ A < OR THEN   DUP BASE ( @) U< 0= A" ?" ;      | : 10*+ ( u a c - u a)                                           -DIGIT ROT BASE ( @) * + SWAP ;                               : ;SIGN OVER C@ $ 2D = IF 1 STR- EX NEGATE THEN ;               : (SNUMBER ( a # - n) ;SIGN                                       OVER C@ C" $ OF [AT] $  1 STR-  ELSE                                    C" # OF [AT] #  1 STR-  ELSE                                    C" % OF [AT] %  1 STR-  ELSE                                    C" ^ OF DROP 1+ C@ 64 - ;THEN ( char value)                     C" ` OF DROP 1+ C@      ;THEN DROP THEN THEN THEN        0 -ROT   FOR  CSTR 10*+ NEXT DROP  ;                          ( above allows  $FF  and  'a   type literals )                 : SNUMBER ( a - n) COUNT ( a #) (SNUMBER  ;                      DEFER NUMBER         ' SNUMBER IS NUMBER                       MARKER --FIND                                                   HEX ( TALIAS @ dA@-) 1 CONSTANT NONESUCH  ( no opcode $D6 )                                                                      CODE -FIND  ( h n -  h true | pfa false)                                SI DX  MOV, ( save IP)                                    ' CONTEXT                                                       2 + @ #, DI  MOV,                                                     BX DI  SUB, ( hash)                                             DS AX  MOV,                                                     AX ES  MOV,                                                        BX  POP, ( 'here')                                       0 /BX  AL  MOV,                                                 1F #,  AL  AND, ( MASK LEN)                                         AH AH  SUB, ( cnt)                                                 AX  INC,                                                        DI PUSH,                                             BEGIN,     DI  POP,                                                  0 /DI DI  MOV, ( get next link addr)                               DI DI TEST,                                                             0=, IF,                                                    BX PUSH,                                                     BX BX  SUB, ( ZERO TOP)                                            BX  DEC, ( -1  -  FALSE)                                     DX SI  MOV, ( RESTORE IP)                                             NEXT, THEN,                                                  DI PUSH,                                                   2 #, DI  ADD, ( move to name field)                               BX SI  MOV, ( here)                                             AX CX  MOV, ( reload count)                                  REPZ, AL CMPS,                                             0=, UNTIL,                                                                                                                       ( fall thru occurs when count is all used up and )              ( the last compare was still equal, now check if indirect  )   AX POP, NONESUCH #,                                                   W/ 0 /DI CMP,          ( indirect pfa?)                                       0=, IF,  ( get indirect addr)                     2 /DI DI MOV, THEN,                                      \ FSJMP, 23                                                                 DI PUSH, ( the pfa)                                          BX BX  SUB, ( the flag)                                         DX SI  MOV,                                                           NEXT,   END-CODE                                                                                                                                                                                                                                                                                                                                                                 : FIND PUSH -1 ORDER# WCOUNT                                           FOR WCOUNT @ SWAP NEXT DROP CONTEXT @ POP (FIND TO ?, ;                                                                  :: INTERPRET BL WORD FIND ?DUP IF ?, TO INTERPRET THEN               NUM ?? ?LITERAL TO INTERPRET ;                                                                                             : ?LITERAL DBL 1+  IF SWAP ['] LITERAL  DUP THEN                      DROP ['] LITERAL                                          ;                                                               : LITERAL STATE IF ['] [LIT] THEN ;                                                                                             : (( CREATE , , DOES> WCOUNT , PERFORM ;                                                                                        ' ,  ' LIT ((  [LIT]                                                                                                                                                                            | : BACK 8 EMIT ;      | : ;EXPECT RDROP DROP POP SWAP - ;      : EXPECT ( a # -) DUP PUSH ( a)  SWAP ( #REM a)                   BEGIN OVER WHILE ( #REM a)                                          KEY 255 AND  ( # a key)                                         13 OF ;EXPECT ELSE   0 OF 7 EMIT ELSE                            8 OF  OVER R@ < IF -1 STR+ BACK SPACE BACK THEN ELSE            ( # a key) DUP EMIT OVER C! ( # a) 1 STR+ THEN THEN THEN   REPEAT ;EXPECT ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( DEBUF LW LAST WORD  LA - LAST ADR  FA - FIRST ADR   )                                                                        \ MARKER -HACK                                                                                                                   0 QUAN ADR    -HEADERS                                                                                                          <%   \ COMPILING TIME ONLY                                                                                                      : VALUES FOR 0 VALUE NEXT ;                                     : 1-, HERE 2- @ 1- , ;                                          : '@,  ' @ , ;                                                                                                                  %>                                                                                                                                                                                                                                                             : BADR AT ADR @1+! C@ ; \ TEMP VARIABLES                         1 VALUE FEMIT          \ REDIRECTION FLAG                       0 VALUE LW             \ LAST WORD                              0 VALUE EF             \ END FLAG                               0 VALUE IX             \ INDEX OF WORD IN LAST TABLE            0 VALUE 1A             \ FIRST ADDRESS                          0 VALUE NA             \ NEXT ADDRESS                           0 VALUE LA             \ LAST ADDRESS                           0 VALUE PS             \ PASS NUMBER                            0 VALUE HW             \ HELP WORD                              0 VALUE TAB            \ TABULATION POS                         0 QUAN  SCP            \ SCAN POINTER                          0 <STACK FSTK 0 ,       \ STACK OF FORWARD ADDRESSES            0 <STACK BSTK 0 ,       \ STACK OF BACKWORD ADDRESSES                                                                                                                                                                                                                                                                           : /1PAS PS -IF RDROP THEN ;  \ ON FIRST PASS -  EXIT WORD                                                                       : WADR AT ADR @2+! @ ;       \ READ WORD AT ADR & ADR++                                                                         : SADR AT SCP @2+! @ ADR = ; \ ONE STEP SCAN FOR ADR                                                                            \ SAVE AN ADDRESS TO ONE OF TWO STACKS                          : !ADR ADR 1- OVER U< IF TO FSTK ;THEN TO BSTK ;                                                                                \ CHECK IF NAME IS 'OK'   0 IF OK   ELSE NOT OK                                                                                                                                                                                                                                                                                 : @BRAN  WADR TO NA  LA NA U< IF NA TO LA THEN ;                                                                                \ : WORD? DUP C>N DUP IF 1- SWAP PUSH - POP CSTR                \    DUP 128 AND 1+ PUSH 127 AND + 2+ = POP AND ;THEN NIP ;                                                                     : NAME-OK? SWAP C@ TUCK OR 129 AND SWAP 96 AND 0= AND ;         : WORD? C>N DUP IF OVER N>C 2- @ PUSH NAME-OK?                                 R@ 0= IF RDROP ;THEN  \ KRAJ NA SPISAK               POP N>C C>N DUP  IF ( F A 1/ F 0) NAME-OK?  ( F F)                               IF ;THEN DROP 0 ;THEN NIP THEN ;                                                                           : ID.OK DUP WORD? IF ?ID. ;THEN  C" : EMIT .H ;                                                                                                                                                                                                                                                                                  \ MAIN SCAN UTILITY CREATOR                                     : XSC CREATE C,   \ NUMBER OF ITEMS                                   DOES> COUNT \ N TABLE COUNT                                     2DUP 2* +   \ N TABLE COUNT ENDTABLE                            TO NA       \ ! IF IN TABLE THEN JUMP AFTER TABLE               LW  SCAN 1+ ?DUP        \ ELSE CONTINUE                         IF 1- TO IX RDROP NA PUSH THEN ;                                                                                          : #. [AT] # . ;  \ PRINT NUM IN DECIMAL                         ( DEBUF LW LAST WORD  LA - LAST ADR  1A - FIRST ADR    )                                                                        : NEWLN CR TAB SPACES ;  \ NEWLINE WITH TAB SPACES                                                                                                                                                                                                                                                                              : NEWLN? 1L SWAP - OUTC -  0< IF NEWLN THEN  ;                                                                                  : #NAME CREATE DOES> PS         \ IN SECOND PASS TYPE A NAME        IF DUP IX INDSCAN DUP C@  NEWLN? ". SPACE THEN DROP ;                                                                       : TAB+ TAB + TO TAB ;           \                                                                                              \ : BWADR IX -IF BADR ;THEN WADR ;                                                                                              \ : WDADR IX 2- -IF WADR ;THEN S>D ;                                                                                             \ LOOP NAMES                                                                                                                                                                                                                                                                                                                                                                                    #NAME LUP. ," DO ," ?DO ," LOOP ," +LOOP ," FOR                 5 XSC LOOPS  ] (DO (?DO (LP (+LP (FOR                                    @BRAN LUP. ;M                                                                                                          ' LUP. @ 1+ STR +   CONSTANT  DOES-ADR                                                                                          \ STRINGS COMPILE ?                                             #NAME STRG. ," " ," ."  ," A"                                   : DOES? DUP C@ 232 = IF 1+ STR + DOES-ADR  - THEN ;                                                                             : /END LA ADR U< IF 1 TO EF THEN ;                                                                                                                                                                                                                                                                                              \ STRING OPERATION STRING LITERAL, TYPE STRING,                 \   OR ERROR MESSAGE                                            3 XSC STRG ' " 2+ @ ,   ' ." 2+ @ ,   ' A" 2+ @ ,  ]                    ADR TO HW  \ CURRENT ADDR TO HW  PREPARED FOR TYPE           BADR ADR +    \ ADDRESS AFTER STRING                            TO ADR /1PAS  \ ON 1 PASS ENOUGHT                               HW C@ NEWLN?  \ SHOW STRING ON 2 PASS                           STRG. HW ". 34 EMIT SPACE ;M                                                                                               \ SCAN ROUTINE                                                  : IX? BEGIN SCP HW - WHILE SADR IF 1 ;THEN  REPEAT 0 ;                                                                          \ FORWARD NAMES                                                 #NAME FWD. ," AHEAD ," IF  ," -IF  ," OF                                                                                                                                                        \ BACKWARD NAMES                                                #NAME BWD. ," AGAIN ," UNTIL ," -UNTIL                                     ," REPEAT ," ELSE ," BEGIN ," THEN                   4 XSC BRANC  ] (BR (0BR  (0BR  (OF                                @BRAN  PS -IF NA  !ADR                                          ;THEN  LW lit (BR -                                             0;   ADR 1- NA U< IF NEWLN FWD. 2 TAB+                          ;THEN  -2 TAB+ BWD. NEWLN                                     ;M                                                                                                                              : TBS! 2@ TO SCP TO HW ;                                                                                                        : TBS? TO IX 0                                                       BEGIN TO CSP IX?                                                WHILE  BWD. CSP 2+ REPEAT ;                                                                                               : THENS.  /1PAS      \ WORKS ON SECOND PASS                          AT FSTK TBS! IX? 0;                                             6 -2  LW lit (BR =   IF 2DROP                                   3 -4 ADR 1- NA    U< IF 2DROP                                   4  0 THEN THEN                                                  TAB+ NEWLN TO IX BWD.                                           6 TBS? CSP NEGATE TAB+ ;                                   : BEGINS.  /1PAS  AT BSTK TBS!  5 TBS? CSP TAB+ ;                                                                               : BEG?  ADR 2- 1A - ;    \ AT THE BEGINING ?                                                                                    : BEG. 1A ID.OK ;        \ NAME OF WORD  - IF EXIST                                                                              #NAME OTHER.  ," NEXT                                           1 XSC OTHER ]   (NEXT   OTHER. ;M                                                                                                           \   [',]   [TO]   [AT]              \ COMPILERS     #NAME COMP?. ," [',] ," [TO] ," [AT]                                        \   [']   [ ' 2+ , ]    [ ' 4 + , ] \ LITERALS      #NAME LITW?. ," \0+ ," \2+          ," \4+                                                                                     : IMMED? LW WORD? 129 - IF LW ID.OK ;THEN  LW C>N 1- 2/ TO IX         COMP?. ID. ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               : SPEC                                                             lit ;code LW =                                                    IF ADR DOES?                                                      -IF 3 AT ADR +! /1PAS ." DOES> "                                ;THEN  /END                                                   THEN                                                            lit [ ' INTERPRET 4 + @ , ]                                     LW @ = IF /END THEN                                             PS 0;                                                           IMMED?                                                          7  NEWLN? ;                                                                                                                                                                                                                                                                                                                                                                               : ;REM. ." ( " EX ." ) " ;  : ;INT. ." [ " EX ."  ] " ;         : LIT. NA #. 31 NA < 0;  C" ) NA - 0;                            ;REM.  NA 33 127 WITHIN IF C" ` EMIT NA EMIT ;THEN NA ID.OK ;  \       NA .  ;REM. NA ID.OK ;M                                                                                                  #NAME COMPB. ," blit ," BCOMPILE                                2 XSC COMPB ] blit BCOMPILE   BADR TO NA  /1PAS                  IX IF COMPB. ;INT. NA #. ." C," ;THEN    LIT. ;M                                                                              #NAME COMP. ," COMPILE                                            1 XSC COMP ] COMPILE WADR TO NA /1PAS                         \   NA WORD? ?DUP IF 1- 2/ OVER C@ 128 AND                      \   IF TO IX COMP?. ID. ;THEN COMP. DROP NA ?ID. ;THEN              COMP.  ;INT. NA #. ." ," ;M                                 #NAME NLIT. ," lit  1 XSC NLIT ] lit WADR TO NA /1PAS LIT. ;M                                                                    #NAME STARTS.                                                       ," ->:   ," :TR-  ," :   ," :1                                  ," :2     ," :3    ," :4                                                                                                    7 XSC STARTS                                                       '@, QUIT  '@, EXPECT   '@, XSC    1-,                           1-,          1-,         1-,                                  ]  BEG? 5 U< -IF /END THEN                                         /1PAS  STARTS.  BEG? -IF BEG. THEN ;M                                                                                       ( PROBA ID.OK     )                                             #NAME /END. ," EXIT ," ?TR;  ," ;4TH                                                                                            3 XSC ENDS ] EXIT  TO EX  ;4TH \  EXIT ?                            /END  /1PAS  EF IF ." ; "  ;THEN /END. ;M                                                                                   : 1I             \ DECOMPOSE 1 INSTRUNCTION                         THENS.       \ IF, -IF, OF, ELSE, WHILE,  ENDS?                 BEGINS.      \ START OF LOOP  ? ON THIS ADDRESS                 WADR TO LW   \ GET WORD  -> LAST WORD                           STARTS       \ IS IT STARTING WORD ?                            OTHER  COMPB  COMP  STRG  \ IS IT STRING WORD ?                 NLIT     LOOPS   \ NUMBERS  \ CICLES                            ENDS   BRANC  SPEC ; \ IMMEDIATE WORDS  ( COMPILING ?)                                                                          ( -HEADERS OFF )                                           | : PAS TO PS    \ PASS NUMBER 0\1                                  1A TO ADR   \ START ADR -> OPERATION ADR                         0 TO EF    \ 0 -> END FLAG                                     -1 TO LW    \ -1 -> LAST WORD - NO SUCH WORD                    BEGIN 1I EF UNTIL ;                                                                                                          : @HACK DECIMAL CR TO 1A    \ FIRST ADDRESS                       FEMIT IF ;EMIT ;CR THEN  \ REDIRECTION OF STD OUT               0 TO TAB                  \ NO TABULATION                       0 TO LA                   \ LAST ADDRES NOT FOUND YET           PAD 1K 2* +  DUP 1K + DUP \ EMPTY  FORWORD'S STACK              AT BSTK 2! DUP AT FSTK 2! \ EMPTY BACKWORD'S STACK              1A @ DOES?                \ IS IT A DOES> ? CHILD               -IF 1A ID.OK ;THEN        \   YES                               0 PAS 1 PAS ;             \ NO -> LET'S  HACK IT                                                                              | : @@@ CREATE C, DOES> C@ ' + @HACK ;   \ FLAT HACK 0CFA         0 @@@ HACK   2 @@@ 'HACK   4 @@@ "HACK \ 1CFA 2CFA                                                                            : >ADR  ADR @HACK ;    \ CONTINUE HACKING ON ADR               \ USING DESASM.SCR                                              \ PRUNE                                                          MARKER -HAK   -HEADERS                                                        CREATE ;CR   CREATE ;EMIT                           ' IOV @  1 NM: @2+! ! ;M 2 NM: 2-!@ @ ;M 3 MAKER STACK> ,       ' IOV @  1 NM: 2-!@ ! ;M 2 NM: @2+! @ ;M 3 MAKER <STACK ,    <N  ' <N ALIAS <%   ' N> ALIAS %>                               : -IF COMPILE 0= [',] IF ; IMMEDIATE                            N>                                                                179 194 THRU          0 TO FEMIT                              \ PRUNE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         MARKER -WORD?    : ;NIP EX NIP ; : N>L@ N>C 2- @ ;              : WORD1? DUP  \ ADDR ADDR                                               C>N  \ ADDR ANAME FLAG / ADDR FLAG                              DUP  \ ADDR ANAME FLAG FLAG / ADDR FLAG FLAG                   IF 1- SWAP PUSH - POP CSTR 127 AND + 2+ =                ;THEN NIP ;                                                     : NAME-OK? SWAP C@ TUCK OR 129 AND SWAP 96 AND 0= AND ;         : WORD? C>N DUP IF OVER N>C 2- @ PUSH NAME-OK?                                 R@ 0= IF RDROP ;THEN  \ KRAJ NA SPISAK               POP N>C C>N DUP  IF ( F A 1/ F 0) NAME-OK?  ( F F)                               IF ;THEN DROP 0 ;THEN NIP THEN ;           : NAME? C>N DUP 0; SWAP C@ TUCK OR 129 AND SWAP 96 AND 0= AND ; : WORD2? DUP ;NIP NAME? DUP 0; SWAP C> N>L@ 0;                        SWAP N>L@ N>C NAME? DUP 0; SWAP ;                         : WORD2 0 -1 FOR R@ WORD2? IF 1+ THEN NEXT ;                                                                                    MARKER -SEE  0 VALUE WADR                                       | : ;WADR WADR EX TO WADR ;                                     : @BYTE ;WADR C@+ ;                                             | : .ADR SPACE DUP H. SPACE ?ID. ;                              : @STR  ;WADR DUP CSTR + ;                                      : $>' [AT] $ N>" ">' ;                                          : '@, ' @ , ;                                                   | : ONB @BYTE $>' ;                                             : @WORD ;WADR @+ ;                                              | : ONW @WORD $>' ;                                             <N  ' @STR ALIAS ONS N>                                         | : .STR? CREATE , DUP C, FOR , NEXT DOES> STR lit [ >MARK ] !    CSTR WADR 2- @ SCAN 1+ IF [ SWAP ] THEN NOP ". RDROP THEN ;   : WW CR WADR .ADR C" | EMIT @WORD .ADR ;                        | ' A" 2+ @  ' " 2+ @ ' ." 2+ @  3 ' ONS .STR? ?STR                                                                             | HEADER ?BYTE '@, ?STR ', ONB 3 C, ] BCOMPILE blit ;code [     | HEADER ?WORD '@, ?STR ', ONW 10 C, ] COMPILE lit (BR (FOR                                    (DO (?DO (0BR (LP (+LP (OF [     | : UNITS? U/MOD SWAP IF 1+ THEN ;                              | : 1W WW ?WORD ?STR ?BYTE ;                                    : L bs FOR 1W NEXT ;                                            | : D8 bs FOR @BYTE .H NEXT SPACE ;                             : DU CR WADR H. D8 D8 WADR 1H - 1H TYPE ;                       : @SEE TO WADR L ;                                              : DUMP SWAP TO WADR 1H UNITS? FOR DU NEXT ;                     : SEE ' @SEE ;                                                                                                                                                                                                                                                                                                                                                                                  \ MARKER -HAK                                                   \ 18 LOAD                                                          ' IOV @  1 NM: @2+! ! ;M 2 NM: 2-!@ @ ;M 3 MAKER STACK> ,       ' IOV @  1 NM: 2-!@ ! ;M 2 NM: @2+! @ ;M 3 MAKER <STACK ,    \ : CNTDO OVER + SWAP ;                                         <N  ' <N ALIAS <%   ' N> ALIAS %>                               : -IF COMPILE 0= [',] IF ; IMMEDIATE                            N>                                                              \  FLOAD HACK.TX                                                \ : LOAD DUP CR .. BIOS-KEY LOAD ;                              \ : THRU 1+ SWAP DO I LOAD LOOP ;                                                                                                 179 194 THRU                                                  \ PRUNE                                                                                                                                                                                         MARKER -SEE  \ FORTH CODE VIEWER                                 0 QUAN WADR Z, | : ;WADR WADR EX TO WADR ; : @BYTE ;WADR C@+ ; | : .ADR SPACE DUP H. SPACE ?ID. ;  : @STR  ;WADR DUP CSTR + ;  : $>' [AT] $ 0 N>S S> ; : '@, ' @ , ; | : ONB @BYTE $>' ;       : @WORD ;WADR @+ ; | : ONW @WORD $>' ; <N  ' @STR ALIAS ONS N>  | : .STR? CREATE , DUP C, FOR , NEXT DOES> STR lit [ >MARK ] !    CSTR WADR 2- @ SCAN 1+ IF [ SWAP ] THEN NOP ". RDROP THEN ;                          : WW CR WADR .ADR C" | EMIT @WORD .ADR ; | ' A" 2+ @  ' " 2+ @ ' ." 2+ @  3 ' ONS .STR? ?STR             | HEADER ?BYTE '@, ?STR ', ONB 3 C, ] BCOMPILE blit ;code [     | HEADER ?WORD '@, ?STR ', ONW 10 C, ] COMPILE lit (BR (FOR     (DO (?DO (0BR (LP (+LP (OF [                                    | : 1W WW ?WORD ?STR ?BYTE ; : L bs FOR 1W NEXT ;                ' ?STR @ AT WADR 2+ !  : @SEE TO WADR L ;   : SEE ' @SEE ;                                                                                                                                     ( DO A CALL  CALL A DOS FUNCTION   PERFORM INTERRUPT  #       ) 0 VALUE RAX  0 VALUE RBX  0 VALUE RCX  0 VALUE RDX  0 VALUE RFL                                                                 CREATE _INT HEX   ASM  21 #, INT, RET,   /ASM                   CODE _CALL BX DI MOV, ' RFL 4 + /// PUSH, POPF,                 ' RAX 4 + /// AX MOV, ' RBX 4 + /// BX MOV, ' RCX 4 + /// CX    MOV,  ' RDX 4 + /// DX MOV,  DI CALL,  AX ' RAX 4 + /// MOV,    BX ' RBX 4 + /// MOV,  CX ' RCX 4 + /// MOV,   DX ' RDX 4 + /// MOV,  PUSHF,  ' RFL 4 + /// POP,    BX POP, NEXT,   END-CODE    : DO_INT [ _INT 1+ ] LITERAL C! _INT _CALL ;                    : DO_DOS 21 DO_INT ;                                            : FCUT ( SCR) 1K M* TO RCX TO RDX  4200 TO RAX SCRH TO RBX         DO_DOS 0 TO RCX 4000 TO RAX DO_DOS ;                         DECIMAL                                                                                                                                                                                         MARKER -TARG  ONLY   VOCABULARY COMP    COMP ALSO                 VOCABULARY ROOT    ROOT ALSO   TO FORTH                       : <% THERE 2@ dA HERE THERE 2! TO HERE TO dA ; ' <% ALIAS %>    : >NS: CURRENT PUSH TO HIDDEN <N EXEC N> POP TO CURRENT ;       <N  : CONST CONSTANT IMMEDIATE DOES> @ [',] LITERAL ; N>        : C: ['] CONST >NS: ;    : L: HERE C: ;  : CODE, HEADER , ;     HERE 16 ALIGN DUP TO HERE   12000 CLARY HERE CONSTANT TEND        CONSTANT TSTART                        0  TSTART   THERE 2!    : ?TADR THERE 2@ SWAP - ;  TO ROOT  <%   102 109 THRU          TO COMP   ' EXIT @ HEADER X ,  0 ' X 3 - C! IMMEDIATE  %>                                                                                                                                                                                                                                                                                                                                                                                                       MARKER -SPECIAL                                                 : 'PFA ' 2+ ;  : ;! EX ! ;  : IS ;! 'PFA ;                      : META ' IS ;  : ?META 'PFA @ ?ID. ;  \ : META! @R+ @R+ ! ;     : -META AHEAD [ HERE ' META @ , SWAP ] @R+ @R+ ! ;THEN                  COMPILE [ , ] 'PFA STR , 2- , ; IMMEDIATE                                                                               ' (0BR ((  ?IF         CR ?META ?IF                             : RESTORE_IMM    -META ?IF ;                                      META (BR ?IF         CR ?META ?IF                                                                                               RESTORE_IMM          CR ?META ?IF                                                                                             : VPUSH ALSO ' DUP  @ lit [ ' FORTH @ , ]  XOR A" VOC?"          EXEC DEFINITIONS ;  : VPOP ORDER# @ 0; PREVIOUS DEFINITIONS ;                                                                                                                                  L: >BSTR=  255 #, CX MOV,         L: >LSTR= LODSB, AX CX AND,     CL 0 /DI CMP,  0=, IF, DI INC,  L: >STR=  REP: CMPSB,           0=, NOT, IF,  CX SI ADD,  THEN,  THEN,  RET,                  L: >FIND  -2 /BP BP LEA, SI 0 /BP MOV,                          BEGIN,  BEGIN,  SI POP,  SI INC, 0=, IF,                            DUP, AX SI XCHG, ?, J, 8 THEN,  SI DEC,  0=, NOT, UNTIL,      BEGIN, CX POP,  SI CX CMP, 0=, NOT, UNTIL,  CX PUSH,            BEGIN, BX DI MOV, 31 #, CX MOV, >LSTR= #, CALL,                   0=, IF,  $ 20 #, AL TEST,  0=, J, 7 THEN,                       0 /SI SI MOV, SI SI OR,                                       0=, UNTIL,                                                    AGAIN,  FB: 7   BEGIN, CX POP, CX INC, 0=, UNTIL,                  SI INC,  SI INC,  SI PUSH,  CBW,  STC,  AH AL MOV,              1 #, AX RCL,  FB: 8  AX BX XCHG, >UNNEST JMP,                                                                                                                                                \ +C> NAND + LIT @+ !+ XCHG PUSH POP DUP DROP ; NXT IF CAL JMP  : ! !+ DROP ;  : @ @+ DROP ; : !- !+ -4 + ; : @- @+ -4 + ;      : -! -2 + !+ -2 + ;  : -@ -2 + @+ -2 + ;  : LIT POP @+ PUSH ;   : EX POP XCHG PUSH ; : ;PP XCHG PUSH PUSH EX POP ;              : OVER PUSH DUP XCHG POP ;      : ;NIP EX : NIP PUSH DROP POP ; : 2SWAP PUSH -ROT POP : -ROT PUSH SWAP POP : SWAP PUSH XCHG POP ;                                                               : 2/ DUP +C> NIP ; : 2* DUP + ;                                 : ;INVERT EX : INVERT DUP NAND ; : ;AND EX : AND ;INVERT NAND ;                                : 0<> IF DROP -1 THEN ;          : XOR OVER OVER NAND ;AND ;PP : OR INVERT SWAP INVERT AND ;     : 0= IF DROP 0 ;THEN INVERT ; : 0< DUP +C> AND $8000 AND 0<> ;  : NEGATE -1 + INVERT ; : - NEGATE + ; : U< NEGATE +C> NIP 0< ;                                                                                                                                                                                                  \ XOR AND +2/ IO @R+ !R+ XCHG PUSH POP DUP DROP ; NXT IF CAL JMP: 2* DUP : + +2/ DROP ; : !+ PUSH !R+ POP ; : @+ PUSH @R+ POP ; : @IP+ @R+ ; : !IP+ !R+ ;  : ! !+ DROP ; : @ @+ DROP ;          : EX POP XCHG : EXECUTE PUSH ; : 2/ 0 +2/ : NIP PUSH DROP POP ; : 1- PUSH ?FOR THEN POP ;   : OVER PUSH DUP XCHG POP ;          : U< NEG +2/ NIP : 0< $8000 AND : 0<> IF DROP : -1 -1 THEN ;    : 0= IF DROP : 0 0 ;THEN : NOT -1 XOR ;                         : 0; IF DROP ;THEN POP : 2DROP DROP DROP ;                      : XEP XCHG EXECUTE POP ;                                        : ROT SWAP : USWAP XEP : SWAP PUSH XCHG POP ;                   : -ROT USWAP SWAP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ NM: CR ." JUMPING TO ZERO AT " POP H. 1 A" WHY?" ;M  DUP 0 !  0 HEADER BUE , : PROBA [ 0 , ] ;  | : H2+ HERE 2+ ;             \ NM: CR ." JUMPING TO ZERO AT " POP H. 1 A" WHY?" ;M  DUP 0 !                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  MARKER -LOCALS   \ LOCALS                                         0 QUAN FPTR    0 VALUE #V   M: COM 2* FPTR + ;M  TO #V          M: AT #V @ ;M   ' #V !       M: AT #V ! ;M    ' #V 2+ !       : RETURN FPTR RP!  POP TO FPTR ; : >NEXT N>C 2- @ DUP 0 TO #V ; : LOCALS UNPACK OVER +  FPTR XCHG RP@ TO FPTR  SWAP AT #V RP!            PUSH   FOR R@ TO #V NEXT  EX RETURN ;                  : LL  6 LOCALS  0 #V . 1 #V .  2 #V .  3 #V . 4 #V .  5 #V . ;  : WORD2? C>N DUP 0= ?DUP  3  LOCALS  2 #V IF 0 ;THEN              [ >MARK ]  DUP 0; 0 #V >NEXT 0; [ >MARK ]                     0= 0;  DUP XOR ;THEN                                            THEN DO: 0 #V C@ DUP 159 AND SWAP 96 AND 0= AND DUP 2 TO #V ;   : WORD2 0 -1 FOR R@ WORD2? IF 1+ THEN NEXT ;                                                                                                                                                                                                                                                                                    \ TO MEMORY  OR .. TO BLOCK FILE                                VARIABLE DISKPOS  Z,   243 1K M* DISKPOS 2!  VARIABLE LASTC     : LASTC@ LASTC @ UNPACK ; : LASTC! LASTC@ DROP PACK LASTC ! ;   : M+! PUSH S>D R@ 2@ D+ POP 2! ;  0 VALUE CPOS                  : DO_CR CPOS 1L 1- OR 1+ CPOS -   DISKPOS M+! ;                 : BLOCK_EMIT DUP LASTC! DISKPOS 2@ 1K  \ WHAT & WHERE TO WRITE       UM/MOD BLOCK  OVER TO CPOS OVER   \ POSITION IN BLOCK           0= IF DUP 1K BLANK THEN + OVER    \ ERASE NEW BLOCK             cr OF DROP DO_CR EXIT ELSE                                      lf OF LASTC@ NIP cr - IF DO_CR THEN DROP EXIT ELSE              SWAP  C!  1 DISKPOS M+!  THEN THEN UPDATE ;                : ;EMIT ['] BLOCK_EMIT TO 'EMIT MIO EX SIO ;  : ;CR CR EX CR ;                                                                                                                                                                                                                                                                                                                                                                                                   : FOUND HERE OVER AT -TEXT 0= ;                                 : WORD. DUP H. ID. ;                                            : VOC. 2- C>N DROP WORD. ." :" ;                                                                                                : VOCS. VOCLINK                                                    BEGIN ?DUP                                                      WHILE DUP 2-  VOC.                                                  @                                                           REPEAT                                                       ;                                                                                                                                                                                                         -->                                                                                                                   : WORDS.  DUP                                                       BEGIN @ ?DUP                                                    WHILE FOUND IF 2DUP WORD. VOC. THEN                               N>C 2-                                                        REPEAT                                                          DROP                                                        ;                                                                                                                               : ALL-WORDS. VOCLINK                                               BEGIN ?DUP                                                      WHILE DUP  2- WORDS.                                                  @                                                         REPEAT                                                       ;                                                                            -->                                                                                                               FORGET ?IN  VOCABULARY TEMP  VOCABULARY HIDDEN                              TO HIDDEN 51 LOAD  FORTH TO MACROS >LIST            TO HIDDEN    210 LOAD  199 LOAD                                 VARIABLE WCOUNTER    0 VALUE F-DO  \ : '@, ' @ , ;              : WORD. DUP H. ID. WCOUNTER 1+! ;                               : VOC. 2- C>N DROP WORD. ." :" ;                                \ : DO-HACK WADR 2- ?ID. ;                                      CREATE STARTING  3 C, '@, :  '@, QUIT  '@, (-FIND               \ : FOUND N>C DUP @ STARTING CSTR ROT SCAN 1+ IF DUP ?ID. THEN ;: FOUND N>C DUP @ STARTING CSTR ROT SCAN 1+                           IF WCOUNTER 1+! DUP @HACK THEN ; : ;DROP EX DROP ;        \ : WORDS. ;DROP BEGIN @ DUP WHILE DUP WORD. N>C 2- REPEAT ;    : WORDS. ;DROP BEGIN @ DUP WHILE FOUND 2- REPEAT ;              : ALL-WORDS. VOCLINK BEGIN ?DUP IF DUP 2- WORDS. @ REPEAT ;     : VOCS. VOCLINK BEGIN ?DUP WHILE DUP 2- VOC. @  REPEAT ;        ALL-WORDS.                                                      PRUNE FORTH MARKER -NEW  VOCABULARY COMP  VOCABULARY ROOT  \ RESVOCABULARY TCOM  VOCABULARY TINT   TINT DEFINITIONS \ TRANSIENT : CLARY HERE OVER ERASE ALLOT ; | : [IS] @R+ 2+ ! ; : ? @ . ;   : ZARY,  HERE DUP PUSH 2- EXEC POP - CLARY ;  (  : IS ' 2+ ! ;) : ALIGN DUP 1- SWAP IF DUP DUP 1+ AND THEN A" 2^?" SWAP >ALIGN ; : ALIGNED HERE SWAP ALIGN HERE - CLARY ; | : ;-NAME <N EX N> ; | : ;HERE HERE EX TO HERE ; ( : META ' IS ;)VARIABLE -HEADERS   16 ALIGNED  HERE      12000 CLARY    HERE  PAD TO HERE \ SPACE  CONSTANT TEND   DUP VALUE THERE     CONSTANT TSTART             : <% THERE ;HERE TO THERE ; | : ;-HEAD -HEADERS @ EX -HEADERS ! ; : <N> NPTR ;HERE TO NPTR ; | : ;<N> EX <N> ;  ' <% ALIAS %>   | : ;NS  CURRENT XCHG PUSH TO CURRENT EX POP TO CURRENT ;       : C: AT HIDDEN ;NS ['] CONSTANT ;-NAME EXEC ; : L: HERE C: ;    | : ;CSP CSP EX TO CSP ;    : ?CSP SP@ ;CSP - A" SP CHG!" ;     : TSIZE THERE TSTART - ;  : CSP! ;CSP SP@ ;   1 11 +THRU                                                                        \ COMPILER STUFF   - NO NAME GERATION                           | : H2+ HERE 2+ ;                                               | : ;CFA! EX HERE TO CFA ;      : C, ;HERE C!+ ;                : , ;HERE !+ ;                  : ALLOT ;HERE + ;               : S,    C@ 1+ ALLOT ;           : HP, H2+ , ;                   : SAVE2 ;HERE 2- ;              : SAVE1 ;HERE 1- ;              : Z, 0 , ;                      : ZC, 0 C, ;                    : MARK/ HERE Z, ;               : /MARK HERE SWAP! ;            : LOOP/ MARK/ HERE ;            : /LOOP , /MARK ;               : FIX    DUP PUSH @ A" REDEFINE?" POP /MARK ;                   : W, @+ SWAP , ;                \ : ALIGN 2 ALIGNED ;           : COMPILE POP @+ PUSH , ;       : BCOMPILE POP C@+ PUSH C, ;    | : ;, EX , ;                   ' ' ALIAS H'  ' | ALIAS H|      : ?? 0= A" ?" ;                   0 VALUE VOCTYPE                                                                                                                                               \ FORWARD DEFINITIONS OF SPECIAL LOCATIONS                      ' -HEADERS @  CONSTANT  #VARIABLE       ' ALIAS 6 + @  CONSTANT  #ALIAS         | : [:] H' 4 + FIX ;  IMMEDIATE                  HERE ASM   SCASW, X, SI PUSH, X,  /ASM         \ >FSUB          HERE ASM   2 /DI SI MOV,          /CODE        \ >FJMP           SWAP  2  |  MAKER FWD:  Z,    |  FWD: ?ANY1                   | : ?ANY SWAP -ROT SEARCH [:] ?ANY1 ROT PUSH IF                   ( R@ 2 = IF DUP ?TARGET EX THEN) \ DON'T INTERPRET TARGET        POP THEN RDROP ; | : ?ANY2 SWAP ORDER# STR FIND TO ?ANY1 ;   | : \? 1 AT COMP ?ANY 0 ;                                       | : ?TARGET TSTART TEND WITHIN EX A" NOT TARGET!" ;              156 LOAD  ' SNUMBER TO NUM   ' LITERAL TO ?LITERAL             | : LOCT BLWORD 3 AT TCOM ?ANY 2 AT COMP ?ANY 1 AT ROOT ?ANY 0  ; | : (? CREATE C, DOES> C@ LOCT DUP TO VOCTYPE ?? +  ;         0 (? ?0          2 (? ?1         4 (? ?2   \ ' HELPERS                                                                          \ CODE NAP  DX POP, /CODE         CODE DAP  DX PUSH, /CODE      \ : S. DAP POP R@ SWAP PUSH CR S. KEY 283 = A" ESC ?" DROP NAP ; \      TO TCOM ' S. ALIAS S. TO TINT                           FWD: HEADER | FWD: HEAD  FWD: ,S     FWD: CREATE  FWD: ALIAS    FWD: VAR     FWD: 2VAR  FWD: 3VAR   FWD: CODE,     \                                                                            : 4VAR ;, [:] 3VAR   ;, [:] 2VAR   ;, [:] VAR  ;,  \            [:] CREATE #VARIABLE    [:] CODE,  ;,  \                        [:] HEADER ;CFA! ;-HEAD ?DUP   IF      \ ?-HEAD  ;CFA!                   1- EX EX  HERE  <N>  ;<N>     \                        [:] ALIAS  ;,  #ALIAS   ;,     ELSE    \                                       RDROP           THEN    \ ;-HEAD  IS DISCARDED   [:] HEAD BLK , 'SAME CURRENT HERE @SWAP ;,   \                  [:] ,S BLWORD C@+ PUSH 31 MIN DUP POP 1- C! 1+ ALLOT ;          : VARIABLE  0 TO VAR ;     : CVAR CREATE C, ;                                                                                   : CODE HEADER HP, ASM ;  \ CREATOS & MAKERS  \  DOES>       | : ;( HEADER  EX  W, PERFORM ;       \         : (XW   2VAR DOES> W, PERFORM ;     \ 1      : (X1   2VAR DOES> ;( ;             \ 2 .. 1MAKER  + EXEC   : (X2   3VAR DOES> ;( W, ;          \ ..       2MAKER  + EXEC   : (X3   4VAR DOES> ;( W, W, ;       \ ..       3MAKER  + EXEC   : (W     VAR DOES> @ , ;            \ WORD COMPILER             : (X@   2VAR DOES> @+ PERFORM ;    : W3,  , , , ;               : (XX   2VAR DOES> @+ PUSH EXEC POP PERFORM ;                   : (BR,  CVAR DOES> C@ C, H2+ - , ; \ .. + R,                      232 (BR, CALLI,   ' SWAP! -1 (X@ ON   ' SWAP! 0 (X@ OFF       TO TCOM  ' , 0 (XW LITERAL  ' CALLI, 0 (X@ DOES,  0 (W ;code,    0 (W  DROP,  ' ,S"  0 (XW A"   ' ,S"  0 (XW ." ' ,S"  0 (XW "   : [:] ?2 FIX ;  : \\ BLWORD \? ?? , ;                           : ['] [ ?1 LITERAL ] LITERAL @ , ;  TO TINT                                                                                    |  0 VALUE POINT      0 VALUE CICLES | : POINT! POP TO POINT ;  | : FINDING BLWORD POINT  PUSH  CICLES 1+ TO CICLES ;           | : TARGET, DUP ?TARGET 0= EX , ;                               | : NOT_FND SNUMBER [ TCOM ] LITERAL ; TINT                     | 0 WARY AWORD ] NOT_FND TARGET, EXEC SNUMBER [ \ INTERPRET     : T[ [',] [ POINT! 2 AT TINT ?ANY  2 ?ANY2 3 ;  \ : S. S. BIOS-K: T] ] POINT! 2 AT TCOM ?ANY  1 AT ROOT ?ANY 0 ;  \ COMPILE                                                                                                                                     | : INTER FINDING AWORD PERFORM INTERPRET ; ' (INT @ ' INTER !  : STOP! [',] [ ['] (INT [IS] INTERPRET ;                        : GO! ['] INTER [IS] INTERPRET T[ ;  : | ;-HEAD 1 OR ;  PRUNE   : ': STOP! : ;   : ';  [',] ; GO! ; IMMEDIATE  : ' ?0 ;         : VIEW ' DUP TSTART TEND WITHIN 0= A" MEM" C>N DROP 2- @ EDIT ; : LIKE ' @ ; : BE ' ! ; : IS ' 2+ ! '; ': META ' IS '; TINT ALSO                                                                 GO! TO ROOT <%                                                                 14 LOAD                                                         15 LOAD                                                         16 LOAD                                                         17 LOAD                                                         18 LOAD                                                         19 LOAD                                                         20 LOAD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         %> >VAR H' #VARIABLE 2+ ! \ FIX VARS                                                                                             >DOES IS DOES,  META DROP DROP,  META LIT LITERAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              TO TINT    H' ZARY,     >WARY (X1  WARY                                    H' ZARY,  >WARY 2+ (X1  BARY                                    H' ZARY,  >WARY 2- (X1  DARY                                    H' ZARY, >WARY 4 - (X1  FARY                                    H' ,        >CONST (X1  CONSTANT                                H' Z,       >DEFER (X1  DEFER                              H' Z,   >FJMP >FSUB     (X2  FWD:                               H' ,    >VAR! >CONST 1- (X2  VALUE                              H' ,   >VAR! >DEFER 1-  (X2  VECTOR                                H' ,   >PVAL! >PVAL  (X2  PVAL                                          H' W3, >VBLK (X1  V3BLK                        H' ,  >VAR >VAR! 1- >CONST 2- (X3  QUAN                         \ H' ,  >CONST >PVAR! >PQUAN    (X3  PQUAN                      \ H' ,  >VAR >VAR! 1- >DEFER 2- (X3  VQUAN                      \ H' ,  >CONST >PVAR! >PVECT    (X3  PVQUAN                                                                                     \ HELPERS & DEFINING WORDS                                      H' FORTH ALIAS 'FORTH   ': TRANS TO TINT ';                     ': FORTH TO ROOT ';     ': MACRO TO COMP ';                     H|  ': CSP] CSP! T]  ';       H|  ': [CSP ?CSP T[  ';           H|  ': (M: HERE SWAP CALLI, CSP]  ';                            H|  ': (A>F CALLI, /ASM CSP] ';     H| ': (F>A [CSP ASM ';      H' (M:      >F: (X@  N:     H' (M:     >DOES (X@  1:            H' (M: >DOES 1- (X@  2:     H' (M:  >DOES 2- (X@  3:            H' (A>F      >F (X@ >4TH    H' (A>F     >F:  (X@  4TH:                                                                          H' CSP]   >>:   (X1 >:    \ JUMP TO WORD - NO NESTING           \ : TRACE ' TRON EXEC TROFF ;                                                                                                                                                                                                                                                                                                   0 TO HDRS?       -HEADERS OFF   \ COMPILATION WORDS             TO TCOM           \ DOES, & ;code, NEEDS OVERIDDING             H' (F>A ' ;code, (XX  ;CODE     ' DOES, ' ;code, (XX  DOES>      H' (F>A  F> 2- (XW  4TH>       H' (F>A ;F> 2- (XW  ;4TH                                                                             H' , H' ?0  (XX  ',                                             H' , H' ?2  (XX  AT       ' LITERAL  H' ?0  (XX  \'        ' LITERAL H' ?1  (XX  \TO      ' LITERAL  H' ?2  (XX  \AT       H' HERE  ' PUSH (XW  FOR/     H' ,      ' next (XW  /NEXT       H' LOOP/ ' ?for (XW  FOR      H' /LOOP  ' next (XW  NEXT        H' MARK/ ' (0BR (XW  IF       H' MARK/    ' of (XW  OF          H' MARK/  ' -if (XW  -IF      H' MARK/    ' if (XW  #IF         H' MARK/ ' call (XW  CALL>    H' /MARK  ' EXIT (XW  ;THEN                                                                                                                                                                                                       \ COMPILATION WORDS   -  EXTENSION                              H' ,      ' (BR (XW  AGAIN         H' , ' (0BR (XW  UNTIL       H' MARK/  ' (BR (XW  AHEAD          H' /MARK ALIAS  THEN        H' CSP! ALIAS CASE                                              TCOM     ': ELSE AHEAD [',] SWAP THEN ';  TCOM                  ': ENDCASE COMPILE [ ' DROP , ] BEGIN SP@ CSP - WHILE               THEN  REPEAT TO CSP ';      ': REPEAT SWAP AGAIN THEN ';                                                                    H' HERE ALIAS BEGIN  ' IF ALIAS WHILE  ' ELSE ALIAS ENDOF            H' \ ALIAS \       H' ( ALIAS (      H' T[ ALIAS  [                                                                        H' , H' ?1  (XX  TO      H' [CSP ' EXIT  (XW ;   TRANS          H' CSP]   >NEST (X1 :           H' T] ALIAS ]                      ': TO ?1  EXEC ';  ': AT ?2  EXEC ';                           <% GO!  1 1 +THRU   %> STOP! TINT CICLES . TSIZE . ROOT                                                                       FORTH                                                           21 LOAD 22 LOAD          23 LOAD 24 LOAD                        25 LOAD 26 LOAD          27 LOAD 28 LOAD                        29 LOAD 30 LOAD          31 LOAD 32 LOAD                        33 LOAD 34 LOAD          35 LOAD 36 LOAD                        37 LOAD 38 LOAD          39 LOAD 40 LOAD                        41 LOAD 42 LOAD                                                        113 134 THRU                                                                                                             \      : TRACE ' TRON EXEC TROFF ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ BASE HEX  DECIMAL BINARY &  ;BASE                             \ : EX POP POP SWAP PUSH PUSH ;  MAC: XCHG POP SWAP PUSH ;     `                                                                : ;BASE BASE XCHG PUSH TO BASE EX POP TO BASE ;                                                                                   0 NM: C@ (BR TO ;BASE ;M                                        1 NM: C@ ;BASE ;M                                               2 NM: C@ TO BASE ;M                                           |     (3  >BASE C,                                                16  >BASE HEX                                                   10  >BASE DECIMAL                                                2  >BASE BINARY                                                                                                              EXIT                                                            : PRIMER_2_BASE AT BINARY . ;  : HD. AT HEX D. ;  : H. 0 HD. ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  : forget DUP FENCE U< A" fence !" PUSH BEGIN VOCLINK @ ?DUP       R@ U< 0=    IF @ VOCLINK !  REPEAT VOCLINK BEGIN DUP 2-           BEGIN @ DUP R@ U< 0=  WHILE N>LINK  REPEAT                   OVER 2- ! @ ?DUP 0= UNTIL   FORTH TO FORTH POP TO HERE DROP ;  : FORGET ' C>N DROP forget ;                                    : PRUNE VOCLINK                                                 BEGIN DUP PUSH V>LINK                                             BEGIN @ DUP HERE U< 0= WHILE N>LINK  REPEAT                     DUP R@ V>LINK ! ?DUP                                            IF DUP PUSH                                                       BEGIN  N>LINK @ ?DUP  WHILE                                       DUP HERE U< IF DUP POP N>LINK ! DUP PUSH THEN                 REPEAT 0 POP N>LINK !                                         THEN POP @ ?DUP 0=                                            UNTIL -HEAD AT HIDDEN OFF ;                                                                                                     : WORDS CR 10 TO CSP CONTEXT -1 0 DO @ ?DUP                     IF DUP C@ #LEN AND 6 + OUTC + 80 < 0=                             IF CR CSP ?DUP                                                    IF 1- TO CSP                                                      ELSE 10 TO CSP KEY LOW 27 =                                     IF DROP I " LISTED" LEAVE                                       THEN THEN THEN DUP H. DUP ID. 1H OUTC OVER MOD ?DUP  0=     IF DUP                                                          THEN - DUP 13 < 0=                                              IF DROP 1                                                       THEN OUTC 64 < 0=                                               IF 1-                                                           THEN SPACES N>C 2-                                              ELSE CR I " TOTAL" LEAVE                                      THEN LOOP ". ."  WORDS = " . ;                                                                                                  \ BLOCK                                                         | : ;ERR EX PREV 2+ 1+ DERR A" IO-BLK ?" ;                      | : +BUF B/BUF + DUP LIMIT =  IF DROP FIRST  THEN DUP PREV - ;  | : ?SAVE BSTR IF DUP STR WBLK 0 OVER 1- C! THEN ;              : SAVE-BUFS LIMIT FIRST ?DO I ?SAVE DROP B/BUF +LOOP ;          : BUFFER USE DUP BEGIN +BUF UNTIL                                         TO USE DUP TO PREV ?SAVE !+ ;                         : BLOCK ;ERR PUSH PREV 1+ @ R@ -  IF PREV BEGIN +BUF 0=             IF DROP POP BUFFER 2- STR RBLK ;THEN                                 DUP 1+ @ R@ = UNTIL   TO PREV  THEN RDROP ;            : EMPTY-BUFS FIRST LIMIT OVER - ERASE FIRST DUP                     TO PREV TO USE  LIMIT FIRST DO -1 I 1+ ! B/BUF +LOOP ;      : FLUSH SAVE-BUFS EMPTY-BUFS ;                                  : USING FLUSH -USE FOPEN TO SCRH ;                                                                                                                                                              \ TYPE , TYPE+ , STYPE , ID. , ?ID. , 'ERROR & DEBUG            : ;DROP EX DROP ;   : ;SPACE EX SPACE ;  : (STR DUP CSTR + ;    : TYPE+ FOR CSTR ?EMIT NEXT ; : TYPE ;DROP TYPE+ ;              : STYPE CSTR TYPE ; : ID. ;SPACE CSTR 31 AND TYPE ;             : CR cr EMIT lf EMIT 0 TO OUTC ;  0 VECTOR 'ERROR               : (." POP CSTR TYPE+ PUSH ;  : (" POP (STR PUSH ;               : (ERROR CR HERE ID. BLK TO SCR >IN TO CSP STYPE CR ;           : (A" POP SWAP IF 'ERROR  ABORT THEN CSTR + PUSH ;                                                                              HERE 2- >MARK >MARK >RELEASE ," AT >RELEASE ," TO               CONSTANT TO_AT    : 2H. 2DUP H. H. ;                            : ?ID. C>N ?DUP 0; 1- ?DUP IF TO_AT + @ ID. THEN ID. ;                                                                          : (DEBUG 2H. PUSH PUSH 2H. POP POP SP@ H. RP@ H.  R@ H. ?SI         -@ DUP @ H. H. H. HERE H. ?AX ?ID ;                                                                                         : SPACES FOR SPACE NEXT ;                                       : S>D DUP 0< ;                                                  : ", C@ 1+ ALLOT ;                                              : LATEST CURRENT @ ;                                            : ?CODE HERE SWAP RCALL, \, ] ;                                 : ;code POP CFA ! ;                                             : NM: >DOES SWAP - ?CODE ;      : M: >F: ?CODE ;                : DOES> COMPILE ;code >DOES RCALL, ; : STR, FOR B, NEXT DROP ;  : ,S" HERE C" " WORD ", ;       : ". CSTR TYPE ;                : ," BLWORD ", ;                : 0" HERE 2+ :1260 ZC, 1+! ;    : ( `) WORD ". ;                                                : Z" HERE 2+ \, " ZC, 1+! ;                                                                                                                                                                                                                                                                                                     : "MOVE OVER C@ 1+ MOVE ;                                       : CSTR, DUP C, STR, ;                                           : .( 41 WORD ". ;                                               : HOME 0 0 GOTOXY ;                                             : PAGE (CLSC HOME ;                                             : WCOUNT STR ;                                                  : COUNT CSTR ;                                                  : U/MOD 0 SWAP UM/MOD ;                                         : M/MOD TUCK U/MOD PUSH SWAP UM/MOD POP ;                       : ORDER. ORDER# WCOUNT FOR WCOUNT 6 - ?ID. NEXT DROP ;          : -USE SCRH 1+  IF SCRH CLOSE DROP -1 TO SCRH THEN ;            : .LINE .. SPACE 1L TYPE ;                                      : LIST DUP TO SCR BLOCK .BLOCK ;                                : .BLOCK CR SCR SPACE 213 EMIT ..                                    1H 0 DO CR DUP I .LINE 1L     + LOOP DROP ;                                                                                : EXPECT 2DUP TO (DO ?DO BEGIN KEY LOW DUP I C! bl U< 0=          IF I C@ EMIT 1  ELSE I C@ cr    OF I ROT - LEAVE  THEN          bs  OF OVER I - UNTIL                                           bs DUP EMIT SPACE EMIT -1  ELSE DROP 0                          THEN THEN +LOOP TO SPAN DROP ;                                : ;RBUF POP RP@ ROT - RP@ OVER RP! PUSH SWAP PUSH EX                    POP RP!    ;                                            : ;TI POP BLK PUSH >IN PUSH TIB PUSH PUSH EX                            POP TO TIB POP     POP TO PERFORM ;                     : LOAD ;TI 0 SWAP TO PERFORM INTERPRET ;                        : EVAL ;TI 0 TO PERFORM 0 TO TIB INTERPRET ;                    : '0+ -FIND ?DUP 0= A" ?" ;                                     : ' '0+ DROP ;                                                  : FIND ROT PUSH -1 -ROT FOR STR                                         @ SWAP NEXT DROP CONTEXT @ POP (find TO ?, ;            : (-FIND BLWORD ORDER# STR FIND ;                               : BLWORD bl WORD ;                                              :TR- WORD BLK NBLK >IN HERE (WORD TO >IN ;                      : ?IN @R+ >IN PUSH ?EXEC POP TO >IN ;                           : MARKER     ?IN -FIND NIP                                                IF ?IN FORGET THEN     CREATE                                     DOES> 2- C>N DROP forget ;                          : RESCAN >IN -FIND ROT TO >IN NIP 0;                                      CR HERE ". ."   EXIST ! " BLK  1- 0>= 0;                        ." IN BLK " BLK . ;                                   : FOPEN BLWORD 1+ OPEN DUP 0< A"  OPEN ERROR " ;                : TRACE ' TR EXEC -TR ;                                         : -HEAD EDGE TO NPTR HEADERS ;                                  : PAGE (CLSC HOME ;                                             : WITHIN OVER - PUSH - POP U< ;                                 : THRU 1+ SWAP ?DO I LOAD LOOP ;                                                                                                : WORD BLK NBLK >IN HERE (WORD TO >IN ;                         : BLWORD bl WORD ;                                              : SEVAL ;TI TO BLK IO! 90 ;RBUF TO TIB TO OPEN                        BEGIN 1LINE        EOF? 0< UNTIL  TO OPEN ;               :- KBD 0 SEVAL IO! ;                                            : FLOAD HANDLES bs - 0= A"  TOO MUCH FILES "                            FOPEN TO HANDLES   -1 SEVAL IO! ;                       ->: QUIT KBD QUIT ;                                             : CLOSALL BEGIN HANDLES  0;  AT CLOSE  AGAIN ;                  ->: (INT -FIND ?DUP  IF ?, (INT  THEN NUM ?LITERAL (INT ;                                                                                                                                                                                                                                                                                                                                                                                                       : FOPEN BLWORD 1+ OPEN DUP 0< A"  OPEN ERROR " ;                : TYPE FOR CSTR ?EMIT NEXT DROP ;                               : ( C" ) WORD DROP ;                                            : CR cr EMIT lf EMIT 0 TO OUTC ;                                : OK? BLK IF EX CR ;THEN      ."  Ok" CR EX SPACE ;             : REFILL TIB 80 EXPECT 0 TO >IN TIB SPAN + OFF ;                : 1LINE OK? REFILL EX INTERPRET ;                               : IO! BLK COM IF SIO EXIT THEN FIO ;                            : EXECUTE PUSH ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                